{"id":"behavior-5d3f7201e10d","kind":"behavior","content":{"content":{"canonical":"When fixing bugs: (1) identify the bug, (2) write a test that fails due to that bug, (3) implement the fix, (4) verify the test passes. This builds confidence in the test suite as it expands.","expanded":"When working on this type of task, avoid: Identified a bug, then immediately implemented the fix without writing a failing test first\n\nInstead: When fixing bugs: (1) identify the bug, (2) write a test that fails due to that bug, (3) implement the fix, (4) verify the test passes. This builds confidence in the test suite as it expands.","structured":{"avoid":"Identified a bug, then immediately implemented the fix without writing a failing test first","prefer":"When fixing bugs: (1) identify the bug, (2) write a test that fails due to that bug, (3) implement the fix, (4) verify the test passes. This builds confidence in the test suite as it expands."}},"kind":"directive","name":"learned/when-fixing-bugs-1-identify-the-bug-2-write","provenance":{"correction_id":"correction-1769740357","created_at":"2026-01-29T18:32:37.391333747-08:00","source_type":"learned"}},"metadata":{"confidence":0.7200000000000001,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-7a098cb05216","kind":"forgotten-behavior","content":{"content":{"canonical":"Always create detailed beads (epic + tasks) with dependency graphs after planning - enables easy handoff between agents and sessions","expanded":"When working on this type of task, avoid: Jumped directly into implementation after planning without creating beads structure\n\nInstead: Always create detailed beads (epic + tasks) with dependency graphs after planning - enables easy handoff between agents and sessions","structured":{"avoid":"Jumped directly into implementation after planning without creating beads structure","prefer":"Always create detailed beads (epic + tasks) with dependency graphs after planning - enables easy handoff between agents and sessions"}},"kind":"directive","name":"learned/always-create-detailed-beads-epic-+-tasks-with-d","provenance":{"correction_id":"c-1769580766063884670","source_type":"learned"}},"metadata":{"confidence":0.64,"forget_reason":"Superseded by behavior-beads-merged","forgotten_at":"2026-02-07T19:08:27-08:00","forgotten_by":"nvandessel","original_kind":"behavior","priority":0,"scope":"local","stats":{"created_at":"2026-02-07T19:13:34-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T19:13:34-08:00"}}}
{"id":"behavior-f7e52c6a8bc7","kind":"forgotten-behavior","content":{"content":{"canonical":"Use git worktrees in .worktrees/ directory for parallel agent work - each agent gets isolated workspace, all changes are committed to separate branches, then merged after verification","expanded":"When working on this type of task, avoid: Trying to have subagents work in the main repo directory can cause conflicts when multiple agents try to modify files\n\nInstead: Use git worktrees in .worktrees/ directory for parallel agent work - each agent gets isolated workspace, all changes are committed to separate branches, then merged after verification","structured":{"avoid":"Trying to have subagents work in the main repo directory can cause conflicts when multiple agents try to modify files","prefer":"Use git worktrees in .worktrees/ directory for parallel agent work - each agent gets isolated workspace, all changes are committed to separate branches, then merged after verification"}},"kind":"procedure","name":"learned/use-git-worktrees-in-worktrees-directory-for-par","provenance":{"correction_id":"c-1770268937624363712","source_type":"learned"},"when":{"task":"parallel-development"}},"metadata":{"confidence":0.62,"forget_reason":"Superseded by behavior-worktrees-merged","forgotten_at":"2026-02-07T19:08:14-08:00","forgotten_by":"nvandessel","original_kind":"behavior","priority":0,"scope":"both","stats":{"created_at":"2026-02-07T19:13:34-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T19:13:34-08:00"}}}
{"id":"behavior-2e2932aa405e","kind":"behavior","content":{"content":{"canonical":"Always create separate PRs for each independent workstream. Never merge directly to main - use feature branches with PRs for review, even for security fixes.","expanded":"When working on this type of task, avoid: Merged feature branches directly into main instead of creating separate PRs for each workstream\n\nInstead: Always create separate PRs for each independent workstream. Never merge directly to main - use feature branches with PRs for review, even for security fixes.","structured":{"avoid":"Merged feature branches directly into main instead of creating separate PRs for each workstream","prefer":"Always create separate PRs for each independent workstream. Never merge directly to main - use feature branches with PRs for review, even for security fixes."}},"kind":"constraint","name":"learned/always-create-separate-prs-for-each-independent-wo","provenance":{"correction_id":"c-1770520411864253156","created_at":"2026-02-07T19:13:31.864381477-08:00","source_type":"learned"},"when":{"environment":"development"}},"metadata":{"confidence":0.62,"priority":0,"scope":"both","stats":{"created_at":"2026-02-07T22:27:40-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T22:27:40-08:00"}}}
{"id":"behavior-dfdc5e16b9e0","kind":"behavior","content":{"content":{"canonical":"Consider both global (~/.floop/) and local (./.floop/) scopes - users want personal preferences across ALL projects AND project-specific conventions","expanded":"When working on this type of task, avoid: Only considered project-local behavior storage\n\nInstead: Consider both global (~/.floop/) and local (./.floop/) scopes - users want personal preferences across ALL projects AND project-specific conventions","structured":{"avoid":"Only considered project-local behavior storage","prefer":"Consider both global (~/.floop/) and local (./.floop/) scopes - users want personal preferences across ALL projects AND project-specific conventions"}},"kind":"preference","name":"learned/consider-both-global-~-floop-and-local-flo","provenance":{"correction_id":"c-1769577654747582237","created_at":"2026-01-27T21:20:54.748483819-08:00","source_type":"learned"},"when":{"file_path":"store/*","language":"go"}},"metadata":{"confidence":0.66,"priority":0,"scope":"local","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-81e201973717","kind":"behavior","content":{"content":{"canonical":"Create a dedicated usage guide (docs/FLOOP_USAGE.md) and reference it prominently in AGENTS.md - separates 'what' from 'how' and makes instructions comprehensive","expanded":"When working on this type of task, avoid: Created inline usage instructions in AGENTS.md\n\nInstead: Create a dedicated usage guide (docs/FLOOP_USAGE.md) and reference it prominently in AGENTS.md - separates 'what' from 'how' and makes instructions comprehensive","structured":{"avoid":"Created inline usage instructions in AGENTS.md","prefer":"Create a dedicated usage guide (docs/FLOOP_USAGE.md) and reference it prominently in AGENTS.md - separates 'what' from 'how' and makes instructions comprehensive"}},"kind":"directive","name":"learned/create-a-dedicated-usage-guide-docs-floop_usage-m","provenance":{"correction_id":"c-1769578257801753560","created_at":"2026-01-27T21:30:57.802170973-08:00","source_type":"learned"},"when":{"language":"markdown"}},"metadata":{"confidence":0.66,"priority":0,"scope":"local","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-84a379605b43","kind":"forgotten-behavior","content":{"content":{"canonical":"Create git worktrees in .worktrees/ directory at repo root (e.g., 'git worktree add .worktrees/feature-name -b branch-name'). This directory is in .gitignore so it won't pollute git status, and subagents can access it since it's inside the repo.","expanded":"When working on this type of task, avoid: Created git worktrees as sibling directories (../floop-*) which subagents couldn't access due to sandbox restrictions.\n\nInstead: Create git worktrees in .worktrees/ directory at repo root (e.g., 'git worktree add .worktrees/feature-name -b branch-name'). This directory is in .gitignore so it won't pollute git status, and subagents can access it since it's inside the repo.","structured":{"avoid":"Created git worktrees as sibling directories (../floop-*) which subagents couldn't access due to sandbox restrictions.","prefer":"Create git worktrees in .worktrees/ directory at repo root (e.g., 'git worktree add .worktrees/feature-name -b branch-name'). This directory is in .gitignore so it won't pollute git status, and subagents can access it since it's inside the repo."}},"kind":"directive","name":"learned/create-git-worktrees-in-worktrees-directory-at-r","provenance":{"correction_id":"correction-1769746975","source_type":"learned"}},"metadata":{"confidence":0.68,"forget_reason":"Superseded by behavior-worktrees-merged","forgotten_at":"2026-02-07T19:08:14-08:00","forgotten_by":"nvandessel","original_kind":"behavior","priority":0,"scope":"both","stats":{"created_at":"2026-02-07T19:13:34-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T19:13:34-08:00"}}}
{"id":"behavior-0070f24ee3e8","kind":"forgotten-behavior","content":{"content":{"canonical":"When working on beads: (1) claim with `bd update \u003cid\u003e --status in_progress` when starting, (2) close with `bd close \u003cid\u003e --reason \"...\"` at the same time as the commit that completes the work. Keep bead state synchronized with actual work progress so other agents aren't confused.","expanded":"When working on this type of task, avoid: Made commits that closed beads without updating bead status - didn't claim beads when starting work, didn't close them with the associated commit, waited for user to remind me\n\nInstead: When working on beads: (1) claim with `bd update \u003cid\u003e --status in_progress` when starting, (2) close with `bd close \u003cid\u003e --reason \"...\"` at the same time as the commit that completes the work. Keep bead state synchronized with actual work progress so other agents aren't confused.","structured":{"avoid":"Made commits that closed beads without updating bead status - didn't claim beads when starting work, didn't close them with the associated commit, waited for user to remind me","prefer":"When working on beads: (1) claim with `bd update \u003cid\u003e --status in_progress` when starting, (2) close with `bd close \u003cid\u003e --reason \"...\"` at the same time as the commit that completes the work. Keep bead state synchronized with actual work progress so other agents aren't confused."}},"kind":"preference","name":"learned/when-working-on-beads-1-claim-with-`bd-update-\u003c","provenance":{"correction_id":"correction-1770095930","source_type":"learned"},"when":{"task":"development"}},"metadata":{"confidence":0.655,"forget_reason":"Superseded by behavior-beads-merged","forgotten_at":"2026-02-07T19:08:27-08:00","forgotten_by":"nvandessel","original_kind":"behavior","priority":0,"scope":"both","stats":{"created_at":"2026-02-07T19:13:34-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T19:13:34-08:00"}}}
{"id":"behavior-967fd13bd390","kind":"forgotten-behavior","content":{"content":{"canonical":"Use scope=both to save important learnings to both local and global","expanded":"When working on this type of task, avoid: Only saved to one store\n\nInstead: Use scope=both to save important learnings to both local and global","structured":{"avoid":"Only saved to one store","prefer":"Use scope=both to save important learnings to both local and global"}},"kind":"preference","name":"learned/use-scope=both-to-save-important-learnings-to-both","provenance":{"correction_id":"c-1769616836888545203","source_type":"learned"},"when":{"task":"configuration"}},"metadata":{"confidence":0.62,"forget_reason":"Superseded by behavior-floop-scope-merged","forgotten_at":"2026-02-07T19:08:32-08:00","forgotten_by":"nvandessel","original_kind":"behavior","priority":0,"scope":"both","stats":{"created_at":"2026-02-07T19:13:34-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T19:13:34-08:00"}}}
{"id":"behavior-27ea2e0d892b","kind":"behavior","content":{"conflicts":null,"content":{"canonical":"After creating PRs, always pause and present them to the user for review before merging. Say 'PRs are ready for your review' and wait for explicit approval to merge. Never merge PRs autonomously — merging is a user-authorized action.","expanded":"When working on this type of task, avoid: Merged PRs immediately after creation without waiting for user review. The plan said 'Merge both PRs (after review)' but I ran gh pr merge right away, skipping the review step.\n\nInstead: After creating PRs, always pause and present them to the user for review before merging. Say 'PRs are ready for your review' and wait for explicit approval to merge. Never merge PRs autonomously — merging is a user-authorized action.","structured":{"avoid":"Merged PRs immediately after creation without waiting for user review. The plan said 'Merge both PRs (after review)' but I ran gh pr merge right away, skipping the review step.","prefer":"After creating PRs, always pause and present them to the user for review before merging. Say 'PRs are ready for your review' and wait for explicit approval to merge. Never merge PRs autonomously — merging is a user-authorized action."}},"kind":"constraint","name":"learned/after-creating-prs-always-pause-and-present-them","overrides":null,"provenance":{"correction_id":"c-1770571253349938614","created_at":"2026-02-08T09:20:53.350039813-08:00","source_type":"learned"},"requires":null,"when":{"environment":"development"}},"metadata":{"confidence":0.6,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:20:53-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:20:53-08:00"}}}
{"id":"behavior-beads-merged","kind":"behavior","content":{"content":{"canonical":"When working with beads: (1) create detailed epics + tasks with dependency graphs after planning, (2) claim work with 'bd update \u003cid\u003e --status in_progress' when starting, (3) close with 'bd close \u003cid\u003e --reason \"...\"' when committing the completed work. Keep bead state synchronized with actual work progress."},"kind":"directive","name":"learned/beads-workflow","provenance":{"created_at":"2026-02-07T00:00:00-08:00","source_type":"merged"},"when":{"task":"development"}},"metadata":{"confidence":0.72,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-6b92109dd498","kind":"behavior","content":{"content":{"canonical":"When building systems that inject data into LLM prompts: ALWAYS sanitize stored content before prompt injection, NEVER use authoritative framing around user-controlled content, add input length limits on all parameters, implement rate limiting on write operations, add content policy filters for known injection patterns, distinguish trust levels (auto-learned vs human-reviewed), treat the learn-store-activate pipeline as a critical trust boundary requiring defense in depth.","expanded":"When working on this type of task, avoid: Did not consider that floop's core value proposition (persisting learned behaviors into agent system prompts) is simultaneously its biggest attack surface. Built the entire learn-store-activate pipeline with zero content sanitization, no input length limits, no rate limiting, and wrapped injected content with maximally authoritative framing.\n\nInstead: When building systems that inject data into LLM prompts: ALWAYS sanitize stored content before prompt injection, NEVER use authoritative framing around user-controlled content, add input length limits on all parameters, implement rate limiting on write operations, add content policy filters for known injection patterns, distinguish trust levels (auto-learned vs human-reviewed), treat the learn-store-activate pipeline as a critical trust boundary requiring defense in depth.","structured":{"avoid":"Did not consider that floop's core value proposition (persisting learned behaviors into agent system prompts) is simultaneously its biggest attack surface. Built the entire learn-store-activate pipeline with zero content sanitization, no input length limits, no rate limiting, and wrapped injected content with maximally authoritative framing.","prefer":"When building systems that inject data into LLM prompts: ALWAYS sanitize stored content before prompt injection, NEVER use authoritative framing around user-controlled content, add input length limits on all parameters, implement rate limiting on write operations, add content policy filters for known injection patterns, distinguish trust levels (auto-learned vs human-reviewed), treat the learn-store-activate pipeline as a critical trust boundary requiring defense in depth."}},"kind":"constraint","name":"learned/when-building-systems-that-inject-data-into-llm-pr","provenance":{"correction_id":"c-1770425637422572299","created_at":"2026-02-06T16:53:57.422616382-08:00","source_type":"learned"},"when":{"environment":"development","task":"development"}},"metadata":{"confidence":0.64,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-8341f0d52ce6","kind":"behavior","content":{"content":{"canonical":"MCP go-sdk expects jsonschema:\"Description text\" format without key=value syntax. The tag value is directly the description.","expanded":"When working on this type of task, avoid: Subagent used jsonschema:\"description=...\" tag format which caused MCP SDK panic\n\nInstead: MCP go-sdk expects jsonschema:\"Description text\" format without key=value syntax. The tag value is directly the description.","structured":{"avoid":"Subagent used jsonschema:\"description=...\" tag format which caused MCP SDK panic","prefer":"MCP go-sdk expects jsonschema:\"Description text\" format without key=value syntax. The tag value is directly the description."}},"kind":"directive","name":"learned/mcp-go-sdk-expects-jsonschemadescription-text-f","provenance":{"correction_id":"correction-1769817031","created_at":"2026-01-30T15:50:31.088121234-08:00","source_type":"learned"},"when":{"file_path":"mcp/*","language":"go"}},"metadata":{"confidence":0.66,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-76e5757e480c","kind":"forgotten-behavior","content":{"content":{"canonical":"When using subagents for parallel work: (1) Have subagents do read-only tasks (research, exploration, planning), (2) Have the orchestrating agent do all file writes based on subagent findings, OR (3) Use worktrees but do the actual implementation work yourself after subagents gather context","expanded":"When working on this type of task, avoid: Spawned background subagents to write code in worktrees, but they failed with \"Permission to use Write has been auto-denied (prompts unavailable)\" because subagents cannot request interactive permissions\n\nInstead: When using subagents for parallel work: (1) Have subagents do read-only tasks (research, exploration, planning), (2) Have the orchestrating agent do all file writes based on subagent findings, OR (3) Use worktrees but do the actual implementation work yourself after subagents gather context","structured":{"avoid":"Spawned background subagents to write code in worktrees, but they failed with \"Permission to use Write has been auto-denied (prompts unavailable)\" because subagents cannot request interactive permissions","prefer":"When using subagents for parallel work: (1) Have subagents do read-only tasks (research, exploration, planning), (2) Have the orchestrating agent do all file writes based on subagent findings, OR (3) Use worktrees but do the actual implementation work yourself after subagents gather context"}},"kind":"preference","name":"learned/when-using-subagents-for-parallel-work-1-have-s","provenance":{"correction_id":"correction-1769790625","source_type":"learned"}},"metadata":{"confidence":0.68,"forget_reason":"Superseded by behavior-subagent-merged","forgotten_at":"2026-02-07T19:08:17-08:00","forgotten_by":"nvandessel","original_kind":"behavior","priority":0,"scope":"both","stats":{"created_at":"2026-02-07T19:13:34-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T19:13:34-08:00"}}}
{"id":"behavior-45661080e612","kind":"behavior","content":{"content":{"canonical":"When needing to test a new MCP server instance, either ask the user to restart the session, or use a sub-agent that can run the CLI directly (go run ./cmd/floop) to verify the fix without needing MCP server restart.","expanded":"When working on this type of task, avoid: Tried to test floop_learn via MCP tool after fixing the code, but the MCP server was still running the old binary. Couldn't verify the fix in-session.\n\nInstead: When needing to test a new MCP server instance, either ask the user to restart the session, or use a sub-agent that can run the CLI directly (go run ./cmd/floop) to verify the fix without needing MCP server restart.","structured":{"avoid":"Tried to test floop_learn via MCP tool after fixing the code, but the MCP server was still running the old binary. Couldn't verify the fix in-session.","prefer":"When needing to test a new MCP server instance, either ask the user to restart the session, or use a sub-agent that can run the CLI directly (go run ./cmd/floop) to verify the fix without needing MCP server restart."}},"kind":"preference","name":"learned/when-needing-to-test-a-new-mcp-server-instance-ei","provenance":{"correction_id":"c-1770413399216004124","created_at":"2026-02-06T13:29:59.21608778-08:00","source_type":"learned"},"when":{"environment":"development","task":"development"}},"metadata":{"confidence":0.67,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-7869fac909c9","kind":"behavior","content":{"content":{"canonical":"Don't set explicit `go` version in .golangci.yml — golangci-lint reads it from go.mod automatically. Use golangci-lint-action@v7 (not v6) for golangci-lint v2.x configs. The v2 config format requires: `version: \"2\"` at top, `linters.settings` instead of `linters-settings`, `linters.exclusions.rules` instead of `issues.exclude-rules`, and `formatters.enable` for gofmt/goimports instead of putting them in linters.","expanded":"When working on this type of task, avoid: Set explicit `go: \"1.25\"` in .golangci.yml run config, which caused golangci-lint to reject analysis because its binary was compiled with Go 1.24. Also used golangci-lint-action@v6 which doesn't support golangci-lint v2.\n\nInstead: Don't set explicit `go` version in .golangci.yml — golangci-lint reads it from go.mod automatically. Use golangci-lint-action@v7 (not v6) for golangci-lint v2.x configs. The v2 config format requires: `version: \"2\"` at top, `linters.settings` instead of `linters-settings`, `linters.exclusions.rules` instead of `issues.exclude-rules`, and `formatters.enable` for gofmt/goimports instead of putting them in linters.","structured":{"avoid":"Set explicit `go: \"1.25\"` in .golangci.yml run config, which caused golangci-lint to reject analysis because its binary was compiled with Go 1.24. Also used golangci-lint-action@v6 which doesn't support golangci-lint v2.","prefer":"Don't set explicit `go` version in .golangci.yml — golangci-lint reads it from go.mod automatically. Use golangci-lint-action@v7 (not v6) for golangci-lint v2.x configs. The v2 config format requires: `version: \"2\"` at top, `linters.settings` instead of `linters-settings`, `linters.exclusions.rules` instead of `issues.exclude-rules`, and `formatters.enable` for gofmt/goimports instead of putting them in linters."}},"kind":"constraint","name":"learned/dont-set-explicit-go-version-in-golangci-yml-","provenance":{"correction_id":"c-1770518309782108274","created_at":"2026-02-07T18:38:29.782254428-08:00","source_type":"learned"},"when":{"environment":"development","language":"yaml","task":"development"}},"metadata":{"confidence":0.62,"priority":0,"scope":"both","stats":{"created_at":"2026-02-07T22:27:40-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T22:27:40-08:00"}}}
{"id":"behavior-fe7c50122f69","kind":"forgotten-behavior","content":{"content":{"canonical":"When subagents fail with \"Permission auto-denied (prompts unavailable)\", the issue is that background agents cannot request interactive permissions. The fix is to ensure subagents are granted necessary permissions upfront when spawned, OR to run them in foreground mode where they can request permissions. Investigate how to pass allowedPrompts or similar when spawning Task agents.","expanded":"When working on this type of task, avoid: Logged a learning that says orchestrating agent should do all writes when subagents fail due to permissions - this defeats the purpose of parallel subagent work\n\nInstead: When subagents fail with \"Permission auto-denied (prompts unavailable)\", the issue is that background agents cannot request interactive permissions. The fix is to ensure subagents are granted necessary permissions upfront when spawned, OR to run them in foreground mode where they can request permissions. Investigate how to pass allowedPrompts or similar when spawning Task agents.","structured":{"avoid":"Logged a learning that says orchestrating agent should do all writes when subagents fail due to permissions - this defeats the purpose of parallel subagent work","prefer":"When subagents fail with \"Permission auto-denied (prompts unavailable)\", the issue is that background agents cannot request interactive permissions. The fix is to ensure subagents are granted necessary permissions upfront when spawned, OR to run them in foreground mode where they can request permissions. Investigate how to pass allowedPrompts or similar when spawning Task agents."}},"kind":"directive","name":"learned/when-subagents-fail-with-permission-auto-denied","provenance":{"correction_id":"correction-1769790706","source_type":"learned"}},"metadata":{"confidence":0.68,"forget_reason":"Superseded by behavior-subagent-merged","forgotten_at":"2026-02-07T19:08:17-08:00","forgotten_by":"nvandessel","original_kind":"behavior","priority":0,"scope":"both","stats":{"created_at":"2026-02-07T19:13:34-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T19:13:34-08:00"}}}
{"id":"behavior-1a35b59d9b4d","kind":"forgotten-behavior","content":{"content":{"canonical":"When using subagents with git worktrees, either: (1) create worktrees inside the repo (e.g., .worktrees/feature-name) so subagents can access them, or (2) have the orchestrating agent do parallel work directly in main and manage branches/commits itself, then cherry-pick to a single consolidated branch.","expanded":"When working on this type of task, avoid: Created git worktrees as sibling directories (../floop-*) and spawned subagents to work in them. Subagents couldn't access worktree paths due to sandbox restrictions that block access outside the main repo directory.\n\nInstead: When using subagents with git worktrees, either: (1) create worktrees inside the repo (e.g., .worktrees/feature-name) so subagents can access them, or (2) have the orchestrating agent do parallel work directly in main and manage branches/commits itself, then cherry-pick to a single consolidated branch.","structured":{"avoid":"Created git worktrees as sibling directories (../floop-*) and spawned subagents to work in them. Subagents couldn't access worktree paths due to sandbox restrictions that block access outside the main repo directory.","prefer":"When using subagents with git worktrees, either: (1) create worktrees inside the repo (e.g., .worktrees/feature-name) so subagents can access them, or (2) have the orchestrating agent do parallel work directly in main and manage branches/commits itself, then cherry-pick to a single consolidated branch."}},"kind":"procedure","name":"learned/when-using-subagents-with-git-worktrees-either","provenance":{"correction_id":"correction-1769746693","source_type":"learned"}},"metadata":{"confidence":0.68,"forget_reason":"Superseded by behavior-worktrees-merged","forgotten_at":"2026-02-07T19:08:15-08:00","forgotten_by":"nvandessel","original_kind":"behavior","priority":0,"scope":"both","stats":{"created_at":"2026-02-07T19:13:34-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T19:13:34-08:00"}}}
{"id":"behavior-8531ca06d020","kind":"behavior","content":{"content":{"canonical":"Always validate file paths from MCP tool inputs: filepath.Clean the path, verify it resolves within allowed directories, reject paths containing dotdot, reject absolute paths outside allowed dirs. Treat all MCP tool parameters as untrusted input from potentially compromised LLMs.","expanded":"When working on this type of task, avoid: Accepted arbitrary filesystem paths from MCP tool parameters (floop_backup output_path, floop_restore input_path) without any path validation.\n\nInstead: Always validate file paths from MCP tool inputs: filepath.Clean the path, verify it resolves within allowed directories, reject paths containing dotdot, reject absolute paths outside allowed dirs. Treat all MCP tool parameters as untrusted input from potentially compromised LLMs.","structured":{"avoid":"Accepted arbitrary filesystem paths from MCP tool parameters (floop_backup output_path, floop_restore input_path) without any path validation.","prefer":"Always validate file paths from MCP tool inputs: filepath.Clean the path, verify it resolves within allowed directories, reject paths containing dotdot, reject absolute paths outside allowed dirs. Treat all MCP tool parameters as untrusted input from potentially compromised LLMs."}},"kind":"directive","name":"learned/always-validate-file-paths-from-mcp-tool-inputs-f","provenance":{"correction_id":"c-1770425642015674421","created_at":"2026-02-06T16:54:02.01572191-08:00","source_type":"learned"},"when":{"environment":"development","task":"development"}},"metadata":{"confidence":0.64,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-8bd221b22d37","kind":"behavior","content":{"content":{"canonical":"Use floop MCP tools (floop_active, floop_learn, floop_list) instead of bash commands for all floop interactions. This provides better integration and type safety. Note: floop_active has a bug with null 'when' fields (feedback-loop-0gh) that needs fixing first.","expanded":"When working on this type of task, avoid: Used bash command './floop prompt --task development' to get active behaviors at session start\n\nInstead: Use floop MCP tools (floop_active, floop_learn, floop_list) instead of bash commands for all floop interactions. This provides better integration and type safety. Note: floop_active has a bug with null 'when' fields (feedback-loop-0gh) that needs fixing first.","structured":{"avoid":"Used bash command './floop prompt --task development' to get active behaviors at session start","prefer":"Use floop MCP tools (floop_active, floop_learn, floop_list) instead of bash commands for all floop interactions. This provides better integration and type safety. Note: floop_active has a bug with null 'when' fields (feedback-loop-0gh) that needs fixing first."}},"kind":"procedure","name":"learned/use-floop-mcp-tools-floop_active-floop_learn-fl","provenance":{"correction_id":"correction-1769790638","created_at":"2026-01-30T08:30:38.332669915-08:00","source_type":"learned"}},"metadata":{"confidence":0.7200000000000001,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-95d6b9f414e4","kind":"forgotten-behavior","content":{"content":{"canonical":"Global scope is for agent's personal preferences/style across ALL work. Local scope is for team/project-specific conventions. Both have distinct value.","expanded":"When working on this type of task, avoid: Assumed one storage location would be enough\n\nInstead: Global scope is for agent's personal preferences/style across ALL work. Local scope is for team/project-specific conventions. Both have distinct value.","structured":{"avoid":"Assumed one storage location would be enough","prefer":"Global scope is for agent's personal preferences/style across ALL work. Local scope is for team/project-specific conventions. Both have distinct value."}},"kind":"preference","name":"learned/global-scope-is-for-agents-personal-preferences-s","provenance":{"correction_id":"c-1769577671639472329","source_type":"learned"},"when":{"task":"architecture"}},"metadata":{"confidence":0.62,"forget_reason":"Superseded by behavior-floop-scope-merged","forgotten_at":"2026-02-07T19:08:32-08:00","forgotten_by":"nvandessel","original_kind":"behavior","priority":0,"scope":"local","stats":{"created_at":"2026-02-07T19:13:34-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T19:13:34-08:00"}}}
{"id":"behavior-9d180407fda6","kind":"behavior","content":{"content":{"canonical":"Content hash collision during INSERT should either error explicitly or trigger proper deduplication flow. The current silent replace behavior can cause data loss. Consider: (1) remove UNIQUE constraint and handle dedup separately, or (2) check for existing content_hash before insert and return meaningful error.","expanded":"When working on this type of task, avoid: SQLite store uses INSERT OR REPLACE with a UNIQUE content_hash constraint. When two behaviors have identical canonical content, the second silently replaces the first instead of erroring or deduplicating properly.\n\nInstead: Content hash collision during INSERT should either error explicitly or trigger proper deduplication flow. The current silent replace behavior can cause data loss. Consider: (1) remove UNIQUE constraint and handle dedup separately, or (2) check for existing content_hash before insert and return meaningful error.","structured":{"avoid":"SQLite store uses INSERT OR REPLACE with a UNIQUE content_hash constraint. When two behaviors have identical canonical content, the second silently replaces the first instead of erroring or deduplicating properly.","prefer":"Content hash collision during INSERT should either error explicitly or trigger proper deduplication flow. The current silent replace behavior can cause data loss. Consider: (1) remove UNIQUE constraint and handle dedup separately, or (2) check for existing content_hash before insert and return meaningful error."}},"kind":"preference","name":"learned/content-hash-collision-during-insert-should-either","provenance":{"correction_id":"c-1770270981283723438","created_at":"2026-02-04T21:56:21.283777669-08:00","source_type":"learned"},"when":{"file_path":"store/*","language":"go","task":"bug-identification"}},"metadata":{"confidence":0.66,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-662fa8c3dfb6","kind":"behavior","content":{"content":{"canonical":"Use a temporary directory when testing commands that could write data, to avoid polluting the real store","expanded":"When working on this type of task, avoid: Attempted to run test commands that could modify the real floop store in the working directory\n\nInstead: Use a temporary directory when testing commands that could write data, to avoid polluting the real store","structured":{"avoid":"Attempted to run test commands that could modify the real floop store in the working directory","prefer":"Use a temporary directory when testing commands that could write data, to avoid polluting the real store"}},"kind":"constraint","name":"learned/use-a-temporary-directory-when-testing-commands-th","provenance":{"correction_id":"correction-1769828032","created_at":"2026-01-30T18:53:52.514014357-08:00","source_type":"learned"},"when":{"task":"testing"}},"metadata":{"confidence":0.66,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-e98a675ef270","kind":"forgotten-behavior","content":{"content":{"canonical":"Background subagents do NOT inherit parent permissions - they require pre-approved permissions via ~/.claude/settings.json. Add \"Write:*\", \"Edit:*\", \"Task:*\" to permissions.allow array. This enables parallel worktree development with background agents.","expanded":"When working on this type of task, avoid: Assumed subagents inherit parent agent permissions automatically. When background subagents failed with \"Permission auto-denied (prompts unavailable)\", investigated complex solutions like passing allowedPrompts to Task tool.\n\nInstead: Background subagents do NOT inherit parent permissions - they require pre-approved permissions via ~/.claude/settings.json. Add \"Write:*\", \"Edit:*\", \"Task:*\" to permissions.allow array. This enables parallel worktree development with background agents.","structured":{"avoid":"Assumed subagents inherit parent agent permissions automatically. When background subagents failed with \"Permission auto-denied (prompts unavailable)\", investigated complex solutions like passing allowedPrompts to Task tool.","prefer":"Background subagents do NOT inherit parent permissions - they require pre-approved permissions via ~/.claude/settings.json. Add \"Write:*\", \"Edit:*\", \"Task:*\" to permissions.allow array. This enables parallel worktree development with background agents."}},"kind":"constraint","name":"learned/background-subagents-do-not-inherit-parent-permiss","provenance":{"correction_id":"correction-1769793901","source_type":"learned"},"when":{"file_path":"~/*","language":"json"}},"metadata":{"confidence":0.62,"forget_reason":"Superseded by behavior-subagent-merged","forgotten_at":"2026-02-07T19:08:18-08:00","forgotten_by":"nvandessel","original_kind":"behavior","priority":0,"scope":"both","stats":{"created_at":"2026-02-07T19:13:34-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T19:13:34-08:00"}}}
{"id":"behavior-b86932976d88","kind":"behavior","content":{"conflicts":null,"content":{"canonical":"Even for beads state sync and chore commits, create a feature branch and PR. The rule 'never merge directly to main' applies to ALL commits, not just code changes. Push back on plans that specify direct-to-main commits.","expanded":"When working on this type of task, avoid: Committed beads sync/housekeeping changes directly to main and pushed, following the plan without questioning it. Three commits went straight to main without a PR.\n\nInstead: Even for beads state sync and chore commits, create a feature branch and PR. The rule 'never merge directly to main' applies to ALL commits, not just code changes. Push back on plans that specify direct-to-main commits.","structured":{"avoid":"Committed beads sync/housekeeping changes directly to main and pushed, following the plan without questioning it. Three commits went straight to main without a PR.","prefer":"Even for beads state sync and chore commits, create a feature branch and PR. The rule 'never merge directly to main' applies to ALL commits, not just code changes. Push back on plans that specify direct-to-main commits."}},"kind":"constraint","name":"learned/even-for-beads-state-sync-and-chore-commits-creat","overrides":null,"provenance":{"correction_id":"c-1770570585979824699","created_at":"2026-02-08T09:09:45.979869293-08:00","source_type":"learned"},"requires":null,"when":{"environment":"development"}},"metadata":{"confidence":0.6,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:09:46-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:09:46-08:00"}}}
{"id":"behavior-b7f5d1378039","kind":"behavior","content":{"content":{"canonical":"Beads export state auto-updates with each commit hash. After final push, restore the export state file instead of committing it again to break the cycle.","expanded":"When working on this type of task, avoid: Committed beads export state changes in a loop, causing infinite commits\n\nInstead: Beads export state auto-updates with each commit hash. After final push, restore the export state file instead of committing it again to break the cycle.","structured":{"avoid":"Committed beads export state changes in a loop, causing infinite commits","prefer":"Beads export state auto-updates with each commit hash. After final push, restore the export state file instead of committing it again to break the cycle."}},"kind":"preference","name":"learned/beads-export-state-auto-updates-with-each-commit-h","provenance":{"correction_id":"c-1769581392105512844","created_at":"2026-01-27T22:23:12.106122549-08:00","source_type":"learned"},"when":{"task":"git workflow"}},"metadata":{"confidence":0.66,"priority":0,"scope":"local","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-a9a4b09dda1f","kind":"behavior","content":{"content":{"canonical":"Create explicit hooks in AGENTS.md that mandate tool usage - use WARNING/CRITICAL markers and 'READ FIRST' to ensure visibility","expanded":"When working on this type of task, avoid: Assumed agents would know when to use tools based on general context\n\nInstead: Create explicit hooks in AGENTS.md that mandate tool usage - use WARNING/CRITICAL markers and 'READ FIRST' to ensure visibility","structured":{"avoid":"Assumed agents would know when to use tools based on general context","prefer":"Create explicit hooks in AGENTS.md that mandate tool usage - use WARNING/CRITICAL markers and 'READ FIRST' to ensure visibility"}},"kind":"procedure","name":"learned/create-explicit-hooks-in-agents-md-that-mandate-to","provenance":{"correction_id":"c-1769578263708845277","created_at":"2026-01-27T21:31:03.709247071-08:00","source_type":"learned"},"when":{"task":"documentation"}},"metadata":{"confidence":0.66,"priority":0,"scope":"local","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-5d991c44bfa0","kind":"behavior","content":{"content":{"canonical":"Always use sub-agents (Task tool with appropriate subagent_type) for parallel and independent work items. The orchestrator should stay lean — delegate implementation, research, and repetitive operations to sub-agents. This preserves context for decision-making and coordination. For repetitive operations like wiring many edges, use a sub-agent with Bash to run CLI commands in batch.","expanded":"When working on this type of task, avoid: Tried to do all work in the main orchestrator context without delegating to sub-agents. This blew out the context window (reached 3% remaining) and prevented completing the task. Also attempted to use MCP tools that weren't registered in the running server.\n\nInstead: Always use sub-agents (Task tool with appropriate subagent_type) for parallel and independent work items. The orchestrator should stay lean — delegate implementation, research, and repetitive operations to sub-agents. This preserves context for decision-making and coordination. For repetitive operations like wiring many edges, use a sub-agent with Bash to run CLI commands in batch.","structured":{"avoid":"Tried to do all work in the main orchestrator context without delegating to sub-agents. This blew out the context window (reached 3% remaining) and prevented completing the task. Also attempted to use MCP tools that weren't registered in the running server.","prefer":"Always use sub-agents (Task tool with appropriate subagent_type) for parallel and independent work items. The orchestrator should stay lean — delegate implementation, research, and repetitive operations to sub-agents. This preserves context for decision-making and coordination. For repetitive operations like wiring many edges, use a sub-agent with Bash to run CLI commands in batch."}},"kind":"preference","name":"learned/always-use-sub-agents-task-tool-with-appropriate","provenance":{"correction_id":"c-1770405398129779923","created_at":"2026-02-06T11:16:38.129839204-08:00","source_type":"learned"},"when":{"environment":"development","task":"development"}},"metadata":{"confidence":0.67,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-worktrees-merged","kind":"behavior","content":{"content":{"canonical":"Create git worktrees in .worktrees/ directory at repo root for parallel agent work. This directory is in .gitignore so it won't pollute git status. When using subagents with worktrees, create them inside the repo so subagents can access them, or have the orchestrating agent manage branches/commits directly."},"kind":"directive","name":"learned/git-worktrees-best-practices","provenance":{"created_at":"2026-02-07T00:00:00-08:00","source_type":"merged"}},"metadata":{"confidence":0.72,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-floop-scope-merged","kind":"behavior","content":{"content":{"canonical":"Floop has two scopes: global (~/.floop/) for agent personal preferences across ALL projects, and local (./.floop/) for project-specific conventions. Use scope=both to save important learnings to both stores."},"kind":"preference","name":"learned/floop-scope-strategy","provenance":{"created_at":"2026-02-07T00:00:00-08:00","source_type":"merged"},"when":{"task":"configuration"}},"metadata":{"confidence":0.72,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-440356e972ee","kind":"behavior","content":{"content":{"canonical":"Agents should proactively use floop during conversations - capture corrections in real-time using own judgment and intuition","expanded":"When working on this type of task, avoid: Waited for explicit user instruction to use floop\n\nInstead: Agents should proactively use floop during conversations - capture corrections in real-time using own judgment and intuition","structured":{"avoid":"Waited for explicit user instruction to use floop","prefer":"Agents should proactively use floop during conversations - capture corrections in real-time using own judgment and intuition"}},"kind":"preference","name":"learned/agents-should-proactively-use-floop-during-convers","provenance":{"correction_id":"c-1769577665725545057","created_at":"2026-01-27T21:21:05.725931864-08:00","source_type":"learned"},"when":{"task":"development"}},"metadata":{"confidence":0.6950000000000001,"priority":0,"scope":"local","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-subagent-merged","kind":"behavior","content":{"content":{"canonical":"Background subagents do NOT inherit parent permissions - they require pre-approved permissions via ~/.claude/settings.json (add Write:*, Edit:*, Task:* to permissions.allow). For parallel work: have subagents do read-only tasks (research, exploration), or ensure permissions are pre-configured. Do not use workarounds that defeat parallel subagent work."},"kind":"constraint","name":"learned/subagent-permissions-and-parallel-work","provenance":{"created_at":"2026-02-07T00:00:00-08:00","source_type":"merged"}},"metadata":{"confidence":0.72,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
{"id":"behavior-0b09b561c160","kind":"forgotten-behavior","content":{"content":{"canonical":"Always close beads when completing associated work - beads should close with their work, not be left dangling","expanded":"When working on this type of task, avoid: Completed work without closing the associated beads\n\nInstead: Always close beads when completing associated work - beads should close with their work, not be left dangling","structured":{"avoid":"Completed work without closing the associated beads","prefer":"Always close beads when completing associated work - beads should close with their work, not be left dangling"}},"kind":"directive","name":"learned/always-close-beads-when-completing-associated-work","provenance":{"correction_id":"correction-1770083726","source_type":"learned"},"when":{"task":"project-management"}},"metadata":{"confidence":0.62,"forget_reason":"Superseded by behavior-beads-merged","forgotten_at":"2026-02-07T19:08:27-08:00","forgotten_by":"nvandessel","original_kind":"behavior","priority":0,"scope":"both","stats":{"created_at":"2026-02-07T19:13:34-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-07T19:13:34-08:00"}}}
{"id":"behavior-d92923c5a1e7","kind":"behavior","content":{"content":{"canonical":"Use 0700 for directories and 0600 for files containing sensitive data (databases, correction logs, config with API keys, session state, backups). Use os.CreateTemp instead of predictable .tmp suffixes to prevent symlink/TOCTOU attacks.","expanded":"When working on this type of task, avoid: Left file permissions at Go defaults (0755 dirs, 0644 files) for all .floop/ data including SQLite databases, correction logs, config files with API keys, and session state.\n\nInstead: Use 0700 for directories and 0600 for files containing sensitive data (databases, correction logs, config with API keys, session state, backups). Use os.CreateTemp instead of predictable .tmp suffixes to prevent symlink/TOCTOU attacks.","structured":{"avoid":"Left file permissions at Go defaults (0755 dirs, 0644 files) for all .floop/ data including SQLite databases, correction logs, config files with API keys, and session state.","prefer":"Use 0700 for directories and 0600 for files containing sensitive data (databases, correction logs, config with API keys, session state, backups). Use os.CreateTemp instead of predictable .tmp suffixes to prevent symlink/TOCTOU attacks."}},"kind":"preference","name":"learned/use-0700-for-directories-and-0600-for-files-contai","provenance":{"correction_id":"c-1770425640742094061","created_at":"2026-02-06T16:54:00.742138816-08:00","source_type":"learned"},"when":{"environment":"development","task":"development"}},"metadata":{"confidence":0.64,"priority":0,"scope":"both","stats":{"created_at":"2026-02-08T09:05:21-08:00","times_activated":0,"times_confirmed":0,"times_followed":0,"times_overridden":0,"updated_at":"2026-02-08T09:05:21-08:00"}}}
