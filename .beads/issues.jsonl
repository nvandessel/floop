{"id":"feedback-loop-02z","title":"Investigate subagent permission passing for parallel work","description":"Background subagents (run_in_background=true) fail with 'Permission auto-denied (prompts unavailable)' when trying to Write/Edit files. This defeats the purpose of parallel worktree-based development.\n\nCurrent workaround: Orchestrating agent does all writes (defeats parallelism purpose).\n\nNeed to investigate:\n1. Can allowedPrompts be passed to Task tool when spawning agents?\n2. Can permissions be pre-approved for specific worktree paths?\n3. Is there a way to run foreground parallel agents?\n4. Can we request this feature from Claude Code if not supported?\n\nThe goal is to enable true parallel implementation work across worktrees with subagents.","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-30T08:31:59.018182098-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-30T09:24:58.638696377-08:00","closed_at":"2026-01-30T09:24:58.638696377-08:00","close_reason":"Solved: Add permission rules to ~/.claude/settings.json with Write:* and Edit:* allows. Background subagents inherit these pre-approved permissions. Tested successfully."}
{"id":"feedback-loop-0gh","title":"Fix floop_active MCP tool schema for nullable when field","description":"The floop_active MCP tool fails with schema validation error when behaviors have null 'when' fields. Error: 'validating /properties/active/items/properties/when: type: \u003cinvalid reflect.Value\u003e has type \"null\", want \"object\"'. Need to update the JSON schema to allow when: null or when: {} for behaviors that apply globally.","status":"closed","priority":2,"issue_type":"bug","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-30T08:30:32.235848227-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-30T08:32:04.235618746-08:00","closed_at":"2026-01-30T08:32:04.235618746-08:00","close_reason":"Fixed by initializing When to empty map and adding omitempty tag"}
{"id":"feedback-loop-0k8","title":"Implement GraphStore interface and InMemoryGraphStore","description":"Create internal/store/store.go (GraphStore interface, Node, Edge, Direction types) and internal/store/memory.go (InMemoryGraphStore implementation). Follow patterns from SPEC.md. Include basic tests.","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:42:41.662269043-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-25T17:22:58.557952564-08:00","closed_at":"2026-01-25T17:22:58.557952564-08:00","close_reason":"Implemented GraphStore interface (store.go) and InMemoryGraphStore (memory.go) with full test coverage","dependencies":[{"issue_id":"feedback-loop-0k8","depends_on_id":"feedback-loop-mz2","type":"blocks","created_at":"2026-01-25T16:42:48.46298508-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-0o3","title":"Phase 2: Learning loop","status":"closed","priority":2,"issue_type":"epic","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:20:49.568156186-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-25T17:59:48.975649025-08:00","closed_at":"2026-01-25T17:59:48.975649025-08:00","close_reason":"Implemented Phase 2 Learning Loop: CorrectionCapture, BehaviorExtractor, GraphPlacer, LearningLoop orchestrator, and CLI integration"}
{"id":"feedback-loop-0p9","title":"Update MCP handlers for auto-merge","description":"Modify internal/mcp/handlers.go:\n\nUpdate floop_learn:\n- Add auto_merge parameter to FloopLearnInput\n- Update FloopLearnOutput with merge fields:\n  - Merged bool\n  - MergedIntoID string\n  - MergeSimilarity float64\n  - MergeReason string\n- Pass auto_merge to LearningLoop config\n\nAdd floop_deduplicate tool:\n- FloopDeduplicateInput: dry_run, threshold, scope\n- FloopDeduplicateOutput: duplicates found, merged, report\n- Calls Deduplicator.DeduplicateStore\n\nDepends on:\n- feedback-loop-8a5 (Auto-merge in LearningLoop)\n- feedback-loop-2pd (Deduplicator interface)","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:29:19.160621441-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-30T15:19:22.529619271-08:00","closed_at":"2026-01-30T15:19:22.529619271-08:00","close_reason":"Updated MCP handlers with auto-merge and floop_deduplicate tool","dependencies":[{"issue_id":"feedback-loop-0p9","depends_on_id":"feedback-loop-2pd","type":"blocks","created_at":"2026-01-29T19:34:34.592327321-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-0p9","depends_on_id":"feedback-loop-8a5","type":"blocks","created_at":"2026-01-29T19:37:23.749763482-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-0p9","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.945949798-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-0z3","title":"Implement floop CLI with version, init, and list commands","description":"Create cmd/floop/main.go with Cobra CLI setup. Implement: floop version (print version), floop init (create .floop/ directory with manifest.yaml), floop list (show all behaviors, support --json flag). Wire up to InMemoryGraphStore initially.","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:42:42.59939606-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-25T17:40:19.504820509-08:00","closed_at":"2026-01-25T17:40:19.504820509-08:00","close_reason":"CLI commands implemented and working (version, init, list, learn). Acceptance criteria met. Note: CLI is a standalone stub - integration with internal packages tracked in feedback-loop-7b0.","dependencies":[{"issue_id":"feedback-loop-0z3","depends_on_id":"feedback-loop-0k8","type":"blocks","created_at":"2026-01-25T16:42:49.916496606-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-20v","title":"Add task parameter to floop_learn MCP tool","description":"The CLI `floop learn` command accepts --task parameter but the MCP floop_learn tool doesn't include it in the schema. This limits context capture when using MCP.\n\n**CLI:**\n```\nfloop learn --wrong \"...\" --right \"...\" --task development\n```\n\n**MCP schema (internal/mcp/schema.go):**\nCurrently only has: wrong, right, file, auto_merge\n\n**Fix:** Add Task field to FloopLearnInput struct","status":"closed","priority":2,"issue_type":"bug","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-30T16:05:51.125909588-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-30T18:03:22.615096749-08:00","closed_at":"2026-01-30T18:03:22.615096749-08:00","close_reason":"Fixed in commit fd30a94"}
{"id":"feedback-loop-2bg","title":"Create project directory structure","description":"Set up the Go project structure: cmd/floop/, internal/{models,store,learning,activation,assembly}/, pkg/. Initialize go.mod with github.com/nvandessel/feedback-loop","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:40:21.411419485-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-25T16:42:02.051826564-08:00","closed_at":"2026-01-25T16:42:02.051826564-08:00","close_reason":"Directory structure created: cmd/floop/, internal/{models,store,learning,activation,assembly}/, pkg/types/. Removed old cmd/bg/ directory. go.mod already initialized."}
{"id":"feedback-loop-2pd","title":"Define Deduplicator interface","description":"Create internal/dedup/dedup.go with:\n- Deduplicator interface: FindDuplicates, MergeDuplicates, DeduplicateStore\n- DuplicateMatch struct with Behavior, Similarity, SimilarityMethod fields\n- DeduplicationReport struct for batch operations\n- DeduplicatorConfig with thresholds and LLM settings\n\nThis is the foundation for duplicate detection and merging.\n\nNo dependencies - can start in parallel with LLM package.","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:27:54.772345701-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T20:19:32.97782686-08:00","closed_at":"2026-01-29T20:19:32.97782686-08:00","close_reason":"Implemented Deduplicator interface with FindDuplicates, MergeDuplicates, DeduplicateStore methods. Added DuplicateMatch, DeduplicationReport, DeduplicatorConfig types with tests.","dependencies":[{"issue_id":"feedback-loop-2pd","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.373656596-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-2vt","title":"Create floop integration documentation structure","description":"Create docs/integrations/ directory structure with README.md overview and templates/ directory for tool-specific configuration templates.\n\n## Deliverables\n1. `docs/integrations/README.md` - Overview of integration options\n2. `docs/integrations/templates/` - Template configuration files\n3. Update main README.md to reference integration docs\n\n## Structure\n```\ndocs/integrations/\n├── README.md           # Overview and quick-start\n├── claude-code.md      # (separate bead)\n├── codex.md            # (separate bead)\n├── aider.md            # (separate bead)\n├── cursor.md           # (separate bead)\n├── cline.md            # (separate bead)\n├── continue.md         # (separate bead)\n├── windsurf.md         # (separate bead)\n├── github-copilot.md   # (separate bead)\n└── templates/\n    ├── AGENTS.md.template\n    ├── CONVENTIONS.md.template\n    └── mcp-config.json.template\n```","status":"open","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:21:46.928298747-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T19:43:04.441837013-08:00"}
{"id":"feedback-loop-3er","title":"Write Cline integration guide","description":"Create comprehensive integration guide for Cline VS Code extension.\n\n## Research Findings (from e2d investigation)\n\n### Extension Points\n1. **.clinerules/** - Directory of markdown rule files\n2. **Hooks** (v3.36+) - `TaskStart`, `UserPromptSubmit`, `PostToolUse`, etc.\n3. **Memory Bank** - Community pattern for persistent context\n4. **MCP servers** - Full MCP support\n5. **AI-editable rules** - Cline can modify its own .clinerules\n\n### Hooks (Best for floop - macOS/Linux only)\n- `TaskStart` - Load behaviors at task start\n- `UserPromptSubmit` - Detect corrections\n- Hooks receive JSON input, output `{\"cancel\": bool, \"contextModification\": string}`\n\n### Deliverables\n1. `docs/integrations/cline.md` - Full guide with:\n   - Overview of Cline extension mechanisms\n   - Quick start with .clinerules\n   - Full configuration with hooks\n   - Memory Bank integration\n   - MCP server option\n   - Troubleshooting\n2. `templates/cline/` directory with:\n   - `floop.md` rules template\n   - Hook scripts (TaskStart, UserPromptSubmit)\n   - MCP config template\n\n### Key Hooks Example\n```bash\n#\\!/bin/bash\n# .clinerules/hooks/TaskStart\ninput=$(cat)\ntask=$(echo \"$input\" | jq -r '.taskDescription')\nbehaviors=$(floop active --task \"$task\" --json)\njq -n --arg ctx \"FLOOP BEHAVIORS: $behaviors\" '{\"cancel\":false,\"contextModification\":$ctx}'\n```\n\n### Limitations\n- Hooks are macOS/Linux ONLY (Windows not supported)\n- Requires Cline v3.36+\n- Memory Bank is convention, not built-in feature\n- Paths with spaces may cause hook failures\n\n### Sources\n- https://docs.cline.bot/features/hooks\n- https://docs.cline.bot/features/cline-rules\n- https://docs.cline.bot/prompting/cline-memory-bank","status":"open","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:32:16.60516401-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T19:43:04.978031131-08:00"}
{"id":"feedback-loop-3l3","title":"Write GitHub Copilot integration guide","description":"Create integration guide for GitHub Copilot (limited integration).\n\n## Research Findings (from e2d investigation)\n\n### Extension Points\n1. **.github/copilot-instructions.md** - Repository-wide instructions (TEXT ONLY)\n2. **.github/instructions/*.instructions.md** - Path-specific instructions with YAML frontmatter\n3. **Organization instructions** - Team-wide defaults (Enterprise only)\n4. **copilot-setup-steps.yml** - Pre-install tools for Coding Agent\n5. **MCP servers** - For Agent Mode only\n\n### Critical Limitation\n**Copilot cannot execute shell commands** in standard Chat/Edit modes. Instructions are TEXT GUIDANCE ONLY.\n\n### Agent Mode (Best for floop)\n- Can execute terminal commands with approval\n- MCP server integration available\n- Requires explicit user invocation\n\n### Deliverables\n1. `docs/integrations/github-copilot.md` - Full guide with:\n   - Clear limitations section upfront\n   - Static instructions setup\n   - Agent Mode integration\n   - MCP server option (requires floop mcp-server)\n   - copilot-setup-steps.yml for Coding Agent\n   - Troubleshooting\n2. `templates/github-copilot/` directory with:\n   - `copilot-instructions.md` template\n   - `go-files.instructions.md` example\n   - `copilot-setup-steps.yml` template\n\n### Key Instruction Example\n```markdown\n# .github/copilot-instructions.md\n## Behavior Learning\nThis repo uses floop. Before implementing changes, remind the user to run:\nfloop active --file \"$FILE\" --task \"$TASK\" --json\n```\n\n### Limitations (CRITICAL)\n- Standard Copilot CANNOT execute commands\n- Instructions are guidance text only\n- No hooks or callbacks\n- Agent Mode required for any automation\n- MCP only available in VS Code Agent Mode\n\n### Sources\n- https://docs.github.com/copilot/customizing-copilot/adding-custom-instructions-for-github-copilot\n- https://github.blog/ai-and-ml/github-copilot/agent-mode-101/\n- https://docs.github.com/en/copilot/how-tos/use-copilot-agents/coding-agent/customize-the-agent-environment","status":"open","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:34:28.393176091-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T19:43:05.21183168-08:00"}
{"id":"feedback-loop-43i","title":"Write LLM package tests","description":"Create internal/llm/*_test.go files:\n- client_test.go: Test ComparisonResult, MergeResult types\n- prompts_test.go: Test prompt generation and response parsing\n- fallback_test.go: Test Jaccard similarity calculations\n- anthropic_test.go: Test API request/response parsing (mock HTTP)\n- openai_test.go: Test API request/response parsing (mock HTTP)\n\nUse table-driven tests following Go guidelines.\n\nDepends on:\n- feedback-loop-r0v (Subagent client)\n- feedback-loop-a7p (Fallback client)\n- feedback-loop-mgv (Mock client)","status":"closed","priority":3,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:29:32.347536747-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-01T18:14:47.889441232-08:00","closed_at":"2026-02-01T18:14:47.889441232-08:00","close_reason":"Tests exist: client_test.go, fallback_test.go, prompts_test.go, subagent_test.go - coverage at 44%","dependencies":[{"issue_id":"feedback-loop-43i","depends_on_id":"feedback-loop-mgv","type":"blocks","created_at":"2026-01-29T19:42:25.485815913-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-43i","depends_on_id":"feedback-loop-r0v","type":"blocks","created_at":"2026-01-29T19:42:25.742962518-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-43i","depends_on_id":"feedback-loop-a7p","type":"blocks","created_at":"2026-01-29T19:42:25.820230905-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-43i","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:39.105390875-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-6da","title":"Document Phase 1 implementation plan","description":"Break down Phase 1 epic into concrete implementation steps with clear acceptance criteria. Create sub-tasks for each component: models, store interface, memory store, CLI commands.","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:40:24.891068477-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-25T16:43:19.959743792-08:00","closed_at":"2026-01-25T16:43:19.959743792-08:00","close_reason":"Created docs/PLAN.md with detailed Phase 1 breakdown. Created beads for: models (mz2), store (0k8), CLI (0z3). Set up dependencies to enforce implementation order."}
{"id":"feedback-loop-6jz","title":"Write Continue.dev integration guide","description":"Create comprehensive integration guide for Continue.dev.\n\n## Research Findings (from e2d investigation)\n\n### Extension Points\n1. **config.yaml** - Main configuration (`~/.continue/config.yaml`)\n2. **Rules** - Markdown files with frontmatter (`~/.continue/rules/` or `.continue/rules/`)\n3. **MCP servers** - Full MCP support (`.continue/mcpServers/*.yaml`)\n4. **Slash commands/prompts** - Custom `/commands`\n5. **Tool permissions** - `~/.continue/permissions.yaml`\n\n### MCP Server (Best for floop)\n- Expose floop as MCP tools: `floop_active`, `floop_learn`\n- MCP only works in Agent mode (not Chat/Edit modes)\n\n### Deliverables\n1. `docs/integrations/continue.md` - Full guide with:\n   - Overview of Continue extension mechanisms\n   - Quick start with rules\n   - Full configuration with MCP server\n   - Tool permissions setup\n   - Troubleshooting\n2. `templates/continue/` directory with:\n   - `floop.md` rules template\n   - `floop.yaml` MCP server config\n   - `permissions.yaml` template\n\n### Key MCP Config Example\n```yaml\n# .continue/mcpServers/floop.yaml\nname: Floop Behavior Learning\nversion: 0.0.1\nschema: v1\nmcpServers:\n  - name: floop\n    command: floop\n    args: [mcp-server]\n```\n\n### Limitations\n- MCP only works in Agent mode\n- No automatic pre-task hooks\n- Rules are static text (cannot execute code)\n- Context providers must be manually invoked with @\n\n### Sources\n- https://docs.continue.dev/customize/deep-dives/mcp\n- https://docs.continue.dev/customize/deep-dives/rules\n- https://docs.continue.dev/guides/cli","status":"open","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:33:04.031387137-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T19:43:04.898031108-08:00"}
{"id":"feedback-loop-72j","title":"Implement floop generate command for static summary","description":"Implement `floop generate` command to output static summary files for tools that prefer reading files over executing commands.\n\n## Background\n\nSome AI tools (especially Aider) work better with static context files that can be cached. This command generates a markdown summary of active behaviors that can be loaded with `--read`.\n\n## Deliverables\n\n### 1. New Command: `floop generate`\nGenerate static summary files from floop data.\n\n### Subcommands/Flags\n| Flag | Output |\n|------|--------|\n| `--summary` | Markdown summary of all behaviors |\n| `--active` | Markdown of currently active behaviors |\n| `--format md\\|json\\|yaml` | Output format (default: md) |\n| `--output FILE` | Write to file instead of stdout |\n\n### 2. Example Usage\n```bash\n# Generate summary for Aider\nfloop generate --summary \u003e .floop/BEHAVIORS.md\n\n# Generate active context before starting work\nfloop generate --active --file main.go --task refactor \u003e .floop/active-context.md\n\n# In .aider.conf.yml\nread:\n  - .floop/BEHAVIORS.md\n```\n\n### 3. Output Format (Markdown)\n```markdown\n# floop Learned Behaviors\n\nGenerated: 2026-01-27T10:00:00Z\nTotal behaviors: 5\n\n## Active Behaviors\n\n### [preference] Use uv instead of pip\n- **When:** language=python\n- **Avoid:** using pip for dependencies\n- **Prefer:** use uv instead\n- **Confidence:** 0.8\n\n### [directive] Always wrap errors with context\n- **When:** language=go\n- **Do:** wrap errors with fmt.Errorf(\"context: %w\", err)\n- **Confidence:** 0.9\n\n## All Behaviors\n[Full list...]\n```\n\n### 4. Integration with Aider Workflow\n```bash\n#!/bin/bash\n# aider-floop wrapper\nfloop generate --active --file \"$1\" --task \"$2\" \u003e .floop/active-context.md\naider --read .floop/active-context.md \"$@\"\n```\n\n## Dependencies\n- Requires behaviors to be queryable (Phase 2+)\n\n## Testing\n- Test markdown output formatting\n- Test JSON/YAML output\n- Test file writing with --output","status":"closed","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:42:35.573287521-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T19:43:05.286343715-08:00","closed_at":"2026-01-28T21:31:50.774703565-08:00","close_reason":"Deprioritized in favor of MCP server (feedback-loop-ol7). Static file generation is read-only and manual; MCP provides bidirectional, automatic integration. Primary users (AI agents) benefit more from live protocol than static snapshots. Can revisit if specific tool integration requires it."}
{"id":"feedback-loop-7b0","title":"Wire CLI to use internal/models and internal/store","description":"The CLI currently works as a standalone stub writing raw JSONL. It needs to be integrated with:\n- internal/models (Correction, Behavior types)\n- internal/store (InMemoryGraphStore)\n\nThis connects Phase 1's two disconnected pieces: the tested internal packages and the working CLI stub.\n\nAcceptance criteria:\n- floop learn uses models.Correction\n- floop list reads from GraphStore\n- CLI has test coverage \u003e0%","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T17:40:10.852594486-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-25T17:45:20.675006064-08:00","closed_at":"2026-01-25T17:45:20.675006064-08:00","close_reason":"Wired CLI to internal/models and store: learn uses models.Correction, list parses into []models.Correction, CLI test coverage at 60.2%"}
{"id":"feedback-loop-8a5","title":"Add auto-merge to LearningLoop","description":"Modify internal/learning/loop.go:\n- Add to LearningLoopConfig: AutoMerge, AutoMergeThreshold, LLMClient\n- Inject Deduplicator into learningLoop struct\n- Modify ProcessCorrection:\n  1. Extract candidate behavior (existing)\n  2. NEW: Check for duplicates with deduplicator.FindDuplicates\n  3. If duplicates found AND similarity \u003e threshold AND AutoMerge enabled:\n     - Call deduplicator.MergeDuplicates\n     - Return MergedIntoExisting result\n  4. Continue with normal flow if no merge\n- Add LearningResult fields: MergedIntoExisting, MergedBehaviorID, MergeSimilarity\n\nOutput visibility for auto-merge:\n- Clear console output showing merge happened\n- JSON includes merged: true, merged_into, similarity\n\nDepends on:\n- feedback-loop-2pd (Deduplicator interface)\n- feedback-loop-9ie (BehaviorMerger)\n- feedback-loop-ily (Enhanced GraphPlacer)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:29:03.410286049-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T22:42:19.337802304-08:00","closed_at":"2026-01-29T22:42:19.337802304-08:00","close_reason":"Added AutoMerge config, Deduplicator injection, tryAutoMerge in ProcessCorrection","dependencies":[{"issue_id":"feedback-loop-8a5","depends_on_id":"feedback-loop-2pd","type":"blocks","created_at":"2026-01-29T19:34:34.431507488-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-8a5","depends_on_id":"feedback-loop-9ie","type":"blocks","created_at":"2026-01-29T19:34:34.761145125-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-8a5","depends_on_id":"feedback-loop-ily","type":"blocks","created_at":"2026-01-29T19:37:23.666819672-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-8a5","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.784733577-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-8jt","title":"Define LLMClient interface and types","description":"Create internal/llm/client.go with:\n- LLMClient interface with CompareBehaviors, MergeBehaviors, Available methods\n- ComparisonResult struct with SemanticSimilarity, IntentMatch, MergeCandidate fields\n- MergeResult struct for merged behavior output\n- ClientConfig for API settings\n\nThis is the foundation for all LLM implementations (fallback, Anthropic, OpenAI).","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:27:21.600221908-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T20:19:31.927803779-08:00","closed_at":"2026-01-29T20:19:31.927803779-08:00","close_reason":"Implemented LLMClient interface with CompareBehaviors, MergeBehaviors, Available methods. Added ComparisonResult, MergeResult, ClientConfig types with tests.","dependencies":[{"issue_id":"feedback-loop-8jt","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:37.895995349-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-99r","title":"Add input validation to learn command","description":"The `floop learn` command accepts empty --wrong flag without validation, creating behaviors with empty corrections.\n\n**Reproduce:**\n```bash\nfloop learn --wrong \"\" --right \"test\"\n```\n\nCreates a behavior named \"learned/test\" with no wrong context.\n\n**Fix:** Validate that both --wrong and --right are non-empty in cmd/floop/main.go newLearnCmd()","status":"closed","priority":3,"issue_type":"bug","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-30T16:07:06.646653309-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-30T18:53:46.918065143-08:00","closed_at":"2026-01-30T18:53:46.918065143-08:00","close_reason":"Fixed in commit 75510ba - validation exists at cmd/floop/main.go:184-190"}
{"id":"feedback-loop-9a6","title":"Dogfooding validation before documentation","description":"Validate floop implementation through real usage before writing documentation.\n\n## Dogfooding Status ✅ VALIDATED\n\n### Phase 1: Core CLI ✅ COMPLETE\nAll commands work after rebuild:\n- [x] floop init - creates .floop/ directory\n- [x] floop learn - captures corrections\n- [x] floop list - shows behaviors  \n- [x] floop active - context-aware activation\n- [x] floop prompt - generates prompts\n- [x] floop show - detailed behavior view\n- [x] floop why - explains activation\n\n### Phase 2: New Features ✅ COMPLETE (after rebuild)\n- [x] floop deduplicate --dry-run  \n- [x] floop deduplicate (actual merge)\n- [x] floop config set/get/list\n- [ ] Auto-merge on learn - needs LLM configured\n\n### Phase 3: MCP Tools ⚠️ MOSTLY WORKING\n- [x] floop_active - fix exists, needs MCP server restart\n- [x] floop_learn - works (missing task param - feedback-loop-20v)\n- [x] floop_list - works\n- [ ] floop_deduplicate - schema exists but not registered in Claude\n\n### Phase 4: LLM Clients ⏳ NOT TESTED\n- [ ] Anthropic client - needs API key config\n- [ ] OpenAI client - needs API key config\n- [x] Fallback when no API key - works (uses Jaccard)\n\n### Phase 5: Edge Cases ⚠️ MINOR ISSUES\n- [x] Empty store operations - graceful\n- [ ] Invalid input handling - empty --wrong accepted (feedback-loop-99r)\n- [x] Cross-store deduplication - works\n\n## Issues Found\n- feedback-loop-20v: MCP floop_learn missing task parameter (P2)\n- feedback-loop-99r: learn accepts empty --wrong (P3)\n- Binary was stale - need to rebuild before testing","status":"closed","priority":1,"issue_type":"epic","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-30T15:50:44.266167406-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-01T18:14:46.088471185-08:00","closed_at":"2026-02-01T18:14:46.088471185-08:00","close_reason":"Dogfooding validation complete - all CLI commands, MCP tools, and core features verified working per epic description","comments":[{"id":1,"issue_id":"feedback-loop-9a6","author":"Nic van Dessel","text":"MCP Phase 3 is now COMPLETE - verified floop_deduplicate works via MCP (2026-01-30). All 4 tools functional: floop_active, floop_learn, floop_list, floop_deduplicate.","created_at":"2026-01-31T02:13:39Z"}]}
{"id":"feedback-loop-9cq","title":"Write Aider integration guide","description":"Create comprehensive integration guide for Aider.\n\n## Research Findings (from e2d investigation)\n\n### Extension Points\n1. **CONVENTIONS.md** - Coding conventions loaded via `--read` or `/read` command\n2. **.aider.conf.yml** - Configuration file (global: `~/.aider.conf.yml`, project: `./.aider.conf.yml`)\n3. **Prompt caching** - Read-only files are cached with `--cache-prompts`\n4. **/run command** - Execute shell commands (but no pre/post hooks)\n\n### Recommended Integration (Wrapper + CONVENTIONS.md)\n- Create CONVENTIONS.md with floop instructions\n- Use wrapper script to run `floop active` before starting Aider\n- Configure .aider.conf.yml to auto-load floop context file\n\n### Deliverables\n1. `docs/integrations/aider.md` - Full guide with:\n   - Overview of Aider extension mechanisms\n   - Quick start with CONVENTIONS.md\n   - Full configuration with wrapper script\n   - Prompt caching optimization\n   - Troubleshooting\n2. `templates/aider/` directory with:\n   - `CONVENTIONS.md` template\n   - `.aider.conf.yml` template\n   - `aider-floop` wrapper script\n\n### Key Config Example\n```yaml\n# .aider.conf.yml\nread:\n  - CONVENTIONS.md\n  - .floop/active-context.md\ncache-prompts: true\ncache-keepalive-pings: 1\n```\n\n### Limitations\n- NO pre-edit hooks (only post-edit lint/test)\n- NO custom slash commands (feature requested)\n- Must use wrapper script for automatic floop invocation\n- Config file MUST be .yml not .yaml\n\n### Sources\n- https://aider.chat/docs/usage/conventions.html\n- https://aider.chat/docs/config/aider_conf.html\n- https://aider.chat/docs/usage/caching.html","status":"open","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:31:30.836191061-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T19:43:04.59181139-08:00"}
{"id":"feedback-loop-9ie","title":"Implement BehaviorMerger","description":"Create internal/dedup/merger.go with:\n- BehaviorMerger struct with LLMClient and fallback logic\n- MergeBehaviors: Combines multiple behaviors into one\n  - Union of when conditions\n  - Higher confidence wins\n  - Merge provenance tracking\n- Rule-based merge when LLM unavailable\n- LLM-assisted merge for smart content combination\n\nDepends on:\n- feedback-loop-2pd (Deduplicator interface)\n- feedback-loop-8jt (LLMClient interface for LLM-assisted merge)","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:28:12.218211834-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T22:37:36.67272886-08:00","closed_at":"2026-01-29T22:37:36.67272886-08:00","close_reason":"Created merger.go with LLM-assisted and rule-based merge fallback","dependencies":[{"issue_id":"feedback-loop-9ie","depends_on_id":"feedback-loop-2pd","type":"blocks","created_at":"2026-01-29T19:34:34.279010244-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-9ie","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.465047512-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-9pd","title":"Implement Anthropic API client","description":"Create internal/llm/anthropic.go with:\n- AnthropicClient implementing LLMClient interface\n- Direct Anthropic API calls using claude-3-haiku for comparison\n- API key loading from config/environment\n- Timeout handling and retry logic\n- JSON response parsing\n\nFor standalone CLI usage when not running inside an agentic session.\n\nDepends on: \n- feedback-loop-8jt (LLMClient interface)\n- feedback-loop-cok (Shared prompts)","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:27:43.706625697-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-30T12:57:56.903231325-08:00","closed_at":"2026-01-30T12:57:56.903231325-08:00","close_reason":"Implemented AnthropicClient in internal/llm/anthropic.go","dependencies":[{"issue_id":"feedback-loop-9pd","depends_on_id":"feedback-loop-8jt","type":"blocks","created_at":"2026-01-29T19:31:58.589682077-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-9pd","depends_on_id":"feedback-loop-cok","type":"blocks","created_at":"2026-01-29T19:32:28.743173749-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-9pd","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.129193757-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-a7p","title":"Implement fallback rule-based client","description":"Create internal/llm/fallback.go with:\n- FallbackClient implementing LLMClient interface\n- Wraps existing Jaccard word similarity from place.go\n- computeContentSimilarity, computeWhenOverlap methods\n- Available() always returns false (triggers fallback in selection logic)\n\nThis ensures the system works even without LLM access.\n\nDepends on: feedback-loop-8jt (LLMClient interface)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:27:38.306014266-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T21:09:55.47584765-08:00","closed_at":"2026-01-29T21:09:55.47584765-08:00","close_reason":"Created fallback.go implementing Client interface with Jaccard similarity","dependencies":[{"issue_id":"feedback-loop-a7p","depends_on_id":"feedback-loop-8jt","type":"blocks","created_at":"2026-01-29T19:31:58.510031011-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-a7p","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.053562425-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-acx","title":"Implement behavior curation commands (forget, merge, deprecate)","description":"Add CLI commands for managing/curating learned behaviors:\n\n## Commands Needed\n\n### floop forget \u003cid\u003e\n- Remove a behavior entirely from the graph\n- Should prompt for confirmation unless --force\n- Record who deleted and why in audit log\n\n### floop merge \u003cid1\u003e \u003cid2\u003e\n- Combine two similar behaviors into one\n- Interactively resolve conflicts (which 'when' conditions, which content)\n- Keep provenance chain from both source behaviors\n- Delete the source behaviors after merge\n\n### floop deprecate \u003cid\u003e --reason '...'\n- Soft-delete: mark behavior as deprecated, not active\n- Keeps history/provenance for learning\n- Can be undone with floop restore \u003cid\u003e\n\n### floop restore \u003cid\u003e\n- Restore a deprecated behavior\n\n## Design Considerations\n- The GraphStore already has DeleteNode, but CLI needs confirmation flows\n- RejectPending exists but only works for pending behaviors\n- Need to handle behaviors that are referenced by other behaviors (conflicts/overrides/requires edges)\n- Should merge update similarity scores for related behaviors?\n\n## Future Considerations\n- Automatic decay: behaviors that are never activated could auto-deprecate after N days\n- Consolidation: periodic job to suggest merges for similar behaviors\n- Prune: remove deprecated behaviors older than X days\n\nDepends on Phase 2 (learning loop) being complete first.","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T17:47:10.546401306-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-28T21:31:33.303624927-08:00","closed_at":"2026-01-28T21:31:33.303624927-08:00","close_reason":"All curation commands implemented and working: forget, merge, deprecate, restore. Updated to use MultiGraphStore in ek2.8. Commands verified in CLI help."}
{"id":"feedback-loop-akm","title":"Update AGENTS.md for feedback-loop project","description":"Clean up AGENTS.md to be project-specific: include floop usage, Go guidelines reference, testing requirements, and proper development workflow. Remove generic bv boilerplate.","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:48:13.494669877-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-25T16:53:12.682644198-08:00","closed_at":"2026-01-25T16:53:12.682644198-08:00","close_reason":"Rewrote AGENTS.md with project-specific workflow: floop dogfooding, beads integration, Go guidelines reference, testing requirements, and session protocol."}
{"id":"feedback-loop-aq1","title":"Write Claude Code integration guide","description":"Create comprehensive integration guide for Claude Code.\n\n## Research Findings (from e2d investigation)\n\n### Extension Points\n1. **CLAUDE.md / AGENTS.md** - Project instructions loaded at session start\n2. **Hooks** (`.claude/settings.json`) - `SessionStart`, `UserPromptSubmit`, `PreToolUse`, `PostToolUse`, `Stop`\n3. **Skills** (`.claude/skills/\u003cname\u003e/SKILL.md`) - Custom slash commands\n4. **Subagents** (`.claude/agents/\u003cname\u003e.md`) - Specialized agents\n\n### Recommended Integration (Hybrid Approach)\n- **SessionStart hook**: Load active behaviors at startup\n- **Stop hook (prompt-based)**: Detect corrections needing capture  \n- **Skills**: Manual `/floop-learn` and `/floop-check` commands\n\n### Deliverables\n1. `docs/integrations/claude-code.md` - Full guide with:\n   - Overview of extension mechanisms\n   - Quick start (minimal setup)\n   - Full configuration (hooks + skills)\n   - Example hook scripts\n   - Troubleshooting\n2. `templates/claude-code/` directory with:\n   - `settings.json` template\n   - Hook scripts (`floop-session-start.sh`, etc.)\n   - `SKILL.md` templates\n\n### Key Config Example\n```json\n{\n  \"hooks\": {\n    \"SessionStart\": [{\n      \"hooks\": [{\n        \"type\": \"command\",\n        \"command\": \"\\\"$CLAUDE_PROJECT_DIR\\\"/.claude/hooks/floop-session-start.sh\"\n      }]\n    }]\n  }\n}\n```\n\n### Sources\n- https://code.claude.com/docs/en/hooks\n- https://code.claude.com/docs/en/skills\n- https://code.claude.com/docs/en/sub-agents","status":"closed","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:25:57.867120547-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-01T18:14:54.259185442-08:00","closed_at":"2026-02-01T18:14:54.259185442-08:00","close_reason":"Claude Code integration guide exists at docs/integrations/claude-code.md (348 lines covering hooks and MCP setup)"}
{"id":"feedback-loop-chy","title":"Spreading Activation Memory System","description":"# Epic: Spreading Activation Memory System\n\n## Vision\nTransform floop from static front-loaded behavior injection into a brain-like dynamic memory system using spreading activation. Memories activate contextually throughout a session, spread to related memories with decaying intensity, and intelligently manage context window budget.\n\n## Inspiration\nBased on the SYNAPSE paper (arxiv 2601.02744) which demonstrates spreading activation for LLM agent memory with 95% token reduction while achieving higher accuracy than full-context methods.\n\n## Key Concepts\n- **Spreading Activation**: Activation energy propagates from seed nodes through weighted graph edges, decaying with distance\n- **Lateral Inhibition**: Highly activated nodes suppress competitors, preventing activation from dispersing everywhere\n- **Temporal Decay**: Edge weights decay exponentially over time, naturally downweighting stale memories\n- **Multi-Resolution**: Directly activated memories get full detail, nearby memories get summaries, distant ones get names only\n- **Dynamic Injection**: Context changes (file type, intent, task) trigger re-evaluation and re-injection of relevant memories\n- **Session Awareness**: Track what's been injected to prevent bloat while allowing strategic reinforcement\n\n## SYNAPSE → Floop Mapping\n- Episodic nodes → Corrections (specific interaction memories)\n- Semantic nodes → Behaviors (abstract learned rules)\n- Temporal edges → Edge timestamps + decay function\n- Association edges → similar-to edges (already exist)\n- Abstraction edges → learned-from edges (correction → behavior)\n\n## Scoring Formula (from SYNAPSE)\nScore = 0.5 × semantic_similarity + 0.3 × activation_level + 0.2 × PageRank\n\n## Phases\n1. **Foundation**: Edge weights, activation engine, seed selection\n2. **Dynamic Injection**: Session state, hook-based detection, multi-resolution output\n3. **Intelligence**: Lateral inhibition, hybrid scoring, reinforcement logic\n\n## Success Criteria\n- [ ] Memories activate dynamically as context changes during a session\n- [ ] Nearby/related memories surface at appropriate detail levels\n- [ ] Context window usage stays within budget despite dynamic injection\n- [ ] Agent (Claude) reports improved relevance of injected behaviors\n- [ ] Sub-agents can independently activate context relevant to their focus\n\n## References\n- SYNAPSE: https://arxiv.org/abs/2601.02744\n- HippoRAG: https://github.com/OSU-NLP-Group/HippoRAG\n- GraphRAG Spreading Activation: https://arxiv.org/abs/2512.15922","status":"closed","priority":1,"issue_type":"epic","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-05T21:19:04.284640423-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T09:52:49.028378981-08:00","closed_at":"2026-02-06T09:52:49.028378981-08:00","close_reason":"All 9 subtasks implemented and merged. Spreading activation memory system complete with: schema v3, activation engine, seed selection, session state, dynamic hooks, multi-resolution output, lateral inhibition, hybrid scoring, and smart reinforcement."}
{"id":"feedback-loop-chy.1","title":"Add edge weights and temporal metadata to graph schema","description":"# Schema v3: Edge Weights + Temporal Metadata\n\n## Context\nThe edges table currently has: source, target, kind, metadata (JSON). For spreading activation, edges need explicit weights and timestamps so activation energy can decay over time and propagate with variable strength.\n\n## Files to Modify\n\n### 1. `internal/store/store.go` — Update Edge struct\n\nCurrent Edge struct:\n```go\ntype Edge struct {\n    Source   string                 `json:\"source\"`\n    Target   string                `json:\"target\"`\n    Kind     string                `json:\"kind\"`\n    Metadata map[string]interface{} `json:\"metadata,omitempty\"`\n}\n```\n\nAdd fields:\n```go\ntype Edge struct {\n    Source    string                 `json:\"source\"`\n    Target   string                 `json:\"target\"`\n    Kind     string                 `json:\"kind\"`\n    Weight   float64                `json:\"weight\"`              // NEW: 0.0-1.0, activation transmission factor\n    CreatedAt  time.Time            `json:\"created_at\"`          // NEW: when edge was created\n    LastActivated *time.Time        `json:\"last_activated,omitempty\"` // NEW: when activation last flowed through\n    Metadata map[string]interface{} `json:\"metadata,omitempty\"`\n}\n```\n\n### 2. `internal/store/schema.go` — Add migration v2→v3\n\nUpdate `SchemaVersion` from 2 to 3.\n\nAdd `migrateV2ToV3` function:\n```go\nfunc migrateV2ToV3(ctx context.Context, db *sql.DB) error {\n    // Add columns to edges table:\n    // - weight REAL DEFAULT 1.0\n    // - created_at TEXT DEFAULT (datetime('now'))\n    // - last_activated TEXT\n    // Use same idempotent column-add pattern from migrateV1ToV2\n    // Backfill existing edges: weight=1.0, created_at=now\n}\n```\n\nUpdate `migrateSchema` to call `migrateV2ToV3` when `currentVersion \u003c 3`.\n\nUpdate `schemaV1` (the base schema) to include the new columns in the edges table definition so new databases get them directly:\n```sql\nCREATE TABLE IF NOT EXISTS edges (\n    source TEXT NOT NULL,\n    target TEXT NOT NULL,\n    kind TEXT NOT NULL,\n    weight REAL DEFAULT 1.0,\n    created_at TEXT DEFAULT (datetime('now')),\n    last_activated TEXT,\n    metadata TEXT,\n    PRIMARY KEY (source, target, kind)\n);\n```\n\n### 3. `internal/store/sqlite.go` — Update edge operations\n\n**AddEdge**: Write weight, created_at, last_activated to new columns. Default weight=1.0 if Edge.Weight is 0 (zero value). Set CreatedAt to time.Now() if zero.\n\n**GetEdges**: Read weight, created_at, last_activated from new columns. Populate Edge struct fields. Handle NULL values for last_activated.\n\n**Traverse**: No changes needed yet (spreading engine will handle weighted traversal separately).\n\n**exportEdgesToJSONL / importEdgesFromJSONL**: Include new fields in serialization. Handle missing fields in old JSONL files gracefully (default weight=1.0).\n\n### 4. `internal/store/multi.go` — No changes needed\nMultiGraphStore delegates to underlying stores. Edge struct changes flow through automatically.\n\n### 5. `internal/ranking/decay.go` — Add temporal edge decay function\n\nAdd:\n```go\n// EdgeDecay calculates the effective weight of an edge based on temporal decay.\n// Returns weight * e^(-rho * elapsed_hours) where rho is the decay rate.\n// Default rho=0.01 means ~1% decay per hour, ~21% decay per day.\nfunc EdgeDecay(weight float64, lastActivated time.Time, rho float64) float64 {\n    elapsed := time.Since(lastActivated).Hours()\n    return weight * math.Exp(-rho * elapsed)\n}\n\nconst DefaultDecayRate = 0.01\n```\n\n### 6. Tests — `internal/store/sqlite_test.go`\n\nAdd test cases following existing table-driven patterns:\n\n```go\nfunc TestSQLiteGraphStore_EdgeWeights(t *testing.T) {\n    // Test adding edge with weight\n    // Test default weight (0 → 1.0)\n    // Test reading edge weight back\n    // Test last_activated field\n}\n\nfunc TestSQLiteGraphStore_SchemaV3Migration(t *testing.T) {\n    // Create v2 database manually\n    // Open with new code (triggers migration)\n    // Verify edges have weight=1.0 and created_at populated\n    // Verify existing edge data preserved\n}\n\nfunc TestSQLiteGraphStore_EdgeJSONLRoundTrip(t *testing.T) {\n    // Add edges with weights\n    // Sync to JSONL\n    // Close and reopen\n    // Verify weights preserved\n}\n```\n\nAdd test in `internal/ranking/decay_test.go`:\n```go\nfunc TestEdgeDecay(t *testing.T) {\n    tests := []struct {\n        name          string\n        weight        float64\n        lastActivated time.Time\n        rho           float64\n        wantMin       float64\n        wantMax       float64\n    }{\n        {\"just activated\", 1.0, time.Now(), 0.01, 0.99, 1.0},\n        {\"one day ago\", 1.0, time.Now().Add(-24*time.Hour), 0.01, 0.75, 0.80},\n        {\"one week ago\", 1.0, time.Now().Add(-168*time.Hour), 0.01, 0.15, 0.25},\n        {\"weighted edge\", 0.5, time.Now(), 0.01, 0.49, 0.50},\n        {\"zero weight\", 0.0, time.Now(), 0.01, 0.0, 0.0},\n    }\n    // Standard table-driven test pattern\n}\n```\n\n## Acceptance Criteria\n- [ ] Schema version bumped to 3\n- [ ] Migration v2→v3 adds weight, created_at, last_activated to edges table\n- [ ] Existing edges backfilled with weight=1.0 and created_at=now\n- [ ] Edge struct has Weight, CreatedAt, LastActivated fields\n- [ ] AddEdge writes new fields; defaults weight=1.0 if zero\n- [ ] GetEdges reads new fields; handles NULL last_activated\n- [ ] JSONL export/import includes new fields; handles old format gracefully\n- [ ] EdgeDecay function implemented with configurable rho\n- [ ] All existing tests still pass: `go test ./...`\n- [ ] New tests cover migration, edge weights, decay function\n- [ ] `go fmt ./...` produces no changes\n\n## Dependencies\n- None — this is the foundation task\n\n## Patterns to Follow\n- Migration pattern: see `migrateV1ToV2` in `internal/store/schema.go`\n- Column-add pattern: check `PRAGMA table_info(edges)` for existing columns before ALTER\n- Test pattern: table-driven with `t.TempDir()` for SQLite tests\n- Error wrapping: `fmt.Errorf(\"context: %w\", err)`\n- Use `sql.NullString` / `sql.NullFloat64` for nullable columns\n","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-05T21:19:15.153591968-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T09:23:25.1083916-08:00","closed_at":"2026-02-06T09:23:25.1083916-08:00","close_reason":"Schema v3 implemented: edge weights, temporal metadata, migration, decay function. Tests pass.","dependencies":[{"issue_id":"feedback-loop-chy.1","depends_on_id":"feedback-loop-chy","type":"parent-child","created_at":"2026-02-05T21:19:15.156235555-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-chy.2","title":"Implement core spreading activation engine","description":"# Core Spreading Activation Engine\n\n## Context\nThe heart of the system. Implements activation propagation through the behavior graph, adapted from the SYNAPSE paper. Given seed nodes (behaviors matching current context), activation energy spreads through graph edges, decaying with distance and edge weight.\n\n## Files to Create\n\n### 1. `internal/spreading/engine.go` — Core engine\n\n```go\npackage spreading\n\nimport (\n    \"context\"\n    \"math\"\n    \"sort\"\n    \"github.com/nvandessel/feedback-loop/internal/store\"\n    \"github.com/nvandessel/feedback-loop/internal/ranking\"\n)\n\n// Config holds tunable parameters for the spreading activation engine.\n// Defaults from SYNAPSE paper (arxiv 2601.02744).\ntype Config struct {\n    // MaxSteps is the number of propagation iterations (T). Default: 3.\n    MaxSteps int\n\n    // DecayFactor is the energy retention per hop (δ). Default: 0.5.\n    // Higher values = activation spreads further.\n    DecayFactor float64\n\n    // SpreadFactor is the energy transmission efficiency (S). Default: 0.8.\n    // Fraction of neighbor activation that flows through each edge.\n    SpreadFactor float64\n\n    // MinActivation is the threshold below which nodes are excluded (ε). Default: 0.01.\n    MinActivation float64\n\n    // TemporalDecayRate is the rho parameter for edge temporal decay. Default: 0.01.\n    TemporalDecayRate float64\n}\n\n// DefaultConfig returns the default spreading activation configuration.\nfunc DefaultConfig() Config {\n    return Config{\n        MaxSteps:          3,\n        DecayFactor:       0.5,\n        SpreadFactor:      0.8,\n        MinActivation:     0.01,\n        TemporalDecayRate: ranking.DefaultDecayRate,\n    }\n}\n\n// Seed represents an initial activation anchor.\ntype Seed struct {\n    BehaviorID string  // The behavior to seed\n    Activation float64 // Initial activation level (0.0-1.0)\n    Source     string  // What triggered this seed (e.g., \"context:language=go\")\n}\n\n// Result represents a behavior's activation state after propagation.\ntype Result struct {\n    BehaviorID string  // The activated behavior\n    Activation float64 // Final activation level (0.0-1.0)\n    Distance   int     // Minimum hops from nearest seed\n    SeedSource string  // Which seed triggered this (nearest)\n}\n\n// Engine performs spreading activation over the behavior graph.\ntype Engine struct {\n    config Config\n    store  store.GraphStore\n}\n\n// NewEngine creates a new spreading activation engine.\nfunc NewEngine(s store.GraphStore, config Config) *Engine\n\n// Activate performs spreading activation from the given seeds.\n// Returns all behaviors with activation above MinActivation, sorted by activation descending.\nfunc (e *Engine) Activate(ctx context.Context, seeds []Seed) ([]Result, error)\n```\n\n**Algorithm for `Activate`:**\n\n```\n1. Initialize activation map: for each seed, set activation[seed.ID] = seed.Activation\n2. Initialize distance map: for each seed, set distance[seed.ID] = 0\n3. Initialize seedSource map: for each seed, set seedSource[seed.ID] = seed.Source\n\n4. For step = 1 to MaxSteps:\n   a. Create newActivation map (copy of current)\n   b. For each node with activation \u003e MinActivation:\n      - Get all edges from this node (direction: Both, kinds: all)\n      - For each edge:\n        - Calculate effective weight: EdgeDecay(edge.Weight, edge.LastActivated, TemporalDecayRate)\n        - Calculate outDegree (number of edges from this node) for fan-out normalization\n        - energy = activation[node] * SpreadFactor * effectiveWeight / outDegree\n        - energy *= DecayFactor  // distance decay\n        - newActivation[neighbor] = max(newActivation[neighbor], energy)  // use max, not sum\n        - if distance[neighbor] is unset or \u003e distance[node]+1: update distance and seedSource\n   c. Replace activation map with newActivation\n\n5. Apply sigmoid squashing: activation[node] = 1 / (1 + exp(-10*(activation[node] - 0.3)))\n   - This maps the 0-1 range with a sigmoid centered at 0.3\n   - Below 0.3 gets suppressed toward 0, above gets amplified toward 1\n\n6. Filter: remove nodes with activation \u003c MinActivation\n7. Sort by activation descending\n8. Return Results\n```\n\n**Important:** Use `max()` not `sum()` for incoming activation. This prevents runaway activation from highly connected nodes. A node's activation should reflect its strongest connection path, not the sum of all paths.\n\n**Edge traversal:** Use `store.GetEdges(ctx, nodeID, store.DirectionBoth, \"\")` to get all edges regardless of kind. Follow edges in both directions — if an edge goes A→B, activation should flow both ways (undirected activation propagation).\n\n**Edge kinds to traverse:** All of: `requires`, `overrides`, `conflicts`, `similar-to`, `learned-from`. Different kinds could have different base weights in future, but for now treat all edges equally (use edge.Weight).\n\n### 2. `internal/spreading/engine_test.go` — Comprehensive tests\n\n```go\npackage spreading\n\n// Test fixtures: use store.NewInMemoryGraphStore()\n// Build test graphs by adding nodes and edges with known weights\n\nfunc TestEngine_NoSeeds(t *testing.T) {\n    // Empty seeds → empty results\n}\n\nfunc TestEngine_SingleSeed_NoEdges(t *testing.T) {\n    // One seed, no edges → only that seed in results with original activation\n}\n\nfunc TestEngine_LinearChain(t *testing.T) {\n    // A → B → C (chain of 3)\n    // Seed A with activation=1.0\n    // Verify: A has highest activation, B has medium, C has lowest\n    // Verify: distances are 0, 1, 2\n    // Verify: all seedSource = A's source\n}\n\nfunc TestEngine_FanOut(t *testing.T) {\n    // A → B, A → C, A → D (fan-out of 3)\n    // Seed A with activation=1.0\n    // Verify: B, C, D all get equal activation\n    // Verify: activation is divided by out-degree (3)\n}\n\nfunc TestEngine_FanIn(t *testing.T) {\n    // B → A, C → A (fan-in of 2)\n    // Seed both B and C\n    // Verify: A gets max of incoming activations, not sum\n}\n\nfunc TestEngine_WeightedEdges(t *testing.T) {\n    // A → B (weight=1.0), A → C (weight=0.1)\n    // Seed A\n    // Verify: B gets much higher activation than C\n}\n\nfunc TestEngine_TemporalDecay(t *testing.T) {\n    // A → B (last_activated = now), A → C (last_activated = 7 days ago)\n    // Seed A\n    // Verify: B gets higher activation than C due to temporal decay\n}\n\nfunc TestEngine_DepthLimit(t *testing.T) {\n    // Chain of 10 nodes\n    // MaxSteps=3\n    // Verify: nodes beyond ~3 hops have activation \u003c MinActivation\n}\n\nfunc TestEngine_Cycle(t *testing.T) {\n    // A → B → C → A (cycle)\n    // Seed A\n    // Verify: no infinite loop, all get activation, A has highest\n}\n\nfunc TestEngine_MinActivationFilter(t *testing.T) {\n    // Long chain where distant nodes fall below MinActivation\n    // Verify: those nodes are excluded from results\n}\n\nfunc TestEngine_SortedByActivation(t *testing.T) {\n    // Multiple seeds, varied topology\n    // Verify: results sorted by activation descending\n}\n\nfunc TestEngine_SigmoidSquashing(t *testing.T) {\n    // Verify sigmoid function behavior:\n    // - activation near 0 stays near 0\n    // - activation near 1 stays near 1\n    // - activation around 0.3 is the inflection point\n}\n```\n\n## Integration Points\n\n**GraphStore**: Uses `GetEdges(ctx, nodeID, DirectionBoth, \"\")` and `GetNode(ctx, id)`.\n\n**Edge struct**: Requires the `Weight`, `CreatedAt`, and `LastActivated` fields from ticket `.1`.\n\n**EdgeDecay**: Uses `ranking.EdgeDecay(weight, lastActivated, rho)` from ticket `.1`.\n\n## Acceptance Criteria\n- [ ] Engine propagates activation through graph edges\n- [ ] Activation decays with distance (DecayFactor)\n- [ ] Edge weights affect propagation strength\n- [ ] Temporal decay on edge last_activated time\n- [ ] Fan-out normalization prevents high-degree nodes from dominating\n- [ ] Sigmoid squashing produces sharp activation patterns\n- [ ] Cycles handled safely (no infinite loops)\n- [ ] Results sorted by activation descending\n- [ ] Results filtered by MinActivation threshold\n- [ ] Distance tracking shows hops from nearest seed\n- [ ] All parameters configurable via Config struct\n- [ ] All tests pass: `go test ./internal/spreading/...`\n- [ ] `go fmt ./...` produces no changes\n\n## Patterns to Follow\n- Use `store.NewInMemoryGraphStore()` for tests (no SQLite needed)\n- Table-driven tests with `t.Run()`\n- Context: `context.Background()` in tests\n- Error wrapping: `fmt.Errorf(\"spreading activation: %w\", err)`\n- Keep the engine stateless — all state in the activation maps during Activate()\n","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-05T21:19:25.916946116-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T09:31:50.131567132-08:00","closed_at":"2026-02-06T09:31:50.131567132-08:00","close_reason":"Core spreading activation engine implemented with propagation, decay, fan-out normalization, sigmoid squashing. Tests pass.","dependencies":[{"issue_id":"feedback-loop-chy.2","depends_on_id":"feedback-loop-chy","type":"parent-child","created_at":"2026-02-05T21:19:25.918666218-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-chy.2","depends_on_id":"feedback-loop-chy.1","type":"blocks","created_at":"2026-02-05T21:21:32.487673323-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-chy.3","title":"Implement seed node selection from context","description":"# Seed Node Selection from Context\n\n## Context\nThe spreading activation engine needs seed nodes to start propagation. This task builds the bridge between the current context (file type, task, intent) and the initial graph anchors. It extends the existing activation system to produce seeds rather than final results.\n\n## Files to Create/Modify\n\n### 1. `internal/spreading/seeds.go` — Seed selection logic\n\n```go\npackage spreading\n\nimport (\n    \"context\"\n    \"github.com/nvandessel/feedback-loop/internal/activation\"\n    \"github.com/nvandessel/feedback-loop/internal/models\"\n    \"github.com/nvandessel/feedback-loop/internal/store\"\n)\n\n// SeedSelector determines which behaviors should be activation seeds\n// based on the current context.\ntype SeedSelector struct {\n    store     store.GraphStore\n    evaluator *activation.Evaluator\n}\n\n// NewSeedSelector creates a new seed selector.\nfunc NewSeedSelector(s store.GraphStore) *SeedSelector\n\n// SelectSeeds determines seed nodes from the current context.\n// It uses the existing activation.Evaluator to find behaviors matching\n// the context, then converts matches to seeds with activation proportional\n// to match specificity.\n//\n// Seed activation scaling:\n//   - Specificity 1 (one condition matched) → activation 0.4\n//   - Specificity 2 (two conditions matched) → activation 0.6\n//   - Specificity 3+ (three+ conditions matched) → activation 0.8-1.0\n//   - No 'when' conditions (always-active) → activation 0.3 (lower, less specific)\n//\n// Returns seeds sorted by activation descending.\nfunc (s *SeedSelector) SelectSeeds(ctx context.Context, actCtx models.ContextSnapshot) ([]Seed, error)\n```\n\n**Algorithm for `SelectSeeds`:**\n\n```\n1. Query all behaviors from store: store.QueryNodes(ctx, {\"kind\": \"behavior\"})\n2. Convert nodes to Behavior models using learning.NodeToBehavior()\n3. Use activation.Evaluator to find matches:\n   evaluator := activation.NewEvaluator()\n   matches := evaluator.Evaluate(actCtx, behaviors)\n4. Convert ActivationResult → Seed:\n   For each match:\n     - seed.BehaviorID = match.Behavior.ID\n     - seed.Activation = specificityToActivation(match.Specificity)\n     - seed.Source = buildSourceLabel(match.MatchedConditions)\n       e.g., \"context:language=go,task=development\"\n5. Sort seeds by activation descending\n6. Return seeds\n```\n\n**Source label format:** `\"context:\" + comma-joined \"key=value\"` pairs from MatchedConditions. This enables the spreading engine to track which context trigger caused each activation.\n\n### 2. `internal/spreading/seeds_test.go` — Tests\n\n```go\nfunc TestSeedSelector_NoMatchingBehaviors(t *testing.T) {\n    // Context: language=rust\n    // Behaviors: only go-specific behaviors\n    // Verify: only always-active behaviors returned as seeds (if any)\n}\n\nfunc TestSeedSelector_SpecificityScaling(t *testing.T) {\n    // Behaviors with 1, 2, 3 conditions matching\n    // Verify: higher specificity → higher seed activation\n}\n\nfunc TestSeedSelector_AlwaysActiveBehaviors(t *testing.T) {\n    // Behaviors with no 'when' conditions\n    // Verify: included as seeds with activation=0.3\n}\n\nfunc TestSeedSelector_SourceLabels(t *testing.T) {\n    // Verify source labels correctly format matched conditions\n    // e.g., \"context:language=go\" or \"context:language=go,task=testing\"\n}\n\nfunc TestSeedSelector_SortedByActivation(t *testing.T) {\n    // Multiple matches with different specificities\n    // Verify: sorted descending by activation\n}\n\nfunc TestSeedSelector_EmptyStore(t *testing.T) {\n    // No behaviors in store\n    // Verify: empty seeds, no error\n}\n```\n\n### 3. `internal/spreading/pipeline.go` — Convenience orchestration\n\n```go\npackage spreading\n\nimport (\n    \"context\"\n    \"github.com/nvandessel/feedback-loop/internal/models\"\n    \"github.com/nvandessel/feedback-loop/internal/store\"\n)\n\n// Pipeline orchestrates the full spreading activation flow:\n// context → seeds → activation → results\ntype Pipeline struct {\n    selector *SeedSelector\n    engine   *Engine\n    store    store.GraphStore\n}\n\n// NewPipeline creates a new spreading activation pipeline.\nfunc NewPipeline(s store.GraphStore, config Config) *Pipeline\n\n// Run performs the full activation pipeline for the given context.\n// Returns activated behaviors sorted by activation level.\nfunc (p *Pipeline) Run(ctx context.Context, actCtx models.ContextSnapshot) ([]Result, error) {\n    seeds, err := p.selector.SelectSeeds(ctx, actCtx)\n    if err != nil {\n        return nil, fmt.Errorf(\"seed selection: %w\", err)\n    }\n    if len(seeds) == 0 {\n        return nil, nil\n    }\n    return p.engine.Activate(ctx, seeds)\n}\n```\n\n### 4. `internal/spreading/pipeline_test.go` — Integration test\n\n```go\nfunc TestPipeline_EndToEnd(t *testing.T) {\n    // Setup:\n    //   - Create InMemoryGraphStore\n    //   - Add behaviors: go-directive (when: language=go), \n    //     python-directive (when: language=python),\n    //     testing-procedure (when: task=testing),\n    //     always-active (no when)\n    //   - Add edges: go-directive --similar-to--\u003e testing-procedure\n    //\n    // Context: language=go, task=development\n    //\n    // Expected:\n    //   - go-directive: high activation (direct match, seed)\n    //   - always-active: medium activation (always-active seed)\n    //   - testing-procedure: low activation (spread from go-directive via edge)\n    //   - python-directive: not activated (no match, no edges to it)\n}\n```\n\n## Integration Points\n\n**Existing code used:**\n- `activation.NewEvaluator()` and `Evaluator.Evaluate()` — finds matching behaviors\n- `activation.ActivationResult` — has `Behavior`, `MatchedConditions`, `Specificity` fields\n- `store.GraphStore.QueryNodes()` — loads all behaviors\n- `learning.NodeToBehavior()` — converts Node to Behavior model\n\n**New code consumed by:**\n- MCP handlers (ticket `.5`) will call `Pipeline.Run()` from hooks\n- Session state (ticket `.4`) will receive `[]Result` to track injections\n\n## Acceptance Criteria\n- [ ] SeedSelector converts context matches to seeds with specificity-proportional activation\n- [ ] Always-active behaviors (no 'when' conditions) get lower seed activation (0.3)\n- [ ] Source labels correctly identify which context triggered each seed\n- [ ] Pipeline orchestrates selector → engine flow\n- [ ] End-to-end test demonstrates context → seeds → activation → results\n- [ ] All tests pass: `go test ./internal/spreading/...`\n- [ ] `go fmt ./...` produces no changes\n\n## Patterns to Follow\n- Use `store.NewInMemoryGraphStore()` for tests\n- Use existing `learning.NodeToBehavior()` for node → behavior conversion\n- Table-driven tests with explicit assertions\n- Error wrapping with descriptive context\n","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-05T21:19:35.285825906-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T09:35:57.872329764-08:00","closed_at":"2026-02-06T09:35:57.872329764-08:00","close_reason":"Seed selection and activation pipeline implemented. Tests pass.","dependencies":[{"issue_id":"feedback-loop-chy.3","depends_on_id":"feedback-loop-chy","type":"parent-child","created_at":"2026-02-05T21:19:35.290244538-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-chy.3","depends_on_id":"feedback-loop-chy.2","type":"blocks","created_at":"2026-02-05T21:21:32.565265822-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-chy.4","title":"Implement session state tracking for injection management","description":"# Session State Tracking for Injection Management\n\n## Context\nTo prevent context bloat and enable smart reinforcement, we need to track what behaviors have been injected during the current session. This state is ephemeral (lives only for the MCP server process lifetime) but must be queryable by the injection pipeline.\n\n## Files to Create\n\n### 1. `internal/session/state.go`\n\n```go\npackage session\n\nimport (\n    \"sync\"\n    \"time\"\n    \"github.com/nvandessel/feedback-loop/internal/models\"\n)\n\n// InjectionTier mirrors models.InjectionTier but is session-specific.\ntype InjectionTier int\n\nconst (\n    TierFull    InjectionTier = iota\n    TierSummary\n    TierNameOnly\n)\n\n// InjectionRecord tracks a single behavior injection event.\ntype InjectionRecord struct {\n    BehaviorID  string\n    Tier        InjectionTier\n    Activation  float64       // activation level when injected\n    TokenCost   int           // tokens consumed by this injection\n    InjectedAt  time.Time\n    Count       int           // how many times injected this session\n}\n\n// Config holds session state configuration.\ntype Config struct {\n    // MaxTokenBudget is the total token budget for the entire session.\n    // Once exceeded, no more injections occur. Default: 3000.\n    MaxTokenBudget int\n\n    // MaxPerInjection is the max tokens for a single injection event. Default: 500.\n    MaxPerInjection int\n\n    // ReinforcementBackoff controls exponential backoff for re-injection.\n    // After Nth injection, wait N*BackoffMultiplier prompts before next.\n    // Default: 5 (1st: immediate, 2nd: after 5 prompts, 3rd: after 10).\n    BackoffMultiplier int\n}\n\n// DefaultConfig returns the default session config.\nfunc DefaultConfig() Config {\n    return Config{\n        MaxTokenBudget:    3000,\n        MaxPerInjection:   500,\n        BackoffMultiplier: 5,\n    }\n}\n\n// State tracks injection history for a single session.\n// Thread-safe for concurrent hook invocations.\ntype State struct {\n    mu              sync.RWMutex\n    config          Config\n    injections      map[string]*InjectionRecord // behaviorID → record\n    totalTokensUsed int\n    promptCount     int  // number of prompts processed this session\n}\n\n// NewState creates a new session state tracker.\nfunc NewState(config Config) *State\n\n// RecordInjection records that a behavior was injected.\nfunc (s *State) RecordInjection(behaviorID string, tier InjectionTier, activation float64, tokenCost int)\n\n// GetInjection returns the injection record for a behavior, or nil if never injected.\nfunc (s *State) GetInjection(behaviorID string) *InjectionRecord\n\n// IncrementPromptCount should be called on each user prompt to track prompt cadence.\nfunc (s *State) IncrementPromptCount()\n\n// RemainingBudget returns how many tokens are still available.\nfunc (s *State) RemainingBudget() int\n\n// TotalTokensUsed returns the total tokens consumed by injections.\nfunc (s *State) TotalTokensUsed() int\n\n// ShouldInject determines whether a behavior should be injected given its current state.\n// Returns the recommended tier and whether to inject at all.\n//\n// Decision logic:\n//   - Never injected → inject at requested tier\n//   - Injected at lower tier + now higher activation → upgrade (inject at higher tier)\n//   - Injected at same/higher tier + within backoff window → skip\n//   - Injected at same/higher tier + past backoff window → reinforce (inject again)\n//   - Budget exhausted → skip\n//\n// Parameters:\n//   - behaviorID: the behavior to check\n//   - requestedTier: the tier the activation engine wants\n//   - activation: current activation level\n//   - tokenCost: estimated tokens for this injection\nfunc (s *State) ShouldInject(behaviorID string, requestedTier InjectionTier, activation float64, tokenCost int) (InjectionTier, bool)\n\n// FilterResults takes spreading activation results and returns only those\n// that should be injected, respecting session state and budget.\nfunc (s *State) FilterResults(results []spreading.Result, tierMapper func(activation float64) InjectionTier, tokenEstimator func(behaviorID string, tier InjectionTier) int) []FilteredResult\n\n// FilteredResult combines activation result with injection decision.\ntype FilteredResult struct {\n    BehaviorID string\n    Activation float64\n    Tier       InjectionTier\n    IsUpgrade  bool    // true if upgrading from lower tier\n    IsReinforce bool   // true if re-injecting after backoff\n}\n\n// Reset clears all session state (for testing or session restart).\nfunc (s *State) Reset()\n```\n\n### 2. `internal/session/state_test.go`\n\n```go\nfunc TestState_NewSession(t *testing.T) {\n    // New state has zero injections, full budget\n}\n\nfunc TestState_RecordInjection(t *testing.T) {\n    // Record injection, verify record exists\n    // Record same behavior again, verify count increments\n}\n\nfunc TestState_ShouldInject_NeverInjected(t *testing.T) {\n    // Behavior never injected → should inject at requested tier\n}\n\nfunc TestState_ShouldInject_UpgradeTier(t *testing.T) {\n    // Previously injected at TierSummary\n    // Now requesting TierFull (higher activation)\n    // → should inject (upgrade)\n}\n\nfunc TestState_ShouldInject_BackoffWindow(t *testing.T) {\n    // Injected once, within backoff window\n    // → should NOT inject\n    \n    // Advance prompt count past backoff window\n    // → should inject (reinforce)\n}\n\nfunc TestState_ShouldInject_BudgetExhausted(t *testing.T) {\n    // Fill budget with injections\n    // → should NOT inject even if never seen\n}\n\nfunc TestState_RemainingBudget(t *testing.T) {\n    // Verify budget decreases with each injection\n    // Verify budget never goes negative\n}\n\nfunc TestState_FilterResults(t *testing.T) {\n    // Multiple results, some already injected, some new\n    // Verify correct filtering, upgrades, and budget tracking\n}\n\nfunc TestState_ThreadSafety(t *testing.T) {\n    // Concurrent RecordInjection and ShouldInject calls\n    // Verify no data races (run with -race)\n}\n\nfunc TestState_Reset(t *testing.T) {\n    // Add injections, reset, verify clean state\n}\n```\n\n### 3. Integration with MCP Server — `internal/mcp/server.go`\n\nAdd session state to the MCP Server struct:\n```go\ntype Server struct {\n    server  *sdk.Server\n    store   store.GraphStore\n    root    string\n    session *session.State    // NEW: session state tracker\n}\n```\n\nInitialize in `NewServer`:\n```go\ns := \u0026Server{\n    server:  mcpServer,\n    store:   graphStore,\n    root:    cfg.Root,\n    session: session.NewState(session.DefaultConfig()),\n}\n```\n\n## Acceptance Criteria\n- [ ] Session state tracks injected behaviors with tier, activation, count, timestamp\n- [ ] ShouldInject correctly handles: never injected, upgrade, backoff, budget exhaustion\n- [ ] Token budget tracked at per-injection and session-wide levels\n- [ ] Exponential backoff: 1st immediate, 2nd after BackoffMultiplier prompts, 3rd after 2×BackoffMultiplier\n- [ ] Thread-safe (passes `go test -race`)\n- [ ] FilterResults correctly filters activation results against session state\n- [ ] Session state integrated into MCP Server struct\n- [ ] All tests pass: `go test ./internal/session/...`\n- [ ] `go fmt ./...` produces no changes\n\n## Dependencies\n- Ticket `.3` (seed selection) — uses `spreading.Result` type in FilterResults\n\n## Patterns to Follow\n- Thread safety: `sync.RWMutex` with RLock for reads, Lock for writes\n- Config pattern: `DefaultConfig()` function with sensible defaults\n- Table-driven tests\n- No external dependencies (pure Go)\n","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-05T21:19:48.902628908-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T09:44:33.159070107-08:00","closed_at":"2026-02-06T09:44:33.159070107-08:00","close_reason":"Session state tracking with thread-safe injection management. Race-free tests pass.","dependencies":[{"issue_id":"feedback-loop-chy.4","depends_on_id":"feedback-loop-chy","type":"parent-child","created_at":"2026-02-05T21:19:48.904971289-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-chy.4","depends_on_id":"feedback-loop-chy.3","type":"blocks","created_at":"2026-02-05T21:21:32.640527532-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-chy.5","title":"Hook-based dynamic context detection and re-activation","description":"# Hook-Based Dynamic Context Detection and Re-Activation\n\n## Context\nCurrently floop injects behaviors once at session start. This task adds continuous context detection via Claude Code hooks, triggering re-activation as the agent's work evolves. When the agent opens a Python file after working in Go, or starts running git commands after refactoring, relevant behaviors should dynamically surface.\n\n## Files to Create/Modify\n\n### 1. `.claude/hooks/dynamic-context.sh` — New hook script\n\n```bash\n#!/bin/bash\n# Dynamic context injection hook\n# Triggered on PreToolUse for Read, Write, Edit, Bash tools\n# Detects context changes and injects relevant behaviors\n\nINPUT=$(cat)\nTOOL_NAME=$(echo \"$INPUT\" | jq -r '.tool_name // empty')\nTOOL_INPUT=$(echo \"$INPUT\" | jq -r '.tool_input // empty')\n\n[ -z \"$TOOL_NAME\" ] \u0026\u0026 exit 0\n\nFLOOP_CMD=\"${CLAUDE_PROJECT_DIR}/floop\"\n[ -x \"$FLOOP_CMD\" ] || exit 0\n\ncase \"$TOOL_NAME\" in\n    Read|Edit|Write)\n        # Extract file path from tool input\n        FILE_PATH=$(echo \"$TOOL_INPUT\" | jq -r '.file_path // .path // empty')\n        [ -z \"$FILE_PATH\" ] \u0026\u0026 exit 0\n        # Trigger context-aware activation\n        $FLOOP_CMD activate --file \"$FILE_PATH\" --format markdown --token-budget 500 2\u003e/dev/null\n        ;;\n    Bash)\n        # Extract command from tool input\n        COMMAND=$(echo \"$TOOL_INPUT\" | jq -r '.command // empty')\n        [ -z \"$COMMAND\" ] \u0026\u0026 exit 0\n        # Detect intent from command\n        TASK=\"\"\n        case \"$COMMAND\" in\n            git\\ commit*|git\\ push*|git\\ merge*) TASK=\"committing\" ;;\n            git\\ *) TASK=\"git-operations\" ;;\n            go\\ test*|pytest*|npm\\ test*|jest*) TASK=\"testing\" ;;\n            go\\ build*|npm\\ run\\ build*|make*) TASK=\"building\" ;;\n            docker*|kubectl*) TASK=\"deployment\" ;;\n        esac\n        [ -z \"$TASK\" ] \u0026\u0026 exit 0\n        $FLOOP_CMD activate --task \"$TASK\" --format markdown --token-budget 500 2\u003e/dev/null\n        ;;\nesac\n\nexit 0\n```\n\n### 2. `cmd/floop/activate.go` — New CLI command\n\n```go\n// newActivateCmd creates the 'activate' command.\n// This command runs the spreading activation pipeline for the given context\n// and outputs behaviors that should be injected, respecting session state.\nfunc newActivateCmd() *cobra.Command {\n    cmd := \u0026cobra.Command{\n        Use:   \"activate\",\n        Short: \"Run spreading activation for dynamic context injection\",\n        Long:  \"Evaluates the behavior graph using spreading activation and returns new or upgraded behaviors for injection. Respects session state to prevent re-injection spam.\",\n        RunE: func(cmd *cobra.Command, args []string) error {\n            // Flags\n            file, _ := cmd.Flags().GetString(\"file\")\n            task, _ := cmd.Flags().GetString(\"task\")\n            format, _ := cmd.Flags().GetString(\"format\")\n            tokenBudget, _ := cmd.Flags().GetInt(\"token-budget\")\n            sessionID, _ := cmd.Flags().GetString(\"session-id\")\n            jsonOut, _ := cmd.Flags().GetBool(\"json\")\n\n            // Build context\n            ctxBuilder := activation.NewContextBuilder()\n            if file != \"\" { ctxBuilder.WithFile(file) }\n            if task != \"\" { ctxBuilder.WithTask(task) }\n            actCtx := ctxBuilder.Build()\n\n            // Load or create session state\n            // Session state persists in /tmp/floop-session-state-{sessionID}.json\n            // This allows the CLI (called from hooks) to maintain state across invocations\n            sessionState := loadOrCreateSessionState(sessionID)\n            defer saveSessionState(sessionID, sessionState)\n            sessionState.IncrementPromptCount()\n\n            // Run spreading activation pipeline\n            store := openStore()\n            pipeline := spreading.NewPipeline(store, spreading.DefaultConfig())\n            results, err := pipeline.Run(ctx, actCtx)\n            if err != nil { return err }\n\n            // Filter through session state\n            filtered := sessionState.FilterResults(results, tierMapper, tokenEstimator)\n            if len(filtered) == 0 {\n                return nil // nothing new to inject\n            }\n\n            // Compile output\n            // ... format as markdown/json and print\n            // Record injections in session state\n\n            return nil\n        },\n    }\n    cmd.Flags().String(\"file\", \"\", \"File path for context\")\n    cmd.Flags().String(\"task\", \"\", \"Task type for context\")\n    cmd.Flags().String(\"format\", \"markdown\", \"Output format: markdown, json\")\n    cmd.Flags().Int(\"token-budget\", 500, \"Token budget for this injection\")\n    cmd.Flags().String(\"session-id\", \"\", \"Session ID for state tracking\")\n    cmd.Flags().Bool(\"json\", false, \"Output as JSON\")\n    return cmd\n}\n```\n\n**Session state persistence:** Since the CLI is invoked per-hook (not long-running), session state must be persisted to disk between invocations. Use `/tmp/floop-session-state-{sessionID}.json`. The session ID comes from the hook input JSON (`session_id` field).\n\n### 3. `.claude/settings.json` — Add PreToolUse hooks\n\nAdd to existing hooks configuration:\n```json\n{\n  \"hooks\": {\n    \"SessionStart\": [...existing...],\n    \"UserPromptSubmit\": [...existing...],\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"Read\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"\\\"$CLAUDE_PROJECT_DIR\\\"/.claude/hooks/dynamic-context.sh\"\n          }\n        ]\n      },\n      {\n        \"matcher\": \"Bash\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"\\\"$CLAUDE_PROJECT_DIR\\\"/.claude/hooks/dynamic-context.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n**Note:** Start with Read and Bash matchers only. Write/Edit can be added later but are lower priority (the file is already known by then).\n\n### 4. `internal/hooks/claude.go` — Update hook generation\n\nUpdate `GenerateHookConfig` to include the PreToolUse hooks for dynamic context. Modify the existing method to add both Read and Bash matchers.\n\n### 5. `internal/session/file.go` — File-based session state persistence\n\n```go\npackage session\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n    \"path/filepath\"\n)\n\n// sessionFilePath returns the path for persisting session state.\nfunc sessionFilePath(sessionID string) string {\n    return filepath.Join(os.TempDir(), fmt.Sprintf(\"floop-session-state-%s.json\", sessionID))\n}\n\n// LoadState loads session state from disk, or creates a new one.\nfunc LoadState(sessionID string, config Config) *State\n\n// SaveState persists session state to disk.\nfunc SaveState(sessionID string, state *State) error\n\n// serializedState is the JSON-serializable form of State.\ntype serializedState struct {\n    Injections      map[string]*InjectionRecord `json:\"injections\"`\n    TotalTokensUsed int                         `json:\"total_tokens_used\"`\n    PromptCount     int                         `json:\"prompt_count\"`\n}\n```\n\n## Output Format\n\nWhen the `activate` command produces output, it should be clearly labeled as dynamic context:\n\n```markdown\n## Dynamic Context Update\n\n_Activated by: file change to `*.py`_\n\n### Directives\n- Use pathlib.Path instead of os.path for file operations\n\n### Constraints\n- Never use mutable default arguments in Python function definitions\n```\n\nThe header \"Dynamic Context Update\" distinguishes this from the session-start injection. Include the trigger reason so the agent understands why these behaviors appeared.\n\n## Acceptance Criteria\n- [ ] `floop activate` command runs spreading activation pipeline\n- [ ] Hook script detects file type changes from Read tool input\n- [ ] Hook script detects intent from Bash command patterns\n- [ ] Session state persists across CLI invocations via temp file\n- [ ] Only NEW or UPGRADED behaviors are output (session-state-aware)\n- [ ] Output clearly labeled as \"Dynamic Context Update\" with trigger reason\n- [ ] Token budget (500 default) respected per injection event\n- [ ] PreToolUse hooks configured in settings.json for Read and Bash\n- [ ] Hook script runs quickly (\u003c 1 second) to not block tool execution\n- [ ] All tests pass, `go fmt ./...` clean\n\n## Dependencies\n- Ticket `.3` (seed selection + pipeline)\n- Ticket `.4` (session state)\n\n## Patterns to Follow\n- Hook scripts: always `exit 0` even on errors (never block the agent)\n- Hook scripts: suppress stderr with `2\u003e/dev/null`\n- CLI commands: use cobra with `RunE` returning errors\n- Session state: JSON serialization for disk persistence\n- Register new command in `cmd/floop/main.go` root command\n","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-05T21:20:01.442781263-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T09:51:06.965600706-08:00","closed_at":"2026-02-06T09:51:06.965600706-08:00","close_reason":"Dynamic hooks and activate CLI command implemented. Tests pass.","dependencies":[{"issue_id":"feedback-loop-chy.5","depends_on_id":"feedback-loop-chy","type":"parent-child","created_at":"2026-02-05T21:20:01.445912156-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-chy.5","depends_on_id":"feedback-loop-chy.3","type":"blocks","created_at":"2026-02-05T21:21:32.719123467-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-chy.5","depends_on_id":"feedback-loop-chy.4","type":"blocks","created_at":"2026-02-05T21:21:32.795921965-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-chy.6","title":"Multi-resolution output based on activation distance","description":"# Multi-Resolution Output Based on Activation Distance\n\n## Context\nBehaviors at different activation levels should be rendered at different detail levels. Currently, tiering is budget-based (fill 60% with full, 30% with summary, 10% overhead). This task makes tiering activation-distance-aware, so behaviors closer to the activation source get more detail.\n\n## Files to Modify\n\n### 1. `internal/tiering/activation_tiers.go` — New activation-aware tier mapper\n\n```go\npackage tiering\n\nimport (\n    \"github.com/nvandessel/feedback-loop/internal/models\"\n    \"github.com/nvandessel/feedback-loop/internal/spreading\"\n)\n\n// ActivationTierConfig maps activation levels to tiers.\ntype ActivationTierConfig struct {\n    // FullThreshold: activation \u003e= this gets TierFull. Default: 0.7.\n    FullThreshold float64\n\n    // SummaryThreshold: activation \u003e= this gets TierSummary. Default: 0.3.\n    SummaryThreshold float64\n\n    // NameOnlyThreshold: activation \u003e= this gets TierNameOnly. Default: 0.1.\n    // Below this → TierOmitted (filtered out by engine already).\n    NameOnlyThreshold float64\n\n    // ConstraintMinTier ensures constraints never go below this tier.\n    // Default: TierSummary (constraints are safety-critical).\n    ConstraintMinTier models.InjectionTier\n}\n\n// DefaultActivationTierConfig returns the default tier thresholds.\nfunc DefaultActivationTierConfig() ActivationTierConfig {\n    return ActivationTierConfig{\n        FullThreshold:     0.7,\n        SummaryThreshold:  0.3,\n        NameOnlyThreshold: 0.1,\n        ConstraintMinTier: models.TierSummary,\n    }\n}\n\n// ActivationTierMapper maps spreading activation results to injection tiers.\ntype ActivationTierMapper struct {\n    config ActivationTierConfig\n}\n\n// NewActivationTierMapper creates a new mapper.\nfunc NewActivationTierMapper(config ActivationTierConfig) *ActivationTierMapper\n\n// MapTier returns the appropriate tier for a given activation level and behavior kind.\nfunc (m *ActivationTierMapper) MapTier(activation float64, kind models.BehaviorKind) models.InjectionTier {\n    tier := models.TierOmitted\n    if activation \u003e= m.config.FullThreshold {\n        tier = models.TierFull\n    } else if activation \u003e= m.config.SummaryThreshold {\n        tier = models.TierSummary\n    } else if activation \u003e= m.config.NameOnlyThreshold {\n        // TierNameOnly — need to add this to models.InjectionTier\n        tier = models.TierNameOnly  // NEW tier level\n    }\n\n    // Enforce constraint minimum tier\n    if kind == models.BehaviorKindConstraint \u0026\u0026 tier \u003e m.config.ConstraintMinTier {\n        tier = m.config.ConstraintMinTier\n    }\n\n    return tier\n}\n\n// MapResults converts spreading activation results into an InjectionPlan.\n// Respects both activation-based tiers AND token budget as a hard ceiling.\nfunc (m *ActivationTierMapper) MapResults(\n    results []spreading.Result,\n    behaviors map[string]*models.Behavior,\n    tokenBudget int,\n) *models.InjectionPlan\n```\n\n**Algorithm for `MapResults`:**\n```\n1. For each result, look up behavior in behaviors map\n2. Assign initial tier based on activation level via MapTier()\n3. Calculate total tokens for all tiers\n4. If over budget:\n   a. Sort by activation ascending (lowest first)\n   b. Demote lowest-activation behaviors one tier at a time until within budget\n   c. Never demote constraints below ConstraintMinTier\n5. Build InjectionPlan with FullBehaviors, SummarizedBehaviors, OmittedBehaviors\n```\n\n### 2. `internal/models/injection.go` — Add TierNameOnly\n\nAdd new tier constant:\n```go\nconst (\n    TierFull     InjectionTier = iota\n    TierSummary\n    TierNameOnly   // NEW: behavior name + tags only\n    TierOmitted\n)\n```\n\nUpdate `String()` method to include \"name-only\".\n\n### 3. `internal/assembly/compile.go` — Handle TierNameOnly in compilation\n\nExtend `CompileTiered` to handle TierNameOnly behaviors:\n```markdown\n### Also Available (activate with floop show \u003cid\u003e)\n- `learned/use-cobra-for-cli` [directive] #cli #cobra\n- `learned/prefer-pathlib-over-ospath` [preference] #python #filesystem\n```\n\nName-only format: `- \\`{name}\\` [{kind}] {tags as hashtags}`\n\nThis gives the agent enough context to recognize the behavior and request expansion via `floop://behaviors/expand/{id}` if needed.\n\n### 4. Tests\n\n`internal/tiering/activation_tiers_test.go`:\n```go\nfunc TestActivationTierMapper_Thresholds(t *testing.T) {\n    tests := []struct {\n        name       string\n        activation float64\n        kind       models.BehaviorKind\n        want       models.InjectionTier\n    }{\n        {\"high activation directive\", 0.9, models.BehaviorKindDirective, models.TierFull},\n        {\"medium activation directive\", 0.5, models.BehaviorKindDirective, models.TierSummary},\n        {\"low activation directive\", 0.15, models.BehaviorKindDirective, models.TierNameOnly},\n        {\"very low activation\", 0.05, models.BehaviorKindDirective, models.TierOmitted},\n        {\"low activation constraint\", 0.15, models.BehaviorKindConstraint, models.TierSummary}, // enforced min\n        {\"high activation constraint\", 0.9, models.BehaviorKindConstraint, models.TierFull},\n    }\n    // Standard table-driven test\n}\n\nfunc TestActivationTierMapper_BudgetDemotion(t *testing.T) {\n    // Set up behaviors that exceed token budget\n    // Verify lowest-activation behaviors get demoted first\n    // Verify constraints are never demoted below TierSummary\n}\n\nfunc TestActivationTierMapper_EmptyResults(t *testing.T) {\n    // No results → empty plan\n}\n```\n\n## Acceptance Criteria\n- [ ] TierNameOnly added to InjectionTier enum\n- [ ] Activation level maps to tier: \u003e=0.7→Full, \u003e=0.3→Summary, \u003e=0.1→NameOnly, \u003c0.1→Omitted\n- [ ] Constraints enforced at minimum TierSummary regardless of activation\n- [ ] Token budget acts as hard ceiling; lowest-activation behaviors demoted first\n- [ ] Name-only format renders as `name [kind] #tags` for agent recognition\n- [ ] CompileTiered handles TierNameOnly in output\n- [ ] All existing tiering tests still pass\n- [ ] New tests cover threshold mapping, budget demotion, constraint enforcement\n- [ ] `go fmt ./...` produces no changes\n\n## Dependencies\n- Ticket `.2` (activation engine) — provides spreading.Result type\n\n## Patterns to Follow\n- Extend existing InjectionPlan rather than creating new type\n- Follow existing tier assignment pattern in `internal/tiering/assigner.go`\n- Use existing `estimateTokens()` for token counting\n","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-05T21:20:11.131402795-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T09:37:05.815847482-08:00","closed_at":"2026-02-06T09:37:05.815847482-08:00","close_reason":"Activation-distance tiering implemented with TierNameOnly support. Tests pass.","dependencies":[{"issue_id":"feedback-loop-chy.6","depends_on_id":"feedback-loop-chy","type":"parent-child","created_at":"2026-02-05T21:20:11.134512107-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-chy.6","depends_on_id":"feedback-loop-chy.2","type":"blocks","created_at":"2026-02-05T21:21:32.876130078-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-chy.7","title":"Implement lateral inhibition for activation focus","description":"# Lateral Inhibition for Activation Focus\n\n## Context\nWithout inhibition, activation spreads everywhere and everything lights up. Lateral inhibition (from neuroscience) means highly activated nodes suppress their competitors, creating focused activation patterns instead of diffuse noise. This is critical for keeping context injection targeted.\n\n## Files to Modify\n\n### 1. `internal/spreading/inhibition.go` — Inhibition logic\n\n```go\npackage spreading\n\n// InhibitionConfig holds parameters for lateral inhibition.\ntype InhibitionConfig struct {\n    // Strength (β) controls how strongly winners suppress losers. Default: 0.15.\n    // Higher values = more aggressive suppression.\n    Strength float64\n\n    // Breadth (M) is the number of top nodes that compete in each round. Default: 7.\n    // These top-M nodes suppress all nodes outside the top-M.\n    Breadth int\n\n    // Enabled controls whether inhibition is applied. Default: true.\n    Enabled bool\n}\n\n// DefaultInhibitionConfig returns the default lateral inhibition config.\nfunc DefaultInhibitionConfig() InhibitionConfig {\n    return InhibitionConfig{\n        Strength: 0.15,\n        Breadth:  7,\n        Enabled:  true,\n    }\n}\n\n// ApplyInhibition performs lateral inhibition on the activation map.\n// The top-M activated nodes suppress all other nodes based on their\n// activation difference.\n//\n// Algorithm (from SYNAPSE):\n//   1. Sort all nodes by activation descending\n//   2. Select top-M nodes as \"winners\"\n//   3. For each non-winner node:\n//      - suppression = β × mean(winner_activation - node_activation)\n//      - node_activation = max(0, node_activation - suppression)\n//   4. Re-apply sigmoid squashing to normalize\n//\n// This creates sharp contrast: winners stay bright, losers fade.\nfunc ApplyInhibition(activations map[string]float64, config InhibitionConfig) map[string]float64\n```\n\n### 2. `internal/spreading/engine.go` — Integrate inhibition\n\nAdd `InhibitionConfig` to the main `Config` struct:\n```go\ntype Config struct {\n    MaxSteps          int\n    DecayFactor       float64\n    SpreadFactor      float64\n    MinActivation     float64\n    TemporalDecayRate float64\n    Inhibition        InhibitionConfig  // NEW\n}\n```\n\nUpdate `DefaultConfig()`:\n```go\nfunc DefaultConfig() Config {\n    return Config{\n        MaxSteps:          3,\n        DecayFactor:       0.5,\n        SpreadFactor:      0.8,\n        MinActivation:     0.01,\n        TemporalDecayRate: 0.01,\n        Inhibition:        DefaultInhibitionConfig(),\n    }\n}\n```\n\nInsert inhibition step in `Activate()` between propagation and final filtering:\n```\n1. Seed\n2. Propagate (T iterations)\n3. Apply lateral inhibition ← NEW STEP\n4. Apply sigmoid squashing\n5. Filter by MinActivation\n6. Sort and return\n```\n\n### 3. `internal/spreading/inhibition_test.go` — Tests\n\n```go\nfunc TestApplyInhibition_TopMPreserved(t *testing.T) {\n    // 10 nodes with varying activation\n    // M=3\n    // Verify: top 3 nodes retain high activation\n    // Verify: bottom 7 nodes have reduced activation\n}\n\nfunc TestApplyInhibition_Suppression(t *testing.T) {\n    // All nodes at activation=0.5 except one at 0.9\n    // M=1\n    // Verify: the 0.9 node suppresses all others\n    // Verify: suppressed nodes have activation \u003c 0.5\n}\n\nfunc TestApplyInhibition_Disabled(t *testing.T) {\n    // Config.Enabled = false\n    // Verify: activations unchanged\n}\n\nfunc TestApplyInhibition_EmptyMap(t *testing.T) {\n    // Empty activation map → no panic\n}\n\nfunc TestApplyInhibition_FewerThanM(t *testing.T) {\n    // Only 3 nodes but M=7\n    // Verify: all nodes treated as winners (no suppression)\n}\n\nfunc TestApplyInhibition_StrengthEffect(t *testing.T) {\n    // Same activations, different β values\n    // Verify: higher β → more suppression\n}\n\nfunc TestApplyInhibition_FocusEffect(t *testing.T) {\n    // Integration test: two clusters of related behaviors\n    // Cluster A: highly activated (related to current context)\n    // Cluster B: weakly activated (tangentially related)\n    // Verify: after inhibition, Cluster A sharp and bright, Cluster B faded\n}\n```\n\n### 4. End-to-end test in `internal/spreading/engine_test.go`\n\n```go\nfunc TestEngine_WithInhibition(t *testing.T) {\n    // Build graph with two distinct clusters connected by weak edge\n    // Seed one cluster\n    // Without inhibition: both clusters light up\n    // With inhibition: seeded cluster stays bright, other fades\n}\n\nfunc TestEngine_WithoutInhibition(t *testing.T) {\n    // Same graph as above\n    // Config.Inhibition.Enabled = false\n    // Verify: both clusters have activation\n}\n```\n\n## Acceptance Criteria\n- [ ] Top-M activated nodes suppress lower-activation competitors\n- [ ] Suppression strength controlled by β parameter\n- [ ] Inhibition produces focused patterns (seeded cluster bright, others faded)\n- [ ] Disabled when Config.Inhibition.Enabled = false\n- [ ] Handles edge cases: empty map, fewer nodes than M\n- [ ] Integrated into Engine.Activate() pipeline\n- [ ] All existing spreading tests still pass\n- [ ] New tests verify inhibition effect quantitatively\n- [ ] `go fmt ./...` produces no changes\n\n## Dependencies\n- Ticket `.2` (activation engine) — inhibition is a step in the activation pipeline\n\n## Patterns to Follow\n- Pure function: `ApplyInhibition` takes map, returns new map (no mutation)\n- Table-driven tests with quantitative assertions (activation ranges)\n- Keep inhibition as a separable step for easy debugging/disabling\n","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-05T21:20:21.706880474-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T09:36:36.181963361-08:00","closed_at":"2026-02-06T09:36:36.181963361-08:00","close_reason":"Lateral inhibition implemented and integrated into engine. Tests pass.","dependencies":[{"issue_id":"feedback-loop-chy.7","depends_on_id":"feedback-loop-chy","type":"parent-child","created_at":"2026-02-05T21:20:21.710372295-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-chy.7","depends_on_id":"feedback-loop-chy.2","type":"blocks","created_at":"2026-02-05T21:21:32.956355665-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-chy.8","title":"Hybrid scoring: similarity + activation + PageRank","description":"# Hybrid Scoring: Similarity + Activation + PageRank\n\n## Context\nSYNAPSE uses a triple-signal scoring formula combining three orthogonal relevance signals. This replaces floop's current relevance scoring (which uses context match, usage, recency, confidence, priority) with a formula that includes graph-structural signals.\n\n## Formula\n```\nFinalScore = λ₁ × context_relevance + λ₂ × activation_level + λ₃ × pagerank\n```\nDefault weights: λ₁=0.5, λ₂=0.3, λ₃=0.2\n\n## Files to Modify/Create\n\n### 1. `internal/ranking/pagerank.go` — PageRank computation for behavior graph\n\n```go\npackage ranking\n\nimport (\n    \"context\"\n    \"math\"\n    \"github.com/nvandessel/feedback-loop/internal/store\"\n)\n\n// PageRankConfig holds configuration for PageRank computation.\ntype PageRankConfig struct {\n    // DampingFactor (d) is the probability of following an edge vs. teleporting.\n    // Standard value: 0.85.\n    DampingFactor float64\n\n    // MaxIterations is the maximum number of power iteration steps. Default: 100.\n    MaxIterations int\n\n    // Tolerance is the convergence threshold. Default: 1e-6.\n    Tolerance float64\n}\n\n// DefaultPageRankConfig returns the default PageRank configuration.\nfunc DefaultPageRankConfig() PageRankConfig {\n    return PageRankConfig{\n        DampingFactor: 0.85,\n        MaxIterations: 100,\n        Tolerance:     1e-6,\n    }\n}\n\n// ComputePageRank calculates PageRank scores for all nodes in the behavior graph.\n// Returns a map of behaviorID → PageRank score (0.0-1.0, normalized).\n//\n// Algorithm: Standard power iteration\n//   1. Initialize all nodes with score = 1/N\n//   2. For each iteration:\n//      PR(v) = (1-d)/N + d × Σ(PR(u)/outDegree(u)) for all u linking to v\n//   3. Converge when max change \u003c Tolerance\n//   4. Normalize to [0, 1] range\n//\n// Edge directions: All edge kinds (requires, overrides, similar-to, etc.)\n// are treated as bidirectional links for PageRank purposes.\nfunc ComputePageRank(ctx context.Context, s store.GraphStore, config PageRankConfig) (map[string]float64, error)\n```\n\n**Implementation notes:**\n- Query all behavior nodes from store\n- Build adjacency list from edges (treating all edges as bidirectional)\n- Run power iteration until convergence or MaxIterations\n- Normalize final scores to [0, 1] by dividing by max score\n\n### 2. `internal/ranking/hybrid.go` — Hybrid scoring that combines all signals\n\n```go\npackage ranking\n\nimport (\n    \"github.com/nvandessel/feedback-loop/internal/models\"\n    \"github.com/nvandessel/feedback-loop/internal/spreading\"\n)\n\n// HybridScorerConfig holds weights for the three scoring signals.\ntype HybridScorerConfig struct {\n    // ContextWeight (λ₁) for context relevance signal. Default: 0.5.\n    ContextWeight float64\n\n    // ActivationWeight (λ₂) for spreading activation signal. Default: 0.3.\n    ActivationWeight float64\n\n    // PageRankWeight (λ₃) for graph structural importance. Default: 0.2.\n    PageRankWeight float64\n}\n\n// DefaultHybridScorerConfig returns the default hybrid scoring weights.\nfunc DefaultHybridScorerConfig() HybridScorerConfig {\n    return HybridScorerConfig{\n        ContextWeight:    0.5,\n        ActivationWeight: 0.3,\n        PageRankWeight:   0.2,\n    }\n}\n\n// HybridScorer combines context relevance, spreading activation, and PageRank.\ntype HybridScorer struct {\n    config         HybridScorerConfig\n    contextScorer  *RelevanceScorer        // existing scorer from ranking package\n    pageRankScores map[string]float64      // pre-computed PageRank\n}\n\n// NewHybridScorer creates a new hybrid scorer.\n// pageRankScores should be pre-computed via ComputePageRank.\nfunc NewHybridScorer(config HybridScorerConfig, contextScorer *RelevanceScorer, pageRankScores map[string]float64) *HybridScorer\n\n// HybridScore represents the combined score for a behavior.\ntype HybridScore struct {\n    BehaviorID      string  `json:\"behavior_id\"`\n    FinalScore      float64 `json:\"final_score\"`\n    ContextScore    float64 `json:\"context_score\"`    // from existing RelevanceScorer\n    ActivationScore float64 `json:\"activation_score\"` // from spreading activation\n    PageRankScore   float64 `json:\"pagerank_score\"`   // from graph structure\n}\n\n// Score computes the hybrid score for a behavior.\nfunc (h *HybridScorer) Score(\n    behavior *models.Behavior,\n    ctx *models.ContextSnapshot,\n    activationLevel float64,\n) HybridScore {\n    contextScore := h.contextScorer.Score(behavior, ctx).Score\n    pageRank := h.pageRankScores[behavior.ID] // 0 if not found\n    \n    finalScore := h.config.ContextWeight*contextScore +\n                  h.config.ActivationWeight*activationLevel +\n                  h.config.PageRankWeight*pageRank\n\n    return HybridScore{\n        BehaviorID:      behavior.ID,\n        FinalScore:      finalScore,\n        ContextScore:    contextScore,\n        ActivationScore: activationLevel,\n        PageRankScore:   pageRank,\n    }\n}\n\n// ScoreBatch scores multiple behaviors and returns sorted by FinalScore descending.\nfunc (h *HybridScorer) ScoreBatch(\n    behaviors []models.Behavior,\n    ctx *models.ContextSnapshot,\n    activations map[string]float64,\n) []HybridScore\n```\n\n### 3. `internal/ranking/pagerank_test.go`\n\n```go\nfunc TestComputePageRank_SingleNode(t *testing.T) {\n    // One node, no edges → PageRank = 1.0\n}\n\nfunc TestComputePageRank_LinearChain(t *testing.T) {\n    // A → B → C\n    // Verify: middle nodes have slightly higher PageRank\n}\n\nfunc TestComputePageRank_Hub(t *testing.T) {\n    // Hub node connected to 5 leaf nodes\n    // Verify: hub has highest PageRank\n}\n\nfunc TestComputePageRank_Convergence(t *testing.T) {\n    // Larger graph (10+ nodes)\n    // Verify: converges within MaxIterations\n    // Verify: scores sum to ~1.0\n}\n\nfunc TestComputePageRank_EmptyGraph(t *testing.T) {\n    // No nodes → empty map, no error\n}\n\nfunc TestComputePageRank_Disconnected(t *testing.T) {\n    // Two disconnected subgraphs\n    // Verify: each subgraph has internal PageRank distribution\n}\n```\n\n### 4. `internal/ranking/hybrid_test.go`\n\n```go\nfunc TestHybridScorer_WeightedCombination(t *testing.T) {\n    tests := []struct {\n        name            string\n        contextScore    float64\n        activationScore float64\n        pageRankScore   float64\n        wantScore       float64 // λ₁×C + λ₂×A + λ₃×P\n    }{\n        {\"all max\", 1.0, 1.0, 1.0, 1.0},\n        {\"all zero\", 0.0, 0.0, 0.0, 0.0},\n        {\"context only\", 1.0, 0.0, 0.0, 0.5},\n        {\"activation only\", 0.0, 1.0, 0.0, 0.3},\n        {\"pagerank only\", 0.0, 0.0, 1.0, 0.2},\n    }\n}\n\nfunc TestHybridScorer_ScoreBatch_Sorted(t *testing.T) {\n    // Multiple behaviors with different scores\n    // Verify: sorted by FinalScore descending\n}\n\nfunc TestHybridScorer_MissingPageRank(t *testing.T) {\n    // Behavior not in pageRankScores map → pagerank=0\n    // Verify: score still computed with other signals\n}\n```\n\n### 5. Integration: cache PageRank in MCP Server\n\nPageRank is expensive to compute on every activation. Cache it in the MCP Server and recompute on behavior add/remove:\n\nIn `internal/mcp/server.go`:\n```go\ntype Server struct {\n    server       *sdk.Server\n    store        store.GraphStore\n    root         string\n    session      *session.State\n    pageRankCache map[string]float64  // NEW: cached PageRank scores\n}\n```\n\nRecompute on:\n- Server startup\n- After `floop_learn` adds a new behavior\n- After `floop_deduplicate` merges behaviors\n\n## Acceptance Criteria\n- [ ] PageRank computed for behavior graph using power iteration\n- [ ] PageRank handles: single node, linear chain, hub, disconnected, empty graph\n- [ ] HybridScorer combines context (0.5) + activation (0.3) + PageRank (0.2)\n- [ ] Weights configurable via HybridScorerConfig\n- [ ] ScoreBatch returns behaviors sorted by FinalScore\n- [ ] Missing PageRank defaults to 0 (doesn't crash)\n- [ ] PageRank cached in MCP Server, recomputed on graph changes\n- [ ] All existing ranking tests still pass\n- [ ] New tests cover all scoring scenarios\n- [ ] `go fmt ./...` produces no changes\n\n## Dependencies\n- Ticket `.2` (activation engine) — provides activation levels for scoring\n\n## Patterns to Follow\n- Follow existing `RelevanceScorer` patterns in `internal/ranking/scorer.go`\n- Use `store.NewInMemoryGraphStore()` for PageRank tests\n- Table-driven tests with explicit expected scores\n- Keep PageRank computation as a standalone pure function (takes store, returns map)\n","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-05T21:20:31.210933391-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T09:37:50.806302139-08:00","closed_at":"2026-02-06T09:37:50.806302139-08:00","close_reason":"PageRank and hybrid scoring implemented. Tests pass.","dependencies":[{"issue_id":"feedback-loop-chy.8","depends_on_id":"feedback-loop-chy","type":"parent-child","created_at":"2026-02-05T21:20:31.212738032-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-chy.8","depends_on_id":"feedback-loop-chy.2","type":"blocks","created_at":"2026-02-05T21:21:33.035952831-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-chy.9","title":"Smart reinforcement and coalescing logic","description":"# Smart Reinforcement and Coalescing Logic\n\n## Context\nDynamic injection creates a risk of context bloat — the same behaviors injected over and over, consuming the context window. But sometimes reinforcement IS valuable (constraints the agent keeps violating, or context re-entry). We need intelligence about when to repeat vs. suppress, and how to group related behaviors compactly.\n\n## Files to Create/Modify\n\n### 1. `internal/session/reinforcement.go` — Reinforcement decision logic\n\n```go\npackage session\n\nimport (\n    \"time\"\n    \"github.com/nvandessel/feedback-loop/internal/models\"\n)\n\n// ReinforcementConfig controls when behaviors should be re-injected.\ntype ReinforcementConfig struct {\n    // BackoffBase is the number of prompts to wait before first re-injection.\n    // Subsequent re-injections wait BackoffBase × injection_count. Default: 5.\n    BackoffBase int\n\n    // MaxReinjections is the maximum times a behavior can be re-injected per session.\n    // After this, it's considered internalized. Default: 3.\n    MaxReinjections int\n\n    // ConstraintMultiplier increases re-injection frequency for constraints.\n    // Constraints wait BackoffBase / ConstraintMultiplier prompts. Default: 2.\n    ConstraintMultiplier int\n\n    // ViolationBoost: when a behavior was activated but not followed\n    // (high times_activated, low times_followed), multiply re-injection urgency.\n    // Default: true.\n    ViolationBoost bool\n}\n\n// DefaultReinforcementConfig returns sensible defaults.\nfunc DefaultReinforcementConfig() ReinforcementConfig {\n    return ReinforcementConfig{\n        BackoffBase:          5,\n        MaxReinjections:      3,\n        ConstraintMultiplier: 2,\n        ViolationBoost:       true,\n    }\n}\n\n// ReinforcementDecision represents whether and why to reinforce a behavior.\ntype ReinforcementDecision struct {\n    ShouldReinforce bool\n    Reason          string // \"never_injected\", \"upgrade\", \"backoff_expired\", \"violation_detected\", \"suppressed\"\n}\n\n// ShouldReinforce determines whether a behavior should be re-injected.\n//\n// Decision matrix:\n//   Never injected → REINFORCE (reason: \"never_injected\")\n//   Injected at lower tier + higher activation now → REINFORCE (reason: \"upgrade\")\n//   Constraint + violated (low follow rate) → REINFORCE with boosted priority (reason: \"violation_detected\")\n//   Injected + past backoff window → REINFORCE (reason: \"backoff_expired\")\n//   Injected + within backoff window → SUPPRESS (reason: \"suppressed\")\n//   Injected MaxReinjections times → SUPPRESS (reason: \"max_reinjections\")\n//\nfunc (c ReinforcementConfig) ShouldReinforce(\n    record *InjectionRecord,\n    currentActivation float64,\n    requestedTier InjectionTier,\n    kind models.BehaviorKind,\n    stats models.BehaviorStats,\n    promptCount int,\n) ReinforcementDecision\n```\n\n**Violation detection:** A behavior is \"violated\" when `stats.TimesActivated \u003e 0 \u0026\u0026 stats.TimesFollowed / stats.TimesActivated \u003c 0.5`. This means the agent encountered the behavior more than half the time without following it.\n\n### 2. `internal/assembly/coalesce.go` — Group related behaviors compactly\n\n```go\npackage assembly\n\nimport (\n    \"github.com/nvandessel/feedback-loop/internal/models\"\n)\n\n// CoalesceConfig controls behavior grouping.\ntype CoalesceConfig struct {\n    // MinClusterSize: minimum behaviors to trigger coalescing. Default: 3.\n    // If fewer than this many related behaviors activate, show individually.\n    MinClusterSize int\n\n    // MaxIndividualPerCluster: show this many at full detail, summarize rest. Default: 1.\n    MaxIndividualPerCluster int\n}\n\n// DefaultCoalesceConfig returns sensible defaults.\nfunc DefaultCoalesceConfig() CoalesceConfig {\n    return CoalesceConfig{\n        MinClusterSize:          3,\n        MaxIndividualPerCluster: 1,\n    }\n}\n\n// BehaviorCluster is a group of related behaviors that can be compactly represented.\ntype BehaviorCluster struct {\n    // Representative is the most specific/actionable behavior shown at full detail.\n    Representative models.InjectedBehavior\n\n    // Members are the other cluster members (shown as summary or omitted).\n    Members []models.InjectedBehavior\n\n    // ClusterLabel describes the cluster (e.g., \"Python file handling\" or \"Git operations\").\n    ClusterLabel string\n\n    // SharedTags are tags common to all members.\n    SharedTags []string\n}\n\n// Coalescer groups related behaviors to reduce context bloat.\ntype Coalescer struct {\n    config CoalesceConfig\n}\n\n// NewCoalescer creates a new behavior coalescer.\nfunc NewCoalescer(config CoalesceConfig) *Coalescer\n\n// Coalesce groups related behaviors by shared tags and kind.\n// Returns individual behaviors and clusters.\n//\n// Algorithm:\n//   1. Group behaviors by kind (directives together, constraints together)\n//   2. Within each kind group, cluster by tag overlap (Jaccard \u003e 0.5)\n//   3. Clusters with \u003e= MinClusterSize members get coalesced:\n//      - Pick the highest-activation member as representative (full detail)\n//      - Others become summary or omitted\n//      - Generate cluster label from shared tags\n//   4. Behaviors not in any cluster remain individual\n//\nfunc (c *Coalescer) Coalesce(behaviors []models.InjectedBehavior) (individuals []models.InjectedBehavior, clusters []BehaviorCluster)\n```\n\n### 3. `internal/assembly/compile.go` — Extend compilation for coalesced output\n\nAdd method to Compiler:\n```go\n// CompileCoalesced renders both individual behaviors and clusters.\n// Clusters are shown as:\n//\n//   ### Python File Handling (3 behaviors)\n//   - **Use pathlib.Path** instead of os.path for all file operations\n//   - _Also: prefer-context-managers, avoid-os-walk_ (use `floop show \u003cid\u003e` for details)\n//\nfunc (c *Compiler) CompileCoalesced(individuals []models.InjectedBehavior, clusters []BehaviorCluster) string\n```\n\n### 4. Tests\n\n`internal/session/reinforcement_test.go`:\n```go\nfunc TestShouldReinforce_NeverInjected(t *testing.T) {\n    // record is nil → should reinforce, reason \"never_injected\"\n}\n\nfunc TestShouldReinforce_Upgrade(t *testing.T) {\n    // Previously TierSummary, now requesting TierFull\n    // → should reinforce, reason \"upgrade\"\n}\n\nfunc TestShouldReinforce_BackoffWindow(t *testing.T) {\n    // Injected 2 prompts ago, backoff=5\n    // → should NOT reinforce, reason \"suppressed\"\n}\n\nfunc TestShouldReinforce_BackoffExpired(t *testing.T) {\n    // Injected 10 prompts ago, backoff=5, injection_count=1\n    // → should reinforce, reason \"backoff_expired\"\n}\n\nfunc TestShouldReinforce_ExponentialBackoff(t *testing.T) {\n    // 1st injection: wait 5 prompts\n    // 2nd injection: wait 10 prompts\n    // 3rd injection: wait 15 prompts (capped at MaxReinjections)\n}\n\nfunc TestShouldReinforce_ConstraintBoosted(t *testing.T) {\n    // Constraint behavior, backoff=5, multiplier=2\n    // → backoff reduced to 5/2 = 2 prompts\n}\n\nfunc TestShouldReinforce_ViolationDetected(t *testing.T) {\n    // Behavior: times_activated=10, times_followed=2 (20% follow rate)\n    // → should reinforce regardless of backoff, reason \"violation_detected\"\n}\n\nfunc TestShouldReinforce_MaxReinjections(t *testing.T) {\n    // Already re-injected MaxReinjections times\n    // → should NOT reinforce, reason \"max_reinjections\"\n}\n```\n\n`internal/assembly/coalesce_test.go`:\n```go\nfunc TestCoalescer_NoClusters(t *testing.T) {\n    // 2 behaviors with different tags (\u003c MinClusterSize)\n    // → all individual, no clusters\n}\n\nfunc TestCoalescer_TagClustering(t *testing.T) {\n    // 4 behaviors: 3 share tags [\"python\", \"filesystem\"], 1 different\n    // → 1 cluster of 3, 1 individual\n}\n\nfunc TestCoalescer_RepresentativeSelection(t *testing.T) {\n    // Cluster of 3, different activation levels\n    // → highest activation is the representative\n}\n\nfunc TestCoalescer_KindGrouping(t *testing.T) {\n    // 3 directives (clusterable) + 3 constraints (clusterable)\n    // → 2 separate clusters, not mixed\n}\n\nfunc TestCoalescer_ClusterLabel(t *testing.T) {\n    // Cluster with shared tags [\"go\", \"testing\"]\n    // → label: \"Go Testing\" or similar\n}\n\nfunc TestCompileCoalesced_Output(t *testing.T) {\n    // Verify markdown output format for clusters\n    // Representative at full detail, members as brief list\n}\n```\n\n## Acceptance Criteria\n- [ ] Reinforcement logic handles: never injected, upgrade, backoff, violation, max reinjections\n- [ ] Exponential backoff: wait increases with each re-injection\n- [ ] Constraints get boosted re-injection frequency (ConstraintMultiplier)\n- [ ] Violation detection triggers re-injection when follow rate \u003c 50%\n- [ ] Coalescer groups 3+ behaviors with \u003e50% tag overlap into clusters\n- [ ] Clusters show one representative at full detail, others as summary list\n- [ ] Kind grouping prevents mixing directives and constraints in same cluster\n- [ ] CompileCoalesced produces clear, compact markdown\n- [ ] All tests pass: `go test ./internal/session/... ./internal/assembly/...`\n- [ ] `go fmt ./...` produces no changes\n\n## Dependencies\n- Ticket `.4` (session state) — provides InjectionRecord and session state\n- Ticket `.6` (multi-resolution) — provides InjectionTier levels\n\n## Patterns to Follow\n- Follow existing assembly/compile.go patterns for markdown formatting\n- Use Jaccard similarity (already exists in dedup package) for tag clustering\n- Table-driven tests with explicit expected outcomes\n- Keep reinforcement logic as pure functions (no store access)\n- Keep coalescing as pure functions (operates on behavior slices)\n","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-05T21:20:43.105575854-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T09:51:15.777383717-08:00","closed_at":"2026-02-06T09:51:15.777383717-08:00","close_reason":"Smart reinforcement and behavior coalescing implemented. Tests pass.","dependencies":[{"issue_id":"feedback-loop-chy.9","depends_on_id":"feedback-loop-chy","type":"parent-child","created_at":"2026-02-05T21:20:43.107385444-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-chy.9","depends_on_id":"feedback-loop-chy.4","type":"blocks","created_at":"2026-02-05T21:21:33.123754733-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-chy.9","depends_on_id":"feedback-loop-chy.6","type":"blocks","created_at":"2026-02-05T21:21:33.207942024-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-cia","title":"Write Windsurf integration guide","description":"Create comprehensive integration guide for Windsurf/Cascade.\n\n## Research Findings (from e2d investigation)\n\n### Extension Points\n1. **.windsurf/rules/** - Rule files (markdown, no frontmatter - activation via GUI)\n2. **.windsurf/workflows/** - Reusable workflows invoked with `/command`\n3. **Memories** - Persistent context system (`~/.codeium/windsurf/memories/`)\n4. **MCP servers** - Full MCP support (`~/.codeium/windsurf/mcp_config.json`)\n5. **AGENTS.md** - Cross-tool standard supported\n6. **Terminal allowlist** - Auto-approve specific commands\n\n### Recommended Integration (Rules + Workflows + Allowlist)\n- Create rule file for always-on floop instructions\n- Create workflows for `/floop-start` and `/floop-correction`\n- Add floop commands to terminal allowlist\n\n### Deliverables\n1. `docs/integrations/windsurf.md` - Full guide with:\n   - Overview of Windsurf extension mechanisms\n   - Quick start with rules\n   - Full configuration with workflows\n   - MCP server option\n   - Terminal allowlist setup\n   - Troubleshooting\n2. `templates/windsurf/` directory with:\n   - `floop-integration.md` rules template\n   - `floop-start.md` workflow template\n   - `floop-correction.md` workflow template\n   - `mcp_config.json` snippet\n\n### Key Workflow Example\n```markdown\n# Start Task with floop\nCheck for learned behaviors before beginning work.\n## Steps\n1. Identify current file and task\n2. Run: floop active --file \"$FILE\" --task \"$TASK\" --json\n3. Apply returned behaviors\n```\n\n### Limitations\n- No YAML frontmatter - activation modes set via GUI only\n- Character limits: 6K per rule, 12K total, 12K per workflow\n- GUI-dependent configuration (not fully version-controllable)\n- Max 100 MCP tools active at once\n\n### Sources\n- https://docs.windsurf.com/windsurf/cascade/cascade\n- https://docs.windsurf.com/windsurf/cascade/workflows\n- https://docs.windsurf.com/windsurf/cascade/mcp","status":"open","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:33:58.211344894-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T19:43:04.824809558-08:00"}
{"id":"feedback-loop-cok","title":"Create shared LLM prompts","description":"Create internal/llm/prompts.go with:\n- ComparisonPrompt: Structured prompt for comparing two behaviors semantically\n- MergePrompt: Prompt for merging similar behaviors into one\n- Response parsing helpers for JSON output\n\nThese prompts will be used by all LLM backends (subagent, Anthropic, OpenAI).\n\nDepends on: feedback-loop-8jt (LLMClient interface for result types)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:27:29.24402436-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T21:09:54.508020549-08:00","closed_at":"2026-01-29T21:09:54.508020549-08:00","close_reason":"Created prompts.go with ComparisonPrompt, MergePrompt, and JSON parsing helpers","dependencies":[{"issue_id":"feedback-loop-cok","depends_on_id":"feedback-loop-8jt","type":"blocks","created_at":"2026-01-29T19:31:58.435051415-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-cok","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:37.971445631-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-dez","title":"Write integration tests for full pipeline","description":"Create integration tests for end-to-end flow:\n\ninternal/learning/integration_test.go:\n- Test: correction -\u003e extraction -\u003e duplicate detection -\u003e auto-merge\n- Test: Similar corrections yield merged behavior\n- Test: Dissimilar corrections create separate behaviors\n- Test: Cross-store deduplication on learn with scope=both\n\ncmd/floop/main_test.go additions:\n- Test deduplicate command with dry-run\n- Test config command set/get\n\nUse mock LLM client with configured similarity scores.\n\nDepends on:\n- feedback-loop-8a5 (Auto-merge in LearningLoop)\n- feedback-loop-mgv (Mock LLM client)","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:29:44.1701506-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-30T15:19:22.586681055-08:00","closed_at":"2026-01-30T15:19:22.586681055-08:00","close_reason":"Added comprehensive integration tests for full pipeline","dependencies":[{"issue_id":"feedback-loop-dez","depends_on_id":"feedback-loop-8a5","type":"blocks","created_at":"2026-01-29T19:37:23.829169387-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-dez","depends_on_id":"feedback-loop-mgv","type":"blocks","created_at":"2026-01-29T19:42:25.654810275-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-dez","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:39.273798065-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-dgv","title":"Write OpenAI Codex CLI integration guide","description":"Create comprehensive integration guide for OpenAI Codex CLI.\n\n## Research Findings (from e2d investigation)\n\n### Extension Points\n1. **AGENTS.md** - Native support with precedence chain (global → project → directory)\n2. **Skills** (`~/.codex/skills/\u003cname\u003e/SKILL.md` or `.codex/skills/`) - Task-specific workflows\n3. **config.toml** (`~/.codex/config.toml`) - `developer_instructions` field\n4. **MCP servers** - Full MCP support in config.toml\n\n### Recommended Integration (Skill + AGENTS.md)\n- Create a floop skill with comprehensive description for auto-triggering\n- Add AGENTS.md section for fallback guidance\n- Optional: MCP server for deeper integration\n\n### Deliverables\n1. `docs/integrations/codex.md` - Full guide with:\n   - Overview of Codex CLI extension mechanisms\n   - Quick start with AGENTS.md\n   - Full configuration with Skills\n   - MCP integration option\n   - Troubleshooting\n2. `templates/codex/` directory with:\n   - `SKILL.md` template for floop\n   - `AGENTS.md` section template\n   - `config.toml` snippet\n\n### Key Skill Example\n```yaml\n---\nname: floop\ndescription: \"Behavior learning integration. ALWAYS use before editing files to check active behaviors with floop active. Use floop learn when corrected.\"\n---\n# Floop Behavior Learning\n...\n```\n\n### Limitations\n- No pre-task hooks (requested in GitHub issues but not implemented)\n- Skills triggered by model judgment based on description\n- `developer_instructions` may not be consistently picked up\n\n### Sources\n- https://developers.openai.com/codex/skills/\n- https://developers.openai.com/codex/guides/agents-md\n- https://developers.openai.com/codex/mcp/","status":"open","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:30:31.091497508-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T19:43:04.67124302-08:00"}
{"id":"feedback-loop-e2d","title":"Research AI tool integration requirements for feedback-loop","description":"Investigate and document what prompts, hooks, or configuration is needed for AI coding assistants to start using feedback-loop for learning. This includes:\n\n- **Claude Code**: What AGENTS.md sections, system prompts, or hooks are needed?\n- **Codex/OpenAI tools**: What configuration or context files do they use?\n- **Other terminal AI tools**: Aider, Cursor, Continue, etc.\n\nDeliverables:\n1. Research each tool's extension points (prompts, hooks, context files)\n2. Design the integration approach for each tool\n3. Document the required additions to AGENTS.md or new files\n4. Create follow-up beads for implementing each integration\n\nReference: The feedback-loop system stores interaction patterns and learnings that AI tools should leverage when working in this codebase.","status":"closed","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T17:06:36.392507595-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T19:43:05.13719884-08:00","closed_at":"2026-01-27T08:44:02.154185422-08:00","close_reason":"Research complete. Created 11 follow-up beads:\n- P1: Documentation structure (2vt), Claude Code (aq1), Codex (dgv), Aider (9cq)\n- P2: Cursor (qke), Cline (3er), Continue (6jz), Windsurf (cia), MCP server (ol7), floop generate (72j)\n- P3: GitHub Copilot (3l3)\n\nKey findings documented in each bead with extension points, config examples, and limitations."}
{"id":"feedback-loop-ek2","title":"Epic: Global + Local Storage System","description":"Implement two-tier behavior storage: global (~/.floop/) for personal preferences across all projects, and local (./.floop/) for project-specific conventions. Local overrides global on conflicts.\n\nArchitecture: MultiGraphStore wrapper pattern wrapping two BeadsGraphStore instances.\n\nSuccess Criteria:\n- floop learn --scope global saves to ~/.floop/\n- floop learn --scope local saves to ./.floop/\n- floop active merges both stores with local winning\n- All existing .floop/ directories work unchanged\n- Full test coverage\n\nPlan: /home/nvandessel/.claude/plans/shimmying-squishing-knuth.md","status":"closed","priority":1,"issue_type":"epic","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T22:13:17.95827601-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-28T21:31:42.206716391-08:00","closed_at":"2026-01-28T21:31:42.206716391-08:00","close_reason":"Global+Local storage system complete. All 9 implementation tasks done (ek2.1-ek2.9). MultiGraphStore working with full test coverage. Integration testing passed. Only ek2.10 (docs) remains as separate P2 task."}
{"id":"feedback-loop-ek2.1","title":"Create path utilities (internal/store/paths.go)","description":"Create internal/store/paths.go with helper functions for global/local path resolution.\n\nFunctions needed:\n- GlobalFloopPath() (string, error) - Returns ~/.floop on Unix, %USERPROFILE%\\.floop on Windows\n- LocalFloopPath(projectRoot string) string - Returns projectRoot/.floop\n- EnsureGlobalFloopDir() error - Creates ~/.floop if it doesn't exist\n\nCross-platform support using os.UserHomeDir() and filepath.Join().\n\nEstimated: 30 minutes\nFile: internal/store/paths.go (~50 lines)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T22:13:26.319594347-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-27T22:21:25.455092553-08:00","closed_at":"2026-01-27T22:21:25.455092553-08:00","close_reason":"Completed path utilities with GlobalFloopPath, LocalFloopPath, and EnsureGlobalFloopDir functions. All tests passing with good coverage (75-100% per function). Cross-platform support via os.UserHomeDir and filepath.Join.","dependencies":[{"issue_id":"feedback-loop-ek2.1","depends_on_id":"feedback-loop-ek2","type":"parent-child","created_at":"2026-01-27T22:13:26.320877137-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-ek2.10","title":"Update documentation for global/local storage","description":"Update project documentation to explain global/local storage feature.\n\nFiles to update:\n\n1. README.md - Add section:\n   - Global vs Local Behaviors overview\n   - Usage examples for --scope flag\n   - Examples for --global and --all flags\n   - Conflict resolution explanation (local \u003e global)\n\n2. docs/SPEC.md - Document:\n   - MultiGraphStore architecture\n   - Query merging strategy\n   - Write routing strategy\n   - Conflict resolution rules\n   - Thread safety guarantees\n\n3. docs/FLOOP_USAGE.md - Add:\n   - Examples of global vs local learning\n   - When to use each scope\n   - Best practices for scope selection\n   - Common patterns for agent usage\n\nEstimated: 30 minutes\nFiles: README.md, docs/SPEC.md, docs/FLOOP_USAGE.md","status":"closed","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T22:15:03.911228311-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T10:55:46.268213988-08:00","closed_at":"2026-02-06T10:55:46.268213988-08:00","close_reason":"Parent epic closed. Documentation deferred — will be covered in dogfooding epic.","dependencies":[{"issue_id":"feedback-loop-ek2.10","depends_on_id":"feedback-loop-ek2","type":"parent-child","created_at":"2026-01-27T22:15:03.912961095-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.10","depends_on_id":"feedback-loop-ek2.9","type":"blocks","created_at":"2026-01-27T22:15:03.91491217-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-ek2.2","title":"Implement MultiGraphStore wrapper (internal/store/multi.go)","description":"Create internal/store/multi.go implementing GraphStore interface that wraps local + global BeadsGraphStore instances.\n\nComponents:\n- StoreScope enum (ScopeLocal, ScopeGlobal, ScopeBoth)\n- MultiGraphStore struct with localStore, globalStore, writeScope, sync.RWMutex\n- Implement all GraphStore interface methods:\n  * QueryNodes - parallel query, merge with local winning\n  * AddNode - route based on writeScope\n  * GetNode - check local first, fallback to global\n  * UpdateNode - find in either store, update in place\n  * DeleteNode - remove from both (idempotent)\n  * AddEdge/RemoveEdge/GetEdges - merge logic\n  * Traverse - delegate to appropriate store\n  * Sync/Close - call both stores\n- Helper functions: mergeNodes, mergeEdges\n- NewStoreFromConfig factory function\n\nThread-safe by delegation to thread-safe stores.\n\nEstimated: 2-3 hours\nFile: internal/store/multi.go (~400 lines)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T22:13:45.333190532-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-27T22:28:31.137305526-08:00","closed_at":"2026-01-27T22:28:31.137305526-08:00","close_reason":"Implemented MultiGraphStore wrapper with local/global store support. Features: StoreScope enum, parallel QueryNodes with local-wins merging, scope-based write routing, comprehensive test coverage (78.5%). All GraphStore interface methods implemented. Tests verify conflict resolution, sync operations, and edge handling.","dependencies":[{"issue_id":"feedback-loop-ek2.2","depends_on_id":"feedback-loop-ek2","type":"parent-child","created_at":"2026-01-27T22:13:45.334769217-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.2","depends_on_id":"feedback-loop-ek2.1","type":"blocks","created_at":"2026-01-27T22:13:45.336359033-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-ek2.3","title":"Create MultiGraphStore tests (internal/store/multi_test.go)","description":"Create comprehensive test suite for MultiGraphStore.\n\nTest scenarios:\n- TestMultiGraphStore_QueryNodes_LocalWins - Verify local overrides global on ID conflicts\n- TestMultiGraphStore_AddNode_ScopeLocal - Write to local only\n- TestMultiGraphStore_AddNode_ScopeGlobal - Write to global only\n- TestMultiGraphStore_AddNode_ScopeBoth - Write to both stores\n- TestMultiGraphStore_GetNode_PreferLocal - Local checked first, fallback to global\n- TestMultiGraphStore_UpdateNode_FindsCorrectStore - Updates in correct store\n- TestMultiGraphStore_DeleteNode_BothStores - Deletes from both idempotently\n- TestMultiGraphStore_Sync_BothStores - Syncs both stores\n- TestMultiGraphStore_ConflictResolution - Local wins merge logic\n- TestMultiGraphStore_EdgeMerging - Edge deduplication\n- TestMultiGraphStore_Concurrency - Thread safety\n\nUse temporary directories for test isolation.\n\nEstimated: 1-2 hours\nFile: internal/store/multi_test.go (~300 lines)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T22:13:55.664761607-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-28T21:31:26.055227234-08:00","closed_at":"2026-01-28T21:31:26.055227234-08:00","close_reason":"Tests already exist (internal/store/multi_test.go, 568 lines). All 35 test cases passing. Created during ek2.2 implementation.","dependencies":[{"issue_id":"feedback-loop-ek2.3","depends_on_id":"feedback-loop-ek2","type":"parent-child","created_at":"2026-01-27T22:13:55.666464525-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.3","depends_on_id":"feedback-loop-ek2.2","type":"blocks","created_at":"2026-01-27T22:13:55.668157515-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-ek2.4","title":"Update CLI learn command with --scope flag","description":"Modify newLearnCmd in cmd/floop/main.go to support --scope flag.\n\nChanges:\n- Add flag: --scope with values local|global|both (default: local)\n- Parse scope and convert to store.StoreScope enum\n- Replace NewBeadsGraphStore with NewMultiGraphStore(root, storeScope)\n- Maintain existing error handling and output patterns\n\nPattern:\n  scope, _ := cmd.Flags().GetString(\"scope\")\n  storeScope := store.ScopeLocal\n  switch scope {\n  case \"global\": storeScope = store.ScopeGlobal\n  case \"both\": storeScope = store.ScopeBoth\n  }\n  graphStore, err := store.NewMultiGraphStore(root, storeScope)\n\nEstimated: 30 minutes\nFile: cmd/floop/main.go (lines ~120-250)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T22:14:06.904962029-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-28T08:14:26.470692023-08:00","closed_at":"2026-01-28T08:14:26.470692023-08:00","close_reason":"Added --scope flag to learn command with values local/global/both (default: local). Uses NewMultiGraphStore for routing. Validates scope values. All tests passing. Successfully tested all three scopes.","dependencies":[{"issue_id":"feedback-loop-ek2.4","depends_on_id":"feedback-loop-ek2","type":"parent-child","created_at":"2026-01-27T22:14:06.90656002-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.4","depends_on_id":"feedback-loop-ek2.2","type":"blocks","created_at":"2026-01-27T22:14:06.908182988-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-ek2.5","title":"Update CLI list command with --global and --all flags","description":"Modify newListCmd in cmd/floop/main.go to support global/local/both listing.\n\nChanges:\n- Add flag: --global (show global behaviors only)\n- Add flag: --all (show both local and global, merged)\n- Default: local only (existing behavior)\n- Route to appropriate store based on flags:\n  * --all: NewMultiGraphStore (merged)\n  * --global: NewBeadsGraphStore(globalPath)\n  * default: NewBeadsGraphStore(root)\n\nPattern:\n  globalOnly, _ := cmd.Flags().GetBool(\"global\")\n  showAll, _ := cmd.Flags().GetBool(\"all\")\n  \n  if showAll {\n      graphStore = store.NewMultiGraphStore(root, store.ScopeLocal)\n  } else if globalOnly {\n      globalPath, _ := store.GlobalFloopPath()\n      graphStore = store.NewBeadsGraphStore(filepath.Dir(globalPath))\n  } else {\n      graphStore = store.NewBeadsGraphStore(root)\n  }\n\nEstimated: 30 minutes\nFile: cmd/floop/main.go (lines ~360-450)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T22:14:16.488172153-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-28T18:02:19.65317851-08:00","closed_at":"2026-01-28T18:02:19.65317851-08:00","close_reason":"Implemented --global and --all flags for list command with comprehensive tests. All tests passing.","dependencies":[{"issue_id":"feedback-loop-ek2.5","depends_on_id":"feedback-loop-ek2","type":"parent-child","created_at":"2026-01-27T22:14:16.489555661-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.5","depends_on_id":"feedback-loop-ek2.2","type":"blocks","created_at":"2026-01-27T22:14:16.491159594-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-ek2.6","title":"Update CLI query commands to use MultiGraphStore","description":"Modify newActiveCmd, newShowCmd, newWhyCmd, newPromptCmd to always query both stores.\n\nCommands to update:\n- newActiveCmd - always merge local + global behaviors\n- newShowCmd - search both stores for behavior\n- newWhyCmd - search both stores for provenance chain\n- newPromptCmd - generate prompts from merged behaviors\n\nChanges:\nReplace: graphStore, err := store.NewBeadsGraphStore(root)\nWith: graphStore, err := store.NewMultiGraphStore(root, store.ScopeLocal)\n\nThese commands should always check both stores with local winning on conflicts.\nNo flags needed - merging is the expected behavior for activation/queries.\n\nEstimated: 30 minutes\nFile: cmd/floop/main.go (multiple functions)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T22:14:25.695892258-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-28T20:01:48.790706632-08:00","closed_at":"2026-01-28T20:01:48.790706632-08:00","close_reason":"Updated query commands (active, show, why, prompt) to use MultiGraphStore. All tests passing.","dependencies":[{"issue_id":"feedback-loop-ek2.6","depends_on_id":"feedback-loop-ek2","type":"parent-child","created_at":"2026-01-27T22:14:25.697100898-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.6","depends_on_id":"feedback-loop-ek2.2","type":"blocks","created_at":"2026-01-27T22:14:25.698981881-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-ek2.7","title":"Update CLI init command with --global flag","description":"Modify newInitCmd to support global .floop initialization.\n\nChanges:\n- Add flag: --global (initialize ~/.floop/ instead of ./.floop/)\n- When --global is set:\n  * Call store.EnsureGlobalFloopDir()\n  * Get globalPath from store.GlobalFloopPath()\n  * Create manifest.yaml in globalPath\n  * Output success message with global path\n- Maintain existing local initialization as default\n\nPattern:\n  globalInit, _ := cmd.Flags().GetBool(\"global\")\n  if globalInit {\n      if err := store.EnsureGlobalFloopDir(); err \\!= nil {\n          return fmt.Errorf(\"failed to initialize global directory: %w\", err)\n      }\n      globalPath, _ := store.GlobalFloopPath()\n      // Create manifest in globalPath\n  }\n\nEstimated: 30 minutes\nFile: cmd/floop/main.go (lines ~75-120)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T22:14:35.544156765-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-28T17:45:34.405893433-08:00","closed_at":"2026-01-28T17:45:34.405893433-08:00","close_reason":"Added --global flag to init command. When set, initializes ~/.floop/ instead of ./.floop/. Uses EnsureGlobalFloopDir() and GlobalFloopPath(). Updates output messages to indicate scope. All tests passing.","dependencies":[{"issue_id":"feedback-loop-ek2.7","depends_on_id":"feedback-loop-ek2","type":"parent-child","created_at":"2026-01-27T22:14:35.545755658-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.7","depends_on_id":"feedback-loop-ek2.1","type":"blocks","created_at":"2026-01-27T22:14:35.547432868-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-ek2.8","title":"Update curation commands to use MultiGraphStore","description":"Modify curation commands (forget, deprecate, restore, merge) to search both stores.\n\nCommands to update:\n- newForgetCmd - search both stores for behavior to forget\n- newDeprecateCmd - search both stores for behavior to deprecate\n- newRestoreCmd - search both stores for behavior to restore\n- newMergeCmd - search both stores for source and target behaviors\n\nChanges:\nReplace: graphStore, err := store.NewBeadsGraphStore(root)\nWith: graphStore, err := store.NewMultiGraphStore(root, store.ScopeLocal)\n\nUpdates happen in whichever store contains the behavior (MultiGraphStore.UpdateNode handles routing).\n\nEstimated: 45 minutes\nFile: cmd/floop/main.go (multiple functions: forget ~line 943, deprecate ~line 1073, restore ~line 1214, merge ~line 1355)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T22:14:43.614931403-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-28T20:01:48.857522706-08:00","closed_at":"2026-01-28T20:01:48.857522706-08:00","close_reason":"Updated curation commands (forget, deprecate, restore, merge) to use MultiGraphStore. All tests passing.","dependencies":[{"issue_id":"feedback-loop-ek2.8","depends_on_id":"feedback-loop-ek2","type":"parent-child","created_at":"2026-01-27T22:14:43.616204745-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.8","depends_on_id":"feedback-loop-ek2.2","type":"blocks","created_at":"2026-01-27T22:14:43.617960833-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-ek2.9","title":"Integration testing for global/local storage","description":"Perform end-to-end integration testing of global/local storage feature.\n\nTest scenarios:\n1. Initialize both scopes: floop init \u0026\u0026 floop init --global\n2. Learn globally: floop learn --scope global --wrong X --right Y\n3. Learn locally (override): floop learn --scope local --wrong Y --right Z\n4. Verify local wins: floop active --file test.py\n5. Test list commands: floop list, floop list --global, floop list --all\n6. Test backwards compatibility: existing .floop/ works unchanged\n7. Test edge cases: missing global dir, partial failures, concurrent access\n\nVerification:\n- Build: go build ./cmd/floop\n- Unit tests pass: go test ./internal/store/... -v\n- Integration tests pass\n- All behaviors activate correctly\n- Conflict resolution works (local \u003e global)\n\nEstimated: 1 hour\nCommands: Run verification steps from plan","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T22:14:54.569438328-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-28T21:04:40.251958867-08:00","closed_at":"2026-01-28T21:04:40.251958867-08:00","close_reason":"Integration testing complete. Fixed bug where behaviors with placement confidence 0.6-0.8 were not being saved. All test scenarios passing: global/local/both scopes, list commands, local overrides global. All unit tests pass.","dependencies":[{"issue_id":"feedback-loop-ek2.9","depends_on_id":"feedback-loop-ek2","type":"parent-child","created_at":"2026-01-27T22:14:54.57087154-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.9","depends_on_id":"feedback-loop-ek2.4","type":"blocks","created_at":"2026-01-27T22:14:54.573285854-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.9","depends_on_id":"feedback-loop-ek2.5","type":"blocks","created_at":"2026-01-27T22:14:54.575474094-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.9","depends_on_id":"feedback-loop-ek2.6","type":"blocks","created_at":"2026-01-27T22:14:54.577620125-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.9","depends_on_id":"feedback-loop-ek2.7","type":"blocks","created_at":"2026-01-27T22:14:54.579839043-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ek2.9","depends_on_id":"feedback-loop-ek2.8","type":"blocks","created_at":"2026-01-27T22:14:54.581669421-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-f1l","title":"Floop v2: Simplify \u0026 Validate","description":"# Epic: Floop v2 - Simplify \u0026 Validate\n\n## Context\nAfter competitive analysis, we identified that floop's unique value is the correction→behavior abstraction. However, the current implementation has friction (manual tool calls, beads dependency, complex graph store).\n\n## Goal\nStrip floop to its core differentiator, validate that it provides value beyond existing memory tools, and either:\n1. Prove it's worth continuing as standalone\n2. Pivot to being a layer on top of existing memory systems\n3. Sunset if the value isn't there\n\n## Success Criteria\n- [ ] Beads dependency removed\n- [ ] Hooks working for automatic injection\n- [ ] User (Nick) has tried claude-mem for comparison\n- [ ] Clear decision on floop's future direction\n\n## Non-Goals\n- Graph traversal features (defer)\n- Cross-app memory passport (out of scope)\n- Enterprise features","status":"closed","priority":1,"issue_type":"epic","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-02T10:19:58.516716589-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T10:55:42.467557318-08:00","closed_at":"2026-02-06T10:55:42.467557318-08:00","close_reason":"Superseded by spreading activation epic (feedback-loop-chy). Core goals achieved: hooks working, behaviors auto-injected, spreading activation built."}
{"id":"feedback-loop-f1l.1","title":"Try claude-mem for 3-5 sessions","description":"# Task: Evaluate claude-mem\n\n## Objective\nInstall and use claude-mem for real work sessions to understand:\n1. How automatic capture feels vs manual floop_learn\n2. What it remembers that's useful\n3. What it misses that floop would catch\n4. Overall friction/value assessment\n\n## Steps\n1. Install: `/plugin marketplace add thedotmack/claude-mem \u0026\u0026 /plugin install claude-mem`\n2. Use for 3-5 real coding sessions\n3. Check the web UI at localhost:37777\n4. Try mem-search to query history\n5. Document findings\n\n## Deliverable\nWritten comparison: claude-mem vs floop experience","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-02T10:20:06.120144578-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T10:55:42.357654818-08:00","closed_at":"2026-02-06T10:55:42.357654818-08:00","close_reason":"Superseded by spreading activation system (feedback-loop-chy). Floop direction is settled.","dependencies":[{"issue_id":"feedback-loop-f1l.1","depends_on_id":"feedback-loop-f1l","type":"parent-child","created_at":"2026-02-02T10:20:06.121789491-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-f1l.2","title":"Remove beads dependency from floop","description":"# Task: Remove Beads Dependency\n\n## Objective\nReplace BeadsGraphStore with a simple SQLite-backed store that:\n1. Stores behaviors in SQLite for queries\n2. Exports to JSONL for git version control (like beads does)\n3. No external beads binary dependency\n\n## Why\n- Beads adds complexity without clear value for floop's use case\n- SQLite is simpler, faster, more portable\n- JSONL export maintains version control benefits\n\n## Implementation\n1. Create `internal/store/sqlite.go` implementing GraphStore interface\n2. Add JSONL export on Sync() for .floop/behaviors.jsonl\n3. Migrate existing .floop/nodes.jsonl → SQLite\n4. Remove beads imports and dependencies\n5. Update go.mod\n\n## Tests\n- All existing tests pass with new store\n- Round-trip: SQLite ↔ JSONL export\n- Migration from existing JSONL data\n\n## Acceptance Criteria\n- [ ] `go build` succeeds with no beads imports\n- [ ] Existing behaviors preserved after migration\n- [ ] .floop/behaviors.jsonl human-readable and git-trackable","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-02T10:20:15.723265952-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-02T17:55:14.183934126-08:00","closed_at":"2026-02-02T17:55:14.183934126-08:00","close_reason":"Renamed BeadsGraphStore to FileGraphStore - eliminated naming confusion. The store was never a beads dependency, just misleadingly named.","dependencies":[{"issue_id":"feedback-loop-f1l.2","depends_on_id":"feedback-loop-f1l","type":"parent-child","created_at":"2026-02-02T10:20:15.726685954-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-f1l.3","title":"Fix MCP resource injection for automatic context","description":"# Task: Fix MCP Resource Injection\n\n## Problem\nThe MCP resource `floop://behaviors/active` exists but isn't being loaded automatically into agent context. Agents still need to call floop_active manually.\n\n## Objective\nEnsure behaviors are injected into context at session start without manual tool calls.\n\n## Investigation Needed\n1. How does Claude Code load MCP resources?\n2. Is our resource being advertised correctly?\n3. Do we need to configure something in ~/.claude/settings.json?\n4. Compare with how mcp-memory-service achieves auto-injection\n\n## Implementation\nTBD based on investigation - may require:\n- Resource configuration changes\n- Hook registration\n- Settings documentation\n\n## Acceptance Criteria\n- [ ] New Claude Code session automatically has behaviors in context\n- [ ] No manual floop_active call required\n- [ ] Documented how to enable if configuration needed","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-02T10:20:24.09207558-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-02T21:17:29.556010726-08:00","closed_at":"2026-02-02T21:17:29.556010726-08:00","close_reason":"Implemented SessionStart and UserPromptSubmit hooks for automatic behavior injection","dependencies":[{"issue_id":"feedback-loop-f1l.3","depends_on_id":"feedback-loop-f1l","type":"parent-child","created_at":"2026-02-02T10:20:24.094278203-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-f1l.4","title":"Add automatic correction capture via hooks","description":"# Task: Automatic Correction Capture\n\n## Problem\nCurrently agents must explicitly call floop_learn to capture corrections. This adds friction and means many learnings are missed.\n\n## Objective\nAutomatically detect when the user corrects the agent and capture it without explicit tool calls.\n\n## Approach Options\n\n### Option A: Claude Code Hooks\nUse lifecycle hooks (like claude-mem does):\n- UserPromptSubmit hook: analyze if message contains correction\n- LLM-powered detection: \"Is this a correction? What was wrong/right?\"\n\n### Option B: Conversation Analysis\nPost-session analysis of conversation to extract corrections:\n- Run at SessionEnd\n- LLM identifies correction patterns\n- Batch process into behaviors\n\n### Option C: Hybrid\n- Real-time detection for obvious corrections\n- Batch analysis for subtle ones\n\n## Investigation Needed\n1. What hooks does Claude Code expose?\n2. How does claude-mem's capture work technically?\n3. What's the false positive/negative tradeoff?\n\n## Acceptance Criteria\n- [ ] Corrections captured without manual floop_learn calls\n- [ ] False positive rate acceptable (\u003c10%)\n- [ ] User can still use explicit floop_learn for intentional capture","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-02T10:20:34.495164438-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-02T21:17:30.124321228-08:00","closed_at":"2026-02-02T21:17:30.124321228-08:00","close_reason":"Implemented detect-correction hook with LLM extraction for automatic correction capture","dependencies":[{"issue_id":"feedback-loop-f1l.4","depends_on_id":"feedback-loop-f1l","type":"parent-child","created_at":"2026-02-02T10:20:34.498609288-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-f1l.4","depends_on_id":"feedback-loop-f1l.3","type":"blocks","created_at":"2026-02-02T10:20:34.502628892-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-f1l.5","title":"Consolidate and clean up existing behaviors","description":"# Task: Behavior Consolidation\n\n## Problem\nCurrent behavior store has:\n- 43 local + 23 global behaviors\n- Many semantic duplicates (5x \"proactively use tools\")\n- Verbose descriptions that could be shorter\n- Test behaviors that should be removed\n\n## Objective\nClean, deduplicated, punchy behavior set that's actually useful.\n\n## Steps\n1. Run aggressive deduplication (0.7 threshold)\n2. LLM-powered consolidation of similar behaviors\n3. Shorten verbose behaviors to punchy rules\n4. Remove test/junk behaviors\n5. Decide which should be global vs local\n6. Migrate appropriately\n\n## Target State\n- \u003c20 high-quality behaviors total\n- Each behavior is a clear, actionable rule\n- No duplicates\n- Proper global/local scoping\n\n## Acceptance Criteria\n- [ ] Behavior count reduced significantly\n- [ ] Each behavior is ≤50 words\n- [ ] No semantic duplicates\n- [ ] Clear value in each behavior","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-02T10:20:43.880539493-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-02T17:55:15.542439457-08:00","closed_at":"2026-02-02T17:55:15.542439457-08:00","close_reason":"Consolidated behaviors from 55 to 36 - removed test/junk, merged duplicates (proactive tools, TDD, beads tasks, worktrees), removed conflicting logging behaviors.","dependencies":[{"issue_id":"feedback-loop-f1l.5","depends_on_id":"feedback-loop-f1l","type":"parent-child","created_at":"2026-02-02T10:20:43.883915195-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-f1l.6","title":"Decision point: floop future direction","description":"# Task: Decision Point - Floop Future\n\n## Context\nAfter completing the evaluation and simplification work, we need to make a clear decision about floop's future.\n\n## Prerequisites\n- [ ] Tried claude-mem (feedback-loop-f1l.1)\n- [ ] Beads removed, simpler storage (feedback-loop-f1l.2)\n- [ ] MCP injection working (feedback-loop-f1l.3)\n- [ ] Behaviors consolidated (feedback-loop-f1l.5)\n\n## Decision Options\n\n### Option A: Continue Standalone\nFloop provides unique value beyond memory tools.\n- Continue development\n- Focus on correction→behavior pipeline\n- Marketing: \"Learning layer\" vs \"Memory layer\"\n\n### Option B: Layer on Top\nFloop's value is the extraction, not the storage.\n- Build floop as a layer on claude-mem or mcp-memory-service\n- Use their capture/storage/retrieval\n- Add our correction→behavior extraction on top\n\n### Option C: Contribute Upstream\nThe correction→behavior concept should be part of existing tools.\n- Propose PR to claude-mem or mcp-memory-service\n- Archive floop as standalone\n- Focus energy elsewhere\n\n### Option D: Sunset\nThe value isn't there or is already solved.\n- Archive the project\n- Document learnings\n- Move on\n\n## Deliverable\nWritten decision document with:\n- Evidence from evaluation\n- Chosen direction\n- Next steps if continuing","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-02T10:20:54.395740819-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T10:55:42.419369282-08:00","closed_at":"2026-02-06T10:55:42.419369282-08:00","close_reason":"Superseded by spreading activation system (feedback-loop-chy). Floop direction is settled: continuing as standalone with spreading activation.","dependencies":[{"issue_id":"feedback-loop-f1l.6","depends_on_id":"feedback-loop-f1l","type":"parent-child","created_at":"2026-02-02T10:20:54.397928438-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-f1l.6","depends_on_id":"feedback-loop-f1l.1","type":"blocks","created_at":"2026-02-02T10:20:54.40042413-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-f1l.6","depends_on_id":"feedback-loop-f1l.2","type":"blocks","created_at":"2026-02-02T10:20:54.403714608-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-f1l.6","depends_on_id":"feedback-loop-f1l.3","type":"blocks","created_at":"2026-02-02T10:20:54.408020015-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-f1l.6","depends_on_id":"feedback-loop-f1l.5","type":"blocks","created_at":"2026-02-02T10:20:54.412219371-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-f1y","title":"LLM-Powered Behavior Intelligence","description":"Add LLM-based semantic comparison and auto-deduplication to floop. This epic covers the implementation of semantic behavior comparison using LLM APIs, automatic duplicate detection, and cross-store deduplication.","status":"closed","priority":1,"issue_type":"epic","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:27:13.087637501-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-01T18:14:53.202169002-08:00","closed_at":"2026-02-01T18:14:53.202169002-08:00","close_reason":"All 18 child tasks complete - LLM interface, clients (Anthropic/OpenAI/fallback/subagent), deduplication, auto-merge, config, CLI commands all implemented with tests"}
{"id":"feedback-loop-g2k","title":"Phase 1: Core models and CLI skeleton","status":"closed","priority":2,"issue_type":"epic","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:20:14.755508204-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-01T18:14:45.008604014-08:00","closed_at":"2026-02-01T18:14:45.008604014-08:00","close_reason":"Phase 1-5 all complete per PLAN.md - models, store, CLI, learning, activation, persistence, assembly all implemented"}
{"id":"feedback-loop-goj","title":"Add deduplicate and config CLI commands","description":"Add to cmd/floop/main.go:\n\nnewDeduplicateCmd:\n- floop deduplicate [--dry-run] [--threshold 0.9] [--scope local|global|both]\n- Shows duplicate behaviors and optionally merges them\n- Dry-run shows what would be merged without making changes\n- Uses Deduplicator from dedup package\n\nnewConfigCmd:\n- floop config set llm.provider anthropic\n- floop config set llm.api_key $ANTHROPIC_API_KEY\n- floop config get llm.provider\n- floop config list\n- Reads/writes to ~/.floop/config.yaml\n\nDepends on:\n- feedback-loop-v68 (Config package)\n- feedback-loop-2pd (Deduplicator interface)","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:29:11.094493618-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-30T15:19:22.455426378-08:00","closed_at":"2026-01-30T15:19:22.455426378-08:00","close_reason":"Added deduplicate and config CLI commands","dependencies":[{"issue_id":"feedback-loop-goj","depends_on_id":"feedback-loop-2pd","type":"blocks","created_at":"2026-01-29T19:34:34.510362302-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-goj","depends_on_id":"feedback-loop-v68","type":"blocks","created_at":"2026-01-29T19:37:23.498054755-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-goj","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.860170113-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-guf","title":"Phase 5: Assembly - compile behaviors into prompt-ready format","description":"Implement the assembly phase that compiles activated behaviors into prompt-ready format with token optimization.\n\n## Tasks\n1. internal/assembly/compile.go - BehaviorCompiler that transforms behaviors into prompt sections\n2. internal/assembly/optimize.go - TokenOptimizer for budget management and prioritization\n3. floop prompt command - CLI command to generate agent prompt sections\n\n## Success Criteria\n- floop prompt --file main.go outputs active behaviors formatted for agent consumption\n- Token budget respected (--max-tokens flag)\n- Behaviors prioritized by confidence and relevance\n- JSON output mode for structured consumption","status":"closed","priority":1,"issue_type":"epic","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T18:00:36.008231355-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-27T18:18:28.831818887-08:00","closed_at":"2026-01-27T18:18:28.831818887-08:00","close_reason":"Implemented Phase 5 Assembly: compile.go, optimize.go, and floop prompt command with markdown/xml/plain formats and token optimization"}
{"id":"feedback-loop-ily","title":"Enhance GraphPlacer with LLM similarity","description":"Modify internal/learning/place.go:\n- Add GraphPlacerConfig struct with LLMClient, UseLLMForSimilarity, LLMSimilarityThreshold\n- Modify NewGraphPlacer to accept optional config\n- Enhance computeSimilarity method:\n  1. First compute fast rule-based score (existing Jaccard)\n  2. If score \u003e 0.5 and LLM available, enhance with semantic comparison\n  3. Blend scores: (ruleScore * 0.3) + (semanticScore * 0.7)\n- Fallback to pure rule-based when LLM unavailable\n\nDepends on:\n- feedback-loop-8jt (LLMClient interface)\n- feedback-loop-r0v (Subagent client) OR feedback-loop-a7p (Fallback client)\n- feedback-loop-v68 (Config for settings)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:28:50.531273974-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T21:09:56.943640078-08:00","closed_at":"2026-01-29T21:09:56.943640078-08:00","close_reason":"Added GraphPlacerConfig and LLM-enhanced similarity with 30/70 blending","dependencies":[{"issue_id":"feedback-loop-ily","depends_on_id":"feedback-loop-v68","type":"blocks","created_at":"2026-01-29T19:37:23.414524445-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ily","depends_on_id":"feedback-loop-8jt","type":"blocks","created_at":"2026-01-29T19:37:23.584727219-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-ily","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.711595729-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-jq3","title":"Create minimal CLI skeleton for dogfooding","description":"Build the absolute minimum floop CLI that can be used while developing: floop version, floop init (creates .floop/), and stubs for floop learn and floop list. This enables dogfooding from day one.","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:40:23.172955962-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-25T16:45:35.669921087-08:00","closed_at":"2026-01-25T16:45:35.669921087-08:00","close_reason":"Created minimal CLI skeleton with version, init, learn, and list commands. Installed globally via 'go install'. Ready for dogfooding - can capture corrections during development.","dependencies":[{"issue_id":"feedback-loop-jq3","depends_on_id":"feedback-loop-2bg","type":"blocks","created_at":"2026-01-25T16:40:37.702863753-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-mgv","title":"Create mock LLM client for testing","description":"Create internal/llm/mock.go with:\n- MockClient implementing LLMClient interface\n- Configurable responses for CompareBehaviors and MergeBehaviors\n- WithComparisonResult(result) builder method\n- WithMergeResult(result) builder method\n- WithError(err) to simulate failures\n- Call tracking for verification in tests\n\nUsed by all test files that need to mock LLM behavior.\n\nDepends on: feedback-loop-8jt (LLMClient interface)","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:29:26.407592235-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-30T11:32:39.758264825-08:00","closed_at":"2026-01-30T11:32:39.758264825-08:00","close_reason":"Implemented MockClient in internal/llm/mock.go with configurable responses, builder methods, and call tracking for tests.","dependencies":[{"issue_id":"feedback-loop-mgv","depends_on_id":"feedback-loop-8jt","type":"blocks","created_at":"2026-01-29T19:31:58.759473074-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-mgv","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:39.023458958-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-mvd","title":"Implement BeadsGraphStore for Phase 4 persistence","description":"Implement BeadsGraphStore in internal/store/beads.go that persists the behavior graph to disk using JSONL files.\n\n## Deliverables\n\n1. `internal/store/beads.go` - BeadsGraphStore implementation\n2. `internal/store/beads_test.go` - Test coverage\n3. CLI integration - Switch from InMemoryGraphStore to BeadsGraphStore\n\n## Storage Format\n\nStore in .floop/ directory:\n- `nodes.jsonl` - All nodes (behaviors, corrections, context-snapshots)\n- `edges.jsonl` - All edges (requires, overrides, conflicts, learned-from)\n\n## Interface Methods to Implement\n\n- AddNode, GetNode, UpdateNode, DeleteNode\n- QueryNodes (predicate-based filtering)\n- AddEdge, RemoveEdge, GetEdges\n- Traverse (graph traversal)\n- Sync, Close\n\n## Acceptance Criteria\n\n- [ ] All GraphStore interface methods implemented\n- [ ] Data persists between CLI invocations\n- [ ] Tests pass with \u003e80% coverage\n- [ ] `floop learn` creates durable behavior\n- [ ] `floop list` reads from persisted store\n- [ ] `floop active` works with persisted behaviors\n\n## Dependencies\n- Phase 3 complete (done)","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:42:42.456027205-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-27T09:07:56.825834527-08:00","closed_at":"2026-01-27T09:07:56.825834527-08:00","close_reason":"Implemented BeadsGraphStore with JSONL persistence. All tests pass with 85.4% coverage. CLI now uses persistent storage."}
{"id":"feedback-loop-mz2","title":"Implement core data models (behavior, correction, context, provenance)","description":"Create internal/models/*.go files: behavior.go (Behavior, BehaviorKind, BehaviorContent, BehaviorStats, SimilarityLink), correction.go (Correction struct), context.go (ContextSnapshot with Matches method), provenance.go (Provenance, SourceType). Follow patterns from SPEC.md.","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:42:40.737909659-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-25T16:59:54.385261252-08:00","closed_at":"2026-01-25T16:59:54.385261252-08:00","close_reason":"Implemented all core data models in internal/models/: behavior.go (Behavior, BehaviorKind, BehaviorContent, BehaviorStats, SimilarityLink), correction.go (Correction), context.go (ContextSnapshot with Matches method, InferLanguage helper), provenance.go (Provenance, SourceType with IsApproved/IsPending methods). All tests passing."}
{"id":"feedback-loop-okb","title":"Implement OpenAI API client","description":"Create internal/llm/openai.go with:\n- OpenAIClient implementing LLMClient interface\n- Direct OpenAI API calls using gpt-4o-mini for comparison\n- API key loading from config/environment\n- Timeout handling and retry logic\n- JSON response parsing\n\nAlternative to Anthropic for users who prefer OpenAI.\n\nDepends on:\n- feedback-loop-8jt (LLMClient interface)\n- feedback-loop-cok (Shared prompts)","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:27:47.996284129-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-30T12:57:57.494080525-08:00","closed_at":"2026-01-30T12:57:57.494080525-08:00","close_reason":"Implemented OpenAIClient in internal/llm/openai.go","dependencies":[{"issue_id":"feedback-loop-okb","depends_on_id":"feedback-loop-8jt","type":"blocks","created_at":"2026-01-29T19:31:58.676177676-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-okb","depends_on_id":"feedback-loop-cok","type":"blocks","created_at":"2026-01-29T19:32:28.828406268-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-okb","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.211854654-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-ol7","title":"Implement floop MCP server","description":"Implement floop as an MCP (Model Context Protocol) server for deeper AI tool integration.\n\n## Background\n\nMCP is supported by multiple AI tools:\n- Continue.dev (Agent mode)\n- Cursor \n- Cline\n- Windsurf/Cascade\n- GitHub Copilot (Agent mode)\n- Claude Code (future)\n\nAn MCP server allows these tools to invoke floop functionality directly as tools rather than shell commands.\n\n## Deliverables\n\n### 1. New Command: `floop mcp-server`\nStart an MCP server over stdio that exposes floop functionality.\n\n### 2. MCP Tools to Expose\n| Tool | Description | Parameters |\n|------|-------------|------------|\n| `floop_active` | Get active behaviors for context | `file`, `task` |\n| `floop_learn` | Capture a correction | `wrong`, `right`, `file` |\n| `floop_list` | List all behaviors | `--corrections` flag |\n\n### 3. Implementation\n\n```go\n// cmd/floop/mcp.go\nfunc newMCPServerCmd() *cobra.Command {\n    return \u0026cobra.Command{\n        Use:   \"mcp-server\",\n        Short: \"Run floop as an MCP server (stdio)\",\n        RunE: func(cmd *cobra.Command, args []string) error {\n            // Implement MCP protocol over stdin/stdout\n            // Use github.com/mark3labs/mcp-go or similar\n        },\n    }\n}\n```\n\n### 4. MCP Protocol Requirements\n- Transport: stdio (stdin/stdout JSON-RPC)\n- Implement: `tools/list`, `tools/call`\n- Return structured JSON responses\n\n### 5. Documentation\n- Update `docs/integrations/mcp-server.md` with usage\n- Provide config examples for each supported tool\n\n## Dependencies\n- May need MCP Go library (e.g., github.com/mark3labs/mcp-go)\n- Requires Phase 2 floop learn/active commands to be working\n\n## Testing\n- Unit tests for MCP protocol handling\n- Integration tests with at least one MCP client\n\n## Sources\n- https://modelcontextprotocol.io/\n- https://github.com/modelcontextprotocol/servers","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:35:29.128434288-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T17:40:19.87692991-08:00","closed_at":"2026-01-29T17:40:19.87692991-08:00","close_reason":"MCP server fully implemented: floop mcp-server command, 3 tools (floop_active, floop_learn, floop_list), 15 passing tests, comprehensive documentation"}
{"id":"feedback-loop-pd8","title":"Update GO_GUIDELINES.md for feedback-loop structure","description":"Adapt GO_GUIDELINES.md to match feedback-loop's internal/ structure (models, store, learning, activation, assembly) and remove TUI-specific content.","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:48:14.610439046-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-25T16:53:10.703193739-08:00","closed_at":"2026-01-25T16:53:10.703193739-08:00","close_reason":"Updated GO_GUIDELINES.md with project-specific structure, testing requirements, interface patterns, and CLI conventions."}
{"id":"feedback-loop-qbr","title":"Write dedup package tests","description":"Create internal/dedup/*_test.go files:\n- dedup_test.go: Test Deduplicator interface implementations\n- merger_test.go: Test merge strategies, when condition unions, confidence handling\n- crossstore_test.go: Test cross-store duplicate detection and resolution\n\nUse mock LLM client and in-memory graph store for isolation.\n\nDepends on:\n- feedback-loop-2pd (Deduplicator interface)\n- feedback-loop-9ie (BehaviorMerger)\n- feedback-loop-mgv (Mock LLM client)","status":"closed","priority":3,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:29:37.596253549-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-01T18:14:47.097017153-08:00","closed_at":"2026-02-01T18:14:47.097017153-08:00","close_reason":"Tests exist: dedup_test.go, merger_test.go, crossstore_test.go - coverage at 49.1%","dependencies":[{"issue_id":"feedback-loop-qbr","depends_on_id":"feedback-loop-mgv","type":"blocks","created_at":"2026-01-29T19:42:25.570090411-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-qbr","depends_on_id":"feedback-loop-9ie","type":"blocks","created_at":"2026-01-29T19:42:25.90644159-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-qbr","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:39.189454217-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-qke","title":"Write Cursor integration guide","description":"Create comprehensive integration guide for Cursor editor.\n\n## Research Findings (from e2d investigation)\n\n### Extension Points\n1. **.cursor/rules/*.mdc** - MDC rule files with YAML frontmatter\n2. **.cursor/hooks.json** - Hooks system (v1.7+) with lifecycle events\n3. **User Rules** - Global rules via Cursor Settings\n4. **AGENTS.md** - Cross-tool standard supported\n\n### Hooks (Best for floop)\n- `beforeSubmitPrompt` - Inject floop context\n- `afterFileEdit` - Track changes\n- Hooks receive JSON input, output `{\"cancel\": bool, \"contextModification\": string}`\n\n### Deliverables\n1. `docs/integrations/cursor.md` - Full guide with:\n   - Overview of Cursor extension mechanisms\n   - Quick start with MDC rules\n   - Full configuration with hooks\n   - MCP server option\n   - Troubleshooting\n2. `templates/cursor/` directory with:\n   - `floop-behaviors.mdc` template\n   - `hooks.json` template\n   - Hook script examples\n\n### Key Hooks Example\n```json\n{\n  \"version\": 1,\n  \"hooks\": {\n    \"beforeSubmitPrompt\": [{\n      \"command\": \"floop-cursor-hook\"\n    }]\n  }\n}\n```\n\n### Limitations\n- Rules don't affect Cursor Tab (only Chat/Inline Edit)\n- User Rules don't apply to Inline Edit (Cmd/Ctrl+K)\n- `alwaysApply: true` may not work reliably (use `globs: [\"*\"]` workaround)\n- Hooks are deterministic - can only continue/cancel, limited context injection\n\n### Sources\n- https://docs.cursor.com/context/rules\n- https://cursor.com/docs/agent/hooks\n- https://agents.md/","status":"open","priority":4,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-27T08:31:53.728804899-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T19:43:05.062423042-08:00"}
{"id":"feedback-loop-r0v","title":"Implement native CLI subagent client","description":"Create internal/llm/subagent.go with:\n- SubagentClient implementing LLMClient interface\n- Detects if running inside CLI session (check env vars, parent process)\n- Spawns lightweight haiku subagent for comparison\n- Formats comparison prompt as structured request\n- Parses JSON response from subagent\n- Uses same account/credits as parent session - no API key needed!\n- Timeout handling with graceful fallback to rules\n\nPRIORITY 1 APPROACH: This is the primary LLM implementation.\nWhen running inside Claude Code/Codex/OpenCode, uses the CLI's own LLM session.\n\nDepends on:\n- feedback-loop-8jt (LLMClient interface)\n- feedback-loop-cok (Shared prompts)","status":"closed","priority":0,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:28:06.056156246-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T22:34:52.496202183-08:00","closed_at":"2026-01-29T22:34:52.496202183-08:00","close_reason":"Created subagent.go implementing Client via CLI spawning with session detection","dependencies":[{"issue_id":"feedback-loop-r0v","depends_on_id":"feedback-loop-8jt","type":"blocks","created_at":"2026-01-29T19:31:58.361092347-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-r0v","depends_on_id":"feedback-loop-cok","type":"blocks","created_at":"2026-01-29T19:32:28.660961007-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-r0v","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.293005164-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-roa","title":"Implement cross-store deduplication","description":"Create internal/dedup/crossstore.go with:\n- CrossStoreDeduplicator handling local vs global store duplicates\n- Same ID in both stores: Local wins (existing behavior)\n- Semantic duplicates with different IDs: Merge, update edges to point to survivor\n- DeduplicateAcrossStores method for batch cross-store cleanup\n\nDepends on:\n- feedback-loop-2pd (Deduplicator interface)\n- feedback-loop-9ie (BehaviorMerger for actual merging)","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:28:18.240765744-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-30T12:57:58.039012521-08:00","closed_at":"2026-01-30T12:57:58.039012521-08:00","close_reason":"Implemented CrossStoreDeduplicator in internal/dedup/crossstore.go","dependencies":[{"issue_id":"feedback-loop-roa","depends_on_id":"feedback-loop-2pd","type":"blocks","created_at":"2026-01-29T19:34:34.353858199-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-roa","depends_on_id":"feedback-loop-9ie","type":"blocks","created_at":"2026-01-29T19:34:34.678185457-08:00","created_by":"Nic van Dessel"},{"issue_id":"feedback-loop-roa","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.538909551-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-v68","title":"Create unified config package","description":"Create internal/config/config.go with:\n- FloopConfig struct containing all settings\n- LLMConfig: provider, api_key, comparison_model, merge_model, timeout, enabled, fallback_to_rules\n- DeduplicationConfig: auto_merge, similarity_threshold\n- Load from environment variables (FLOOP_LLM_PROVIDER, ANTHROPIC_API_KEY, etc.)\n- Load from YAML config file (~/.floop/config.yaml)\n- Sensible defaults when no config present\n\nConfig schema:\nllm:\n  provider: anthropic\n  api_key: ${ANTHROPIC_API_KEY}\n  comparison_model: claude-3-haiku-20240307\n  timeout: 5s\n  enabled: true\n  fallback_to_rules: true\n\ndeduplication:\n  auto_merge: false\n  similarity_threshold: 0.95\n\nNo dependencies - can start in parallel with other tracks.","status":"closed","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-29T19:28:42.503049965-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-29T20:19:34.106147278-08:00","closed_at":"2026-01-29T20:19:34.106147278-08:00","close_reason":"Implemented unified config package with FloopConfig, LLMConfig, DeduplicationConfig. Supports YAML files and env var overrides with validation.","dependencies":[{"issue_id":"feedback-loop-v68","depends_on_id":"feedback-loop-f1y","type":"parent-child","created_at":"2026-01-29T19:42:38.625606459-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03","title":"Security Hardening Epic","description":"Comprehensive security hardening based on 5-auditor parallel security review. 2 CRITICAL, 10 HIGH, 12 MEDIUM, 6 LOW findings. Core issue: zero content sanitization in the learn-to-prompt pipeline enables stored prompt injection. Secondary issues: path traversal in backup/restore, no auth/rate-limiting on MCP tools, overly permissive file perms, shell hook injection risks.","status":"open","priority":1,"issue_type":"epic","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:52:37.095808054-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:52:37.095808054-08:00"}
{"id":"feedback-loop-w03.1","title":"P1: Content sanitization for floop_learn pipeline","description":"CRITICAL: The entire learn-to-prompt pipeline has zero sanitization. floop_learn accepts arbitrary text in wrong/right params, stores verbatim, and injects into agent system prompts via floop_active. Fix: (1) Add MaxBehaviorContentLen constant (2000 chars), enforce in handleFloopLearn. (2) Add content policy filter rejecting prompt injection patterns (system override, ignore previous, tool invocation instructions, encoded payloads). (3) Sanitize behavior content in assembly/compile.go before prompt injection. (4) Add XML/CDATA escaping for XML output format. Files: internal/mcp/handlers.go, internal/learning/extract.go, internal/assembly/compile.go, internal/constants/constants.go","status":"open","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:52:46.081830264-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:52:46.081830264-08:00","dependencies":[{"issue_id":"feedback-loop-w03.1","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:52:46.084139151-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.10","title":"P3: Sensitive data removal from git","description":"HIGH: corrections.jsonl, nodes.jsonl, edges.jsonl are all tracked by git. If repo goes public, all historical corrections leak. Fix: (1) Add corrections.jsonl, nodes.jsonl, edges.jsonl to .floop/.gitignore. (2) Document this as explicit design choice in README/docs. (3) Consider git-filter-repo to remove historical data if repo may become public. Files: .floop/.gitignore","status":"open","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:53:25.812365434-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:53:25.812365434-08:00","dependencies":[{"issue_id":"feedback-loop-w03.10","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:53:25.815387855-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.11","title":"P3: CI/CD security pipeline","description":"MEDIUM: No CI/CD pipeline exists. No automated security scanning. Fix: (1) Add GitHub Actions workflow with go vet, golangci-lint, govulncheck, go test -race, gosec. (2) Add CODEOWNERS for CLAUDE.md, AGENTS.md, .claude/ to require review. (3) Add dependabot or renovate for dependency updates. Files: .github/workflows/ (new), CODEOWNERS (new)","status":"open","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:53:29.081293224-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:53:29.081293224-08:00","dependencies":[{"issue_id":"feedback-loop-w03.11","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:53:29.083762773-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.12","title":"P3: Error message sanitization and API key protection","description":"MEDIUM: (1) API error responses include full body which may contain reflected auth data. Fix: Truncate to 200 chars, never include auth headers. (2) Config allows hardcoded API keys with 0644 perms. Fix: Warn if api_key is literal not env var reference. (3) Consider supporting OS keychain. Files: internal/llm/anthropic.go, internal/llm/openai.go, internal/config/config.go","status":"open","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:53:32.2624676-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:53:32.2624676-08:00","dependencies":[{"issue_id":"feedback-loop-w03.12","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:53:32.26510697-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.13","title":"P3: MCP audit logging","description":"MEDIUM: No authentication/authorization on MCP tools, and no audit trail for who called what. Fix: (1) Add structured audit logging for all MCP tool invocations (tool name, params, timestamp, caller if available). (2) Add read-only vs read-write tool categorization. (3) Log all restore operations with full details. (4) Log all floop_learn invocations. (5) Consider per-tool access control. Files: internal/mcp/handlers.go, internal/mcp/server.go","status":"open","priority":3,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:53:35.515132306-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:53:35.515132306-08:00","dependencies":[{"issue_id":"feedback-loop-w03.13","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:53:35.517786624-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.2","title":"P1: Reduce authoritative framing in behavior injection","description":"CRITICAL: handleBehaviorsResource wraps behaviors with 'CRITICAL: These are YOUR learned memories... Violating means repeating a past mistake' which creates maximum LLM compliance pressure and amplifies any injected payload. Fix: (1) Use softer framing that doesn't create unconditional compliance. (2) Add provenance/origin info per behavior. (3) Add disclaimer that behaviors could potentially be poisoned. (4) Consider a 'verified' flag for human-reviewed behaviors vs auto-learned ones. File: internal/mcp/handlers.go lines 160-163","status":"open","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:52:50.00629187-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:52:50.00629187-08:00","dependencies":[{"issue_id":"feedback-loop-w03.2","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:52:50.009066474-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.3","title":"P1: Path validation for floop_backup and floop_restore","description":"HIGH: Both floop_backup output_path and floop_restore input_path accept arbitrary filesystem paths with no validation. backup writes via os.Create, restore reads via os.Open. Fix: (1) Validate output_path is within ~/.floop/backups/ or project .floop/ dir. (2) Validate input_path similarly. (3) Use filepath.Clean + strings.HasPrefix check. (4) Reject absolute paths outside allowed dirs. (5) Reject paths containing '..'. (6) Add backup file checksums/signatures for integrity verification on restore. Files: internal/mcp/handlers.go (handleFloopBackup, handleFloopRestore), internal/backup/backup.go","status":"open","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:52:53.849364005-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:52:53.849364005-08:00","dependencies":[{"issue_id":"feedback-loop-w03.3","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:52:53.852107331-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.4","title":"P1: Rate limiting and resource bounds on MCP tools","description":"HIGH: Zero rate limiting on any MCP tool. Rapid floop_learn calls create unbounded behaviors, corrections, backups, goroutines, and PageRank recomputes. Fix: (1) Per-tool rate limits (e.g., max 10 floop_learn/min, max 30 floop_connect/min). (2) Cap total behaviors in store (e.g., 500). (3) Cap total edges in graph (e.g., 5000). (4) Cap max edges per node (e.g., 50). (5) Debounce refreshPageRank (max once per 5s). (6) Add corrections.jsonl rotation (max 1MB). (7) Bounded worker pool for background goroutines instead of fire-and-forget. (8) Add io.LimitReader for HTTP responses (1MB max). Files: internal/mcp/handlers.go, internal/mcp/server.go, internal/ranking/pagerank.go, internal/llm/anthropic.go, internal/llm/openai.go","status":"open","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:52:59.419761777-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:52:59.419761777-08:00","dependencies":[{"issue_id":"feedback-loop-w03.4","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:52:59.422469686-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.5","title":"P2: Shell hook hardening","description":"HIGH: Shell hooks in .claude/hooks/ have multiple injection risks. (1) detect-correction.sh passes unsanitized PROMPT as shell arg, uses CLAUDE_PROJECT_DIR without validation to locate floop binary. (2) first-prompt-inject.sh uses SESSION_ID in /tmp path without sanitization. Fix: (1) Sanitize SESSION_ID to alphanum+hyphens only. (2) Add -- before prompt args to prevent flag injection. (3) Validate floop binary path. (4) Use mktemp -d for session dirs with 0700 perms. (5) Add cleanup logic for /tmp markers. Files: .claude/hooks/detect-correction.sh, .claude/hooks/first-prompt-inject.sh, .claude/hooks/session-start.sh","status":"open","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:53:03.684120082-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:53:03.684120082-08:00","dependencies":[{"issue_id":"feedback-loop-w03.5","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:53:03.685757876-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.6","title":"P2: File permission hardening (0700/0600)","description":"MEDIUM: All .floop/ dirs created with 0755, all files with 0644. On shared systems, any user can read behaviors, corrections, config (with API keys), session state. Fix: (1) Change os.MkdirAll calls to 0700 for .floop/ dirs. (2) Change file creation to 0600 for all sensitive files (floop.db, corrections.jsonl, config.yaml, session-state.json, backups). (3) Use os.CreateTemp instead of predictable .tmp suffixes to prevent symlink attacks. Files: internal/store/sqlite.go, internal/store/file.go, internal/store/paths.go, internal/backup/backup.go, internal/session/file.go, internal/mcp/handlers.go, cmd/floop/cmd_init.go, cmd/floop/cmd_learn.go, cmd/floop/cmd_config.go","status":"open","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:53:09.033610745-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:53:09.033610745-08:00","dependencies":[{"issue_id":"feedback-loop-w03.6","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:53:09.036166477-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.7","title":"P2: Confidence manipulation defenses","description":"HIGH: Activation farming can boost malicious behaviors to 0.95 ceiling while decaying legit ones to 0.60 floor. Empty When conditions create universal activation. Fix: (1) Rate-limit confidence reinforcement (max once per 5min per behavior). (2) Flag/review behaviors with empty When conditions. (3) Require at least one When condition for learned behaviors OR lower base specificity for universal ones. (4) Add anomaly detection for behaviors activating on every single call. (5) Consider a trust tier: auto-learned (lower trust) vs human-reviewed (higher trust). Files: internal/mcp/handlers.go, internal/ranking/reinforcement.go, internal/activation/evaluate.go","status":"open","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:53:13.303446244-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:53:13.303446244-08:00","dependencies":[{"issue_id":"feedback-loop-w03.7","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:53:13.306557402-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.8","title":"P2: Subagent CLI path validation","description":"MEDIUM: SubagentClient searches PATH for claude/anthropic/opencode/codex and executes whichever found first. PATH hijacking possible. Also passes unsanitized behavior content as CLI args. Fix: (1) Allow only explicitly configured CLI paths or validate against known install locations. (2) Add content length limits for prompts passed to subagent. (3) Remove overly broad ppid\u003e1 check in inCLISession(). Files: internal/llm/subagent.go","status":"open","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:53:17.252009172-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:53:17.252009172-08:00","dependencies":[{"issue_id":"feedback-loop-w03.8","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:53:17.254273946-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-w03.9","title":"P2: Deduplication and spreading activation hardening","description":"HIGH: (1) Dedup can be weaponized: attacker creates behavior with high word overlap + malicious suffix, merge concatenates content and deletes original. Fix: Never auto-merge when content differs beyond formatting, show diff, preserve originals. (2) Spreading activation enables cross-context poisoning via floop_connect: high-weight edges from legit behaviors to malicious ones. Fix: Limit edges per node, add trust attribute, require When partial-match for spread-only behaviors. Files: internal/dedup/store_dedup.go, internal/dedup/merger.go, internal/spreading/engine.go, internal/mcp/handlers.go","status":"open","priority":2,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:53:22.593073476-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:53:22.593073476-08:00","dependencies":[{"issue_id":"feedback-loop-w03.9","depends_on_id":"feedback-loop-w03","type":"parent-child","created_at":"2026-02-06T16:53:22.596142195-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-wky","title":"Update SPEC.md with new naming conventions (floop, .floop/)","description":"Replace all references to 'bg' with 'floop', 'behavior-graph' with 'feedback-loop', and '.behaviors/' with '.floop/' throughout SPEC.md. This establishes the project naming conventions before implementation begins.","status":"closed","priority":1,"issue_type":"task","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:36:45.173754449-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-25T16:39:54.340313616-08:00","closed_at":"2026-01-25T16:39:54.340313616-08:00","close_reason":"Updated all naming conventions in SPEC.md: bg→floop, behavior-graph→feedback-loop, .behaviors/→.floop/"}
{"id":"feedback-loop-x2l","title":"Spreading Activation Polish","description":"Post-validation polish for the spreading activation system. Found during live testing of commit 166acda.\n\n## Context\nSpreading activation engine works correctly end-to-end (confirmed via debug script).\nThe MCP `floop_active` tool now returns spread-activated behaviors at distance \u003e 0.\nHowever, several issues need fixing before the feature delivers full value.\n\n## Issues Found\n1. `buildSpreadIndex` discards engine-computed activation values — all behaviors show activation=0.3\n2. Test artifact behaviors polluting the store\n3. Phantom edge targets not caught by `floop_validate`\n4. `floop_learn` metadata_extra SQL column bug (known, uninvestigated)","status":"open","priority":2,"issue_type":"epic","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T15:57:24.454037782-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T15:57:24.454037782-08:00"}
{"id":"feedback-loop-x2l.1","title":"buildSpreadIndex discards engine activation values","description":"## Problem\n`buildSpreadIndex()` in `internal/mcp/handlers.go:661` reconstructs activation metadata from the seed list and matches — it does NOT use the actual `spreading.Result` values returned by the engine.\n\nResult: All behaviors in floop_active output show `activation: 0.3` regardless of their actual computed activation. The engine computes differentiated values (seeds: 0.95, 0.73, 0.50; spread: 0.047) but these are thrown away.\n\n## Root Cause\n`buildSpreadIndex` takes `seeds` and `matches` but not the `spreadResults []spreading.Result`. For seeds, it uses `s.Activation` (the input seed value, not the post-sigmoid output). For spread-only, it uses `SpecificityToActivation(0) = 0.3` — a fixed default.\n\n## Fix\nPass `spreadResults` into `buildSpreadIndex` and use `Result.Activation`, `Result.Distance`, and `Result.SeedSource` directly. The engine already computes these correctly.\n\n## Impact\nWithout this fix, consumers of floop_active cannot distinguish high-relevance spread behaviors from low-relevance ones. The ranking signal from spreading activation is lost.\n\n## Files\n- `internal/mcp/handlers.go` — `buildSpreadIndex()`, `handleFloopActive()`","status":"open","priority":2,"issue_type":"bug","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T15:57:35.904988659-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T15:57:35.904988659-08:00","dependencies":[{"issue_id":"feedback-loop-x2l.1","depends_on_id":"feedback-loop-x2l","type":"parent-child","created_at":"2026-02-06T15:57:35.908159004-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-x2l.2","title":"Remove test artifact behaviors from store","description":"## Problem\nTwo test behaviors are polluting the production store:\n- `behavior-1ba6554edab6` — \"this is a test correction that should be deleted\"\n- `behavior-0892fc6f0858` — \"this is a test correction — floop_learn is working\"\n\nThese were created during manual testing of floop_learn and never cleaned up.\n\n## Fix\nRemove these behaviors from `.floop/nodes.jsonl` and `~/.floop/nodes.jsonl` (if present).\nAlso check for and remove any edges referencing these IDs from `edges.jsonl`.\n\n## Verification\nAfter cleanup, `floop_list` count should decrease by 2. `floop_validate` should still pass.","status":"closed","priority":3,"issue_type":"chore","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T15:57:41.60325562-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:41:16.354741006-08:00","closed_at":"2026-02-06T16:41:16.354741006-08:00","close_reason":"Removed 5 test behaviors from local nodes.jsonl, 3 test artifacts from global nodes.jsonl, and 1 dangling edge from local edges.jsonl","dependencies":[{"issue_id":"feedback-loop-x2l.2","depends_on_id":"feedback-loop-x2l","type":"parent-child","created_at":"2026-02-06T15:57:41.607110447-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-x2l.3","title":"floop_validate misses dangling edge targets","description":"## Problem\n`floop_validate` reports \"graph is valid\" but the edge graph contains references to node IDs that don't exist:\n- `behavior-da53f95a09b3` — target of an edge from behavior-f7e52c6a8bc7\n- `behavior-3de9531527a2` — appears in spreading results at distance=1\n- `test-behavior-1` — target of an edge from behavior-9f86d081884c\n\nThe spreading engine correctly handles these (GetNode returns nil, they're skipped in mergeSpreadResults), but `floop_validate` should flag them as dangling references.\n\n## Root Cause\nThe `ValidateBehaviorGraph` implementation in the store may only check edges against nodes within the same store scope, or may not check edge targets at all.\n\n## Fix\nEnsure `ValidateBehaviorGraph` checks that both `edge.Source` and `edge.Target` exist as nodes. Flag missing targets as dangling references.\n\n## Files\n- `internal/store/sqlite.go` or `internal/store/multigraph.go` — `ValidateBehaviorGraph()`\n- `.floop/edges.jsonl` — contains the dangling edges","status":"open","priority":2,"issue_type":"bug","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T15:57:49.336973-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T15:57:49.336973-08:00","dependencies":[{"issue_id":"feedback-loop-x2l.3","depends_on_id":"feedback-loop-x2l","type":"parent-child","created_at":"2026-02-06T15:57:49.34026792-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-x2l.4","title":"floop_learn fails with metadata_extra column error","description":"## Problem\n`floop_learn` produces: `SQL logic error: table behaviors has no column named metadata_extra`\n\nThis was noted in MEMORY.md but never investigated.\n\n## Root Cause\nUnknown — needs investigation. Likely a schema mismatch: the learning loop tries to INSERT/UPDATE a `metadata_extra` column that doesn't exist in the SQLite schema. Could be:\n1. Schema migration gap — column was added to the model but not to the CREATE TABLE / ALTER TABLE\n2. Store layer mismatch — the learning code references a field the store doesn't support\n\n## Impact\nCannot create new behaviors via `floop_learn` MCP tool. This is a critical workflow blocker.\n\n## Files to investigate\n- `internal/store/schema.go` — table definitions\n- `internal/store/sqlite.go` — INSERT/UPDATE queries\n- `internal/learning/` — where behaviors are constructed before storage","status":"open","priority":2,"issue_type":"bug","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T15:57:55.101877152-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T15:57:55.101877152-08:00","dependencies":[{"issue_id":"feedback-loop-x2l.4","depends_on_id":"feedback-loop-x2l","type":"parent-child","created_at":"2026-02-06T15:57:55.104689902-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-x2l.5","title":"Add tags field to behaviors for semantic grouping","description":"## Problem\nBehaviors lack a human-browsable categorization mechanism. The `when` field handles activation context (file, language, task) but doesn't support semantic grouping like \"worktrees\", \"subagents\", \"beads\", \"floop-process\".\n\nUsers auditing behaviors manually had to guess at groupings. The edge graph encodes semantic similarity but is invisible without tooling.\n\n## Proposal\nAdd a `tags: []string` field to the Behavior model. Tags are freeform labels for categorization:\n- `tags: [\"worktrees\", \"subagents\", \"parallel-work\"]`\n- `tags: [\"beads\", \"project-management\"]`\n- `tags: [\"floop\", \"process\"]`\n\n## Features\n1. `floop_list --tag \u003ctag\u003e` to filter behaviors by tag\n2. `floop_learn` could auto-suggest tags based on content similarity to existing tagged behaviors\n3. Tags displayed in floop_active output for context\n4. Tags distinct from `when` — tags are for humans, `when` is for activation\n\n## Files\n- `internal/models/behavior.go` — add Tags field\n- `internal/store/` — persist tags\n- `internal/mcp/schema.go` — expose in MCP output\n- `internal/mcp/handlers.go` — filter support","status":"open","priority":3,"issue_type":"feature","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:31:42.193175857-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:31:42.193175857-08:00","dependencies":[{"issue_id":"feedback-loop-x2l.5","depends_on_id":"feedback-loop-x2l","type":"parent-child","created_at":"2026-02-06T16:31:42.19617397-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-x2l.6","title":"Graph visualization command (floop graph)","description":"## Problem\nThe behavior graph has 26 nodes and 60 edges with semantic clusters, but there's no way to visualize it. Users auditing behaviors can't see which behaviors are connected, what clusters exist, or how spreading activation flows.\n\n## Proposal\nAdd `floop graph` CLI command and `floop_graph` MCP tool that outputs graph visualization.\n\n## Output Formats\n1. **DOT (Graphviz)** — `floop graph --format dot` → pipe to `dot -Tpng`\n2. **ASCII** — `floop graph --format ascii` → simple tree/cluster view for terminal\n3. **JSON** — `floop graph --format json` → for programmatic consumption\n\n## Features\n- Color/group nodes by tags (once tags exist) or by edge clusters\n- Show edge kinds (similar-to, requires, overrides) with different styles\n- Highlight activation paths when given a context (--file, --task)\n- Show confidence values on nodes, weights on edges\n\n## Files\n- `cmd/floop/graph.go` — CLI command\n- `internal/mcp/handlers.go` — MCP tool handler\n- `internal/visualization/` — new package for rendering","status":"open","priority":3,"issue_type":"feature","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:31:49.725820272-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:31:49.725820272-08:00","dependencies":[{"issue_id":"feedback-loop-x2l.6","depends_on_id":"feedback-loop-x2l","type":"parent-child","created_at":"2026-02-06T16:31:49.728566799-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-x2l.7","title":"Merge overlapping behaviors into consolidated set","description":"## Problem\nMultiple behaviors express the same concept with slight variations, wasting token budget and confusing the activation signal.\n\n## Merge Candidates\n\n### Worktrees cluster (3 → 1)\n- behavior-f7e52c6a8bc7: \"Use git worktrees in .worktrees/\"\n- behavior-84a379605b43: \"Create git worktrees in .worktrees/ at repo root\"\n- behavior-1a35b59d9b4d: \"When using subagents with git worktrees, create inside repo\"\n→ Merge into single \"worktrees best practice\" behavior\n\n### Subagent permissions cluster (3 → 1)\n- behavior-76e5757e480c: \"Subagents do read-only, orchestrator writes\"\n- behavior-fe7c50122f69: \"Investigate allowedPrompts for subagent permissions\"\n- behavior-e98a675ef270: \"Subagents need pre-approved permissions in settings.json\"\n→ Merge into single behavior with e98a's answer (the others are intermediate learnings)\n\n### Beads cluster (3 → 1)\n- behavior-7a098cb05216: \"Create detailed beads after planning\"\n- behavior-0070f24ee3e8: \"Claim beads when starting, close when done\"\n- behavior-0b09b561c160: \"Always close beads with their work\"\n→ Merge into single \"beads workflow\" behavior\n\n### Floop process cluster (3 → 1)\n- behavior-440356e972ee: \"Proactively use floop\"\n- behavior-95d6b9f414e4: \"Global vs local scope distinction\"\n- behavior-967fd13bd390: \"Use scope=both for important learnings\"\n→ Merge scope behaviors; keep proactive-use separate\n\n## Approach\nRun floop_deduplicate first, then manually merge remaining overlaps.","status":"open","priority":2,"issue_type":"chore","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-02-06T16:31:58.216997873-08:00","created_by":"Nic van Dessel","updated_at":"2026-02-06T16:31:58.216997873-08:00","dependencies":[{"issue_id":"feedback-loop-x2l.7","depends_on_id":"feedback-loop-x2l","type":"parent-child","created_at":"2026-02-06T16:31:58.220113017-08:00","created_by":"Nic van Dessel"}]}
{"id":"feedback-loop-x3o","title":"Phase 3: Activation system","status":"closed","priority":2,"issue_type":"epic","owner":"51134175+nvandessel@users.noreply.github.com","created_at":"2026-01-25T16:21:01.957430391-08:00","created_by":"Nic van Dessel","updated_at":"2026-01-27T08:33:10.757057242-08:00","closed_at":"2026-01-27T08:33:10.757057242-08:00","close_reason":"Phase 3 activation system complete: ContextBuilder, Evaluator, Resolver, and CLI commands (active, show, why)"}
